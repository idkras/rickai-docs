
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Документация Rick.ai - AI-ассистированные проекты и интеграции">
      
      
        <meta name="author" content="Ilya Krasinsky">
      
      
        <link rel="canonical" href="https://idkras.github.io/rickai-docs/vipavenue-adjust-appmetrica/">
      
      
        <link rel="prev" href="..">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>VipAvenue Adjust AppMetrica - Rick.ai Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css?v=8">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#adjust-appmetrica-utm-" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Rick.ai Documentation" class="md-header__button md-logo" aria-label="Rick.ai Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Rick.ai Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              VipAvenue Adjust AppMetrica
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/idkras/rickai-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
  
    
  
  VipAvenue Adjust AppMetrica

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Rick.ai Documentation" class="md-nav__button md-logo" aria-label="Rick.ai Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Rick.ai Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/idkras/rickai-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    VipAvenue Adjust AppMetrica
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    VipAvenue Adjust AppMetrica
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#next-actions" class="md-nav__link">
    <span class="md-ellipsis">
      📋 Next Actions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📋 Next Actions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      🔧 Технические задачи
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      📱 Пользовательский опыт
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deep-links" class="md-nav__link">
    <span class="md-ellipsis">
      🔗 Deep Links
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      📚 Разметить события и описать логику трекинга для
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2000-adjust-" class="md-nav__link">
    <span class="md-ellipsis">
      🎯 Работа с 2000+ кампаниями в Adjust - Масштабируемое решение
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🎯 Работа с 2000+ кампаниями в Adjust - Масштабируемое решение">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adjust-2000" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 Как это работает в Adjust для 2000 кампаний
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔹 Как это работает в Adjust для 2000 кампаний">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      Принцип работы:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      Пример структуры ссылки:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 Что нужно реально сделать руками
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔹 Что нужно реально сделать руками">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adjust-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      В Adjust Dashboard:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      В Яндекс.Директ (рекламный аккаунт):
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 Автоматизация через API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔹 Автоматизация через API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adjust-api" class="md-nav__link">
    <span class="md-ellipsis">
      Adjust API для массового создания:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api_1" class="md-nav__link">
    <span class="md-ellipsis">
      Яндекс.Директ API для массовой замены:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-2000" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 Чек-лист для 2000 кампаний:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔹 Чек-лист для 2000 кампаний:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      Подготовка:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      Внедрение:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      Мониторинг:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 Результат:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔹 Результат:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      Что получим:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      Время внедрения:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      🎬 Резюме
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🎬 Резюме">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      Ключевые принципы успешной интеграции:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adjust-2000_1" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 Как это работает в Adjust для 2000 кампаний
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 Что нужно реально сделать руками
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔹 Что нужно реально сделать руками">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adjust" class="md-nav__link">
    <span class="md-ellipsis">
      В Adjust:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      В Яндекс.Директ (рекламный аккаунт):
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ios-app-tracking-transparency-att" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 iOS App Tracking Transparency (ATT)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔹 iOS App Tracking Transparency (ATT)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      Обязательные требования:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      Правильный текст для экрана согласия:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 Экономическое обоснование
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#next-actions" class="md-nav__link">
    <span class="md-ellipsis">
      📋 Next Actions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📋 Next Actions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      🔧 Технические задачи
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      📱 Пользовательский опыт
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deep-links" class="md-nav__link">
    <span class="md-ellipsis">
      🔗 Deep Links
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      📚 Разметить события и описать логику трекинга для
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2000-adjust-" class="md-nav__link">
    <span class="md-ellipsis">
      🎯 Работа с 2000+ кампаниями в Adjust - Масштабируемое решение
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🎯 Работа с 2000+ кампаниями в Adjust - Масштабируемое решение">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adjust-2000" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 Как это работает в Adjust для 2000 кампаний
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔹 Как это работает в Adjust для 2000 кампаний">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      Принцип работы:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      Пример структуры ссылки:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 Что нужно реально сделать руками
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔹 Что нужно реально сделать руками">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adjust-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      В Adjust Dashboard:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      В Яндекс.Директ (рекламный аккаунт):
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 Автоматизация через API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔹 Автоматизация через API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adjust-api" class="md-nav__link">
    <span class="md-ellipsis">
      Adjust API для массового создания:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api_1" class="md-nav__link">
    <span class="md-ellipsis">
      Яндекс.Директ API для массовой замены:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-2000" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 Чек-лист для 2000 кампаний:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔹 Чек-лист для 2000 кампаний:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      Подготовка:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      Внедрение:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      Мониторинг:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 Результат:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔹 Результат:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      Что получим:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      Время внедрения:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      🎬 Резюме
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🎬 Резюме">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      Ключевые принципы успешной интеграции:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adjust-2000_1" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 Как это работает в Adjust для 2000 кампаний
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 Что нужно реально сделать руками
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔹 Что нужно реально сделать руками">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adjust" class="md-nav__link">
    <span class="md-ellipsis">
      В Adjust:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      В Яндекс.Директ (рекламный аккаунт):
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ios-app-tracking-transparency-att" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 iOS App Tracking Transparency (ATT)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔹 iOS App Tracking Transparency (ATT)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      Обязательные требования:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      Правильный текст для экрана согласия:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 Экономическое обоснование
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="adjust-appmetrica-utm-">Инструкция: Интеграция Adjust с AppMetrica для UTM-трекинга<a class="headerlink" href="#adjust-appmetrica-utm-" title="Permanent link">&para;</a></h1>
<p><em>Глубокий анализ для мобильной атрибуции и кросс-платформенного трекинга инструкция обновлена в августе 2025 года.</em></p>
<hr />
<h2 id="next-actions">📋 Next Actions<a class="headerlink" href="#next-actions" title="Permanent link">&para;</a></h2>
<h3 id="_1">🔧 Технические задачи<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Для всех параметров дописать комментарий, что это за поле adjust</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Flutter: сделать адаптацию кода</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Обновить текст запросов разрешений:</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Локация: сразу же спрашиваем...</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Разрешение на трекинг...</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Разрешение на уведомления...</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Добавить события в AppMetrica на согласие/несогласие:</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Локация</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Уведомления  </li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Разрешение на трекинг</li>
</ul>
<h3 id="_2">📱 Пользовательский опыт<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Предложить обновление текста для запроса доступа к локации:<blockquote>
<p>"Для предоставления персонализированных предложений и скидок на основе вашего местоположения, приложение использует данные о вашем местоположении. Эти данные не будут переданы третьим лицам без вашего согласия."</p>
</blockquote>
</li>
</ul>
<h3 id="deep-links">🔗 Deep Links<a class="headerlink" href="#deep-links" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Проверить, что в AppMetrica отправляются диплинки:
  <code>deep_link_path=/catalog/womens/clothes/dresses/seven-lab-cotton-dress</code></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Отправлять событие что пользователь пришел с диплинком</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Отправлять событие что пользователь действительно попал на страницу с диплинком и замерять, на какую страницу пришел в итоге</li>
</ul>
<h3 id="_3">📚 Разметить события и описать логику трекинга для<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Расписать для ASO</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Расписать пример для мотивированного трафика</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Расписать пример для email</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> расприать пример для перехода с website vipavenue.ru</li>
</ul>
</details>
<details open>
<summary><strong>## 🚀 QUICK START · 5 минут для разработчика - готовый код</strong></summary>

<details open>
<summary><strong>Flutter (main.dart)</strong></summary>

- Прочитайте официальную adjust flutter документацию: <a href="https://dev.adjust.com/en/sdk/flutter">https://dev.adjust.com/en/sdk/flutter</a> 
- Посмотрите на примеры кода в гитхабе: <a href="https://github.com/adjust/flutter_sdk/tree/master/example">https://github.com/adjust/flutter_sdk/tree/master/example</a>


<div class="language-dart highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">Add</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">pubspec</span><span class="p">.</span><span class="n">yaml</span><span class="w"> </span><span class="nl">file:</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nl">dependencies:</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">   </span><span class="nl">adjust_sdk:</span><span class="w"> </span><span class="o">^</span><span class="m">5.4</span><span class="p">.</span><span class="m">2</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="n">Navigate</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">project</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="w"> </span><span class="n">Visual</span><span class="w"> </span><span class="n">Studio</span><span class="w"> </span><span class="n">automatically</span><span class="w"> </span><span class="n">runs</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">edit</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">pubspec</span><span class="p">.</span><span class="n">yaml</span><span class="w"> </span><span class="n">file</span><span class="p">.</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="n">$</span><span class="w"> </span><span class="n">flutter</span><span class="w"> </span><span class="n">packages</span><span class="w"> </span><span class="kd">get</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="err">———</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:flutter/material.dart&#39;</span><span class="p">;</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:adjust_sdk/adjust_sdk.dart&#39;</span><span class="p">;</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:appmetrica_plugin/appmetrica_plugin.dart&#39;</span><span class="p">;</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:http/http.dart&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">http</span><span class="p">;</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="k">import</span><span class="w"> </span><span class="s1">&#39;dart:convert&#39;</span><span class="p">;</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">  </span><span class="n">runApp</span><span class="p">(</span><span class="n">MyApp</span><span class="p">());</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="p">}</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="kd">class</span><span class="w"> </span><span class="nc">MyApp</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">StatelessWidget</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="w">  </span><span class="nd">@override</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="w">  </span><span class="n">Widget</span><span class="w"> </span><span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">MaterialApp</span><span class="p">(</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="w">      </span><span class="nl">title:</span><span class="w"> </span><span class="s1">&#39;VipAvenue&#39;</span><span class="p">,</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="w">      </span><span class="nl">home:</span><span class="w"> </span><span class="n">MyHomePage</span><span class="p">(),</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="p">}</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="kd">class</span><span class="w"> </span><span class="nc">MyHomePage</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">StatefulWidget</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="w">  </span><span class="nd">@override</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a><span class="w">  </span><span class="n">_MyHomePageState</span><span class="w"> </span><span class="n">createState</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">_MyHomePageState</span><span class="p">();</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="p">}</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="kd">class</span><span class="w"> </span><span class="nc">_MyHomePageState</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">State</span><span class="o">&lt;</span><span class="n">MyHomePage</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="w">  </span><span class="nd">@override</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">initState</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="w">    </span><span class="k">super</span><span class="p">.</span><span class="n">initState</span><span class="p">();</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a><span class="w">    </span><span class="n">_initializeSDKs</span><span class="p">();</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a><span class="w">  </span><span class="c1">// ✅ ИНИЦИАЛИЗАЦИЯ: AppMetrica и Adjust в Flutter</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a><span class="w">  </span><span class="n">Future</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">_initializeSDKs</span><span class="p">()</span><span class="w"> </span><span class="kd">async</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a><span class="w">      </span><span class="c1">// 1. AppMetrica (первым!) - инициализируем первой для корректной работы</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a><span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="n">appMetricaKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;YOUR_APPMETRICA_API_KEY&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">// TODO: заменить на реальный API ключ из AppMetrica Dashboard (https://appmetrica.yandex.ru)</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a><span class="w">      </span><span class="c1">// ✅ ПРАВИЛЬНАЯ КОНФИГУРАЦИЯ AppMetrica</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a><span class="w">      </span><span class="kd">final</span><span class="w"> </span><span class="n">appMetricaConfig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AppMetricaConfig</span><span class="p">(</span><span class="n">appMetricaKey</span><span class="p">)</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a><span class="w">        </span><span class="p">..</span><span class="n">withLocationTracking</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="c1">// Разрешаем сбор данных о местоположении</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a><span class="w">        </span><span class="p">..</span><span class="n">withHandleFirstActivationAsUpdate</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"> </span><span class="c1">// Первый запуск = новый установ</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a><span class="w">      </span><span class="c1">// ✅ ПРАВИЛЬНАЯ АКТИВАЦИЯ (без await - синхронная операция)</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a><span class="w">      </span><span class="n">AppMetrica</span><span class="p">.</span><span class="n">activate</span><span class="p">(</span><span class="n">appMetricaConfig</span><span class="p">);</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a><span class="w">      </span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;✅ AppMetrica активирована&#39;</span><span class="p">);</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a><span class="w">      </span><span class="c1">// 2. Adjust (вторым!) - инициализируем после AppMetrica</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a><span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="n">adjustToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;YOUR_ADJUST_APP_TOKEN&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">// TODO: заменить на реальный App Token из Adjust Dashboard (https://app.adjust.com)</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a><span class="w">      </span><span class="c1">// Создаем конфигурацию Adjust для продакшена</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a><span class="w">      </span><span class="kd">final</span><span class="w"> </span><span class="n">adjustConfig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AdjustConfig</span><span class="p">(</span><span class="n">adjustToken</span><span class="p">,</span><span class="w"> </span><span class="n">AdjustEnvironment</span><span class="p">.</span><span class="n">production</span><span class="p">);</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a><span class="w">      </span><span class="c1">// ✅ ПРАВИЛЬНЫЙ CALLBACK: Adjust → AppMetrica</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a><span class="w">      </span><span class="n">adjustConfig</span><span class="p">.</span><span class="n">setAttributionChangedCallback</span><span class="p">((</span><span class="n">AdjustAttribution</span><span class="w"> </span><span class="n">attribution</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a><span class="w">        </span><span class="n">_handleAttribution</span><span class="p">(</span><span class="n">attribution</span><span class="p">);</span><span class="w"> </span><span class="c1">// Обрабатываем полученную атрибуцию</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a><span class="w">      </span><span class="p">});</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67" href="#__codelineno-0-67"></a>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68" href="#__codelineno-0-68"></a><span class="w">      </span><span class="c1">// Запускаем Adjust</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69" href="#__codelineno-0-69"></a><span class="w">      </span><span class="n">Adjust</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">adjustConfig</span><span class="p">);</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70" href="#__codelineno-0-70"></a><span class="w">      </span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;✅ Adjust активирован&#39;</span><span class="p">);</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71" href="#__codelineno-0-71"></a>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72" href="#__codelineno-0-72"></a><span class="w">      </span><span class="c1">// 3. Синхронизация идентификаторов</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73" href="#__codelineno-0-73"></a><span class="w">      </span><span class="n">Future</span><span class="p">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">Duration</span><span class="p">(</span><span class="nl">seconds:</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74" href="#__codelineno-0-74"></a><span class="w">        </span><span class="n">_syncDeviceIdentifiers</span><span class="p">();</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75" href="#__codelineno-0-75"></a><span class="w">      </span><span class="p">});</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76" href="#__codelineno-0-76"></a>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77" href="#__codelineno-0-77"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78" href="#__codelineno-0-78"></a><span class="w">      </span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;❌ Ошибка инициализации SDK: </span><span class="si">$</span><span class="n">e</span><span class="s1">&#39;</span><span class="p">);</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79" href="#__codelineno-0-79"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80" href="#__codelineno-0-80"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81" href="#__codelineno-0-81"></a>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82" href="#__codelineno-0-82"></a><span class="w">  </span><span class="c1">// ✅ ОБРАБОТКА: Attribution данных</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83" href="#__codelineno-0-83"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">_handleAttribution</span><span class="p">(</span><span class="n">AdjustAttribution</span><span class="w"> </span><span class="n">attribution</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84" href="#__codelineno-0-84"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85" href="#__codelineno-0-85"></a><span class="w">      </span><span class="kd">final</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86" href="#__codelineno-0-86"></a><span class="w">        </span><span class="c1">// 🎯 Adjust параметры для аналитики - данные от системы атрибуции</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87" href="#__codelineno-0-87"></a><span class="w">        </span><span class="s1">&#39;adjust_tracker&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">attribution</span><span class="p">.</span><span class="n">trackerName</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88" href="#__codelineno-0-88"></a><span class="w">        </span><span class="s1">&#39;adjust_network&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">attribution</span><span class="p">.</span><span class="n">network</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89" href="#__codelineno-0-89"></a><span class="w">        </span><span class="s1">&#39;adjust_campaign&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">attribution</span><span class="p">.</span><span class="n">campaign</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90" href="#__codelineno-0-90"></a><span class="w">        </span><span class="s1">&#39;adjust_creative&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">attribution</span><span class="p">.</span><span class="n">creative</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91" href="#__codelineno-0-91"></a><span class="w">        </span><span class="s1">&#39;adjust_click_label&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">attribution</span><span class="p">.</span><span class="n">clickLabel</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92" href="#__codelineno-0-92"></a><span class="w">        </span><span class="s1">&#39;adjust_adid&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">Adjust</span><span class="p">.</span><span class="n">getAdid</span><span class="p">()</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93" href="#__codelineno-0-93"></a><span class="w">        </span><span class="s1">&#39;is_first_launch&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">attribution</span><span class="p">.</span><span class="n">isFirstLaunch</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94" href="#__codelineno-0-94"></a>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95" href="#__codelineno-0-95"></a><span class="w">        </span><span class="c1">// 🔗 UTM параметры для корректной атрибуции</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96" href="#__codelineno-0-96"></a><span class="w">        </span><span class="s1">&#39;utm_source&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">attribution</span><span class="p">.</span><span class="n">network</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97" href="#__codelineno-0-97"></a><span class="w">        </span><span class="s1">&#39;utm_campaign&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">attribution</span><span class="p">.</span><span class="n">campaign</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98" href="#__codelineno-0-98"></a><span class="w">        </span><span class="s1">&#39;utm_content&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">attribution</span><span class="p">.</span><span class="n">creative</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99" href="#__codelineno-0-99"></a><span class="w">        </span><span class="s1">&#39;utm_medium&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Восстанавливается в Rick.ai по правилам</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100" href="#__codelineno-0-100"></a>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101" href="#__codelineno-0-101"></a><span class="w">        </span><span class="c1">// ⏰ Дополнительные параметры для аналитики</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102" href="#__codelineno-0-102"></a><span class="w">        </span><span class="s1">&#39;attribution_timestamp&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">DateTime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">millisecondsSinceEpoch</span><span class="w"> </span><span class="o">~/</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103" href="#__codelineno-0-103"></a><span class="w">        </span><span class="s1">&#39;attribution_type&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">attribution</span><span class="p">.</span><span class="n">isFirstLaunch</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;install&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;reinstall&#39;</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104" href="#__codelineno-0-104"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105" href="#__codelineno-0-105"></a>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106" href="#__codelineno-0-106"></a><span class="w">      </span><span class="c1">// ✅ Отправляем в AppMetrica с adjust_adid в каждом событии</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107" href="#__codelineno-0-107"></a><span class="w">      </span><span class="kd">final</span><span class="w"> </span><span class="n">adjustAdid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Adjust</span><span class="p">.</span><span class="n">getAdid</span><span class="p">();</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108" href="#__codelineno-0-108"></a><span class="w">      </span><span class="kd">final</span><span class="w"> </span><span class="n">paramsWithAdjustID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">dynamic</span><span class="o">&gt;</span><span class="p">.</span><span class="n">from</span><span class="p">(</span><span class="n">params</span><span class="p">);</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109" href="#__codelineno-0-109"></a><span class="w">      </span><span class="n">paramsWithAdjustID</span><span class="p">[</span><span class="s1">&#39;adjust_adid&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adjustAdid</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">;</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110" href="#__codelineno-0-110"></a><span class="w">      </span><span class="n">AppMetrica</span><span class="p">.</span><span class="n">reportEvent</span><span class="p">(</span><span class="s1">&#39;adjust attributed utm params&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">paramsWithAdjustID</span><span class="p">);</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111" href="#__codelineno-0-111"></a>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112" href="#__codelineno-0-112"></a><span class="w">      </span><span class="c1">// ✅ ОБМЕН ИДЕНТИФИКАТОРАМИ: Записываем adjust_adid в AppMetrica</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113" href="#__codelineno-0-113"></a><span class="w">      </span><span class="kd">final</span><span class="w"> </span><span class="n">adjustAdid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Adjust</span><span class="p">.</span><span class="n">getAdid</span><span class="p">();</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114" href="#__codelineno-0-114"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">adjustAdid</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115" href="#__codelineno-0-115"></a><span class="w">        </span><span class="c1">// ⚠️ ВАЖНО: setUserProfileID НЕ добавляет adjust_adid в каждое событие!</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116" href="#__codelineno-0-116"></a><span class="w">        </span><span class="c1">// Он только связывает все события пользователя с этим ID в AppMetrica</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117" href="#__codelineno-0-117"></a><span class="w">        </span><span class="n">AppMetrica</span><span class="p">.</span><span class="n">setUserProfileID</span><span class="p">(</span><span class="n">adjustAdid</span><span class="p">);</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118" href="#__codelineno-0-118"></a><span class="w">        </span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;✅ Adjust ADID записан в AppMetrica: </span><span class="si">$</span><span class="n">adjustAdid</span><span class="s1">&#39;</span><span class="p">);</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119" href="#__codelineno-0-119"></a>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120" href="#__codelineno-0-120"></a><span class="w">        </span><span class="c1">// ✅ ДОПОЛНИТЕЛЬНО: Отправляем событие с adjust_adid для аналитики</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121" href="#__codelineno-0-121"></a><span class="w">        </span><span class="n">AppMetrica</span><span class="p">.</span><span class="n">reportEvent</span><span class="p">(</span><span class="s1">&#39;adjust_id_synced&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122" href="#__codelineno-0-122"></a><span class="w">          </span><span class="s1">&#39;adjust_adid&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">adjustAdid</span><span class="p">,</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123" href="#__codelineno-0-123"></a><span class="w">          </span><span class="s1">&#39;appmetrica_device_id&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">AppMetrica</span><span class="p">.</span><span class="n">getDeviceID</span><span class="p">()</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124" href="#__codelineno-0-124"></a><span class="w">          </span><span class="s1">&#39;sync_timestamp&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">DateTime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">millisecondsSinceEpoch</span><span class="w"> </span><span class="o">~/</span><span class="w"> </span><span class="m">1000</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125" href="#__codelineno-0-125"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126" href="#__codelineno-0-126"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127" href="#__codelineno-0-127"></a>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128" href="#__codelineno-0-128"></a><span class="w">      </span><span class="c1">// ✅ ПРАВИЛЬНЫЙ ОБМЕН ИДЕНТИФИКАТОРАМИ: Записываем appmetrica_device_id в Adjust</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129" href="#__codelineno-0-129"></a><span class="w">      </span><span class="kd">final</span><span class="w"> </span><span class="n">appMetricaDeviceId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AppMetrica</span><span class="p">.</span><span class="n">getDeviceID</span><span class="p">();</span><span class="w"> </span><span class="c1">// Синхронный вызов</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130" href="#__codelineno-0-130"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">appMetricaDeviceId</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131" href="#__codelineno-0-131"></a><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">adjustEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AdjustEvent</span><span class="p">(</span><span class="s1">&#39;YOUR_DEVICE_ID_SYNC_TOKEN&#39;</span><span class="p">);</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132" href="#__codelineno-0-132"></a><span class="w">        </span><span class="n">adjustEvent</span><span class="p">.</span><span class="n">addCallbackParameter</span><span class="p">(</span><span class="s1">&#39;appmetrica_device_id&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">appMetricaDeviceId</span><span class="p">);</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133" href="#__codelineno-0-133"></a><span class="w">        </span><span class="n">adjustEvent</span><span class="p">.</span><span class="n">addCallbackParameter</span><span class="p">(</span><span class="s1">&#39;sync_timestamp&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">DateTime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">millisecondsSinceEpoch</span><span class="w"> </span><span class="o">~/</span><span class="w"> </span><span class="m">1000</span><span class="p">).</span><span class="n">toString</span><span class="p">());</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134" href="#__codelineno-0-134"></a><span class="w">        </span><span class="n">Adjust</span><span class="p">.</span><span class="n">trackEvent</span><span class="p">(</span><span class="n">adjustEvent</span><span class="p">);</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135" href="#__codelineno-0-135"></a><span class="w">        </span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;✅ AppMetrica Device ID записан в Adjust: </span><span class="si">$</span><span class="n">appMetricaDeviceId</span><span class="s1">&#39;</span><span class="p">);</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136" href="#__codelineno-0-136"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137" href="#__codelineno-0-137"></a>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138" href="#__codelineno-0-138"></a><span class="w">      </span><span class="c1">// Логирование в flow.rick.ai</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139" href="#__codelineno-0-139"></a><span class="w">      </span><span class="n">_logToRickAI</span><span class="p">(</span><span class="n">attribution</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">);</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140" href="#__codelineno-0-140"></a>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141" href="#__codelineno-0-141"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142" href="#__codelineno-0-142"></a><span class="w">      </span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;❌ Ошибка обработки attribution: </span><span class="si">$</span><span class="n">e</span><span class="s1">&#39;</span><span class="p">);</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143" href="#__codelineno-0-143"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144" href="#__codelineno-0-144"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145" href="#__codelineno-0-145"></a>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146" href="#__codelineno-0-146"></a><span class="w">  </span><span class="c1">// ✅ ОБМЕН ИДЕНТИФИКАТОРАМИ: Синхронизация device ID между платформами</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147" href="#__codelineno-0-147"></a><span class="w">  </span><span class="n">Future</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">_syncDeviceIdentifiers</span><span class="p">()</span><span class="w"> </span><span class="kd">async</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148" href="#__codelineno-0-148"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149" href="#__codelineno-0-149"></a><span class="w">      </span><span class="c1">// Синхронизируем Adjust ADID в AppMetrica</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150" href="#__codelineno-0-150"></a><span class="w">      </span><span class="kd">final</span><span class="w"> </span><span class="n">adjustAdid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Adjust</span><span class="p">.</span><span class="n">getAdid</span><span class="p">();</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151" href="#__codelineno-0-151"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">adjustAdid</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152" href="#__codelineno-0-152"></a><span class="w">        </span><span class="n">AppMetrica</span><span class="p">.</span><span class="n">setUserProfileID</span><span class="p">(</span><span class="n">adjustAdid</span><span class="p">);</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153" href="#__codelineno-0-153"></a><span class="w">        </span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;✅ Adjust ADID синхронизирован в AppMetrica: </span><span class="si">$</span><span class="n">adjustAdid</span><span class="s1">&#39;</span><span class="p">);</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154" href="#__codelineno-0-154"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155" href="#__codelineno-0-155"></a>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156" href="#__codelineno-0-156"></a><span class="w">      </span><span class="c1">// ✅ ПРАВИЛЬНАЯ СИНХРОНИЗАЦИЯ AppMetrica Device ID в Adjust</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157" href="#__codelineno-0-157"></a><span class="w">      </span><span class="kd">final</span><span class="w"> </span><span class="n">appMetricaDeviceId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AppMetrica</span><span class="p">.</span><span class="n">getDeviceID</span><span class="p">();</span><span class="w"> </span><span class="c1">// Синхронный вызов</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158" href="#__codelineno-0-158"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">appMetricaDeviceId</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159" href="#__codelineno-0-159"></a><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">adjustEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AdjustEvent</span><span class="p">(</span><span class="s1">&#39;YOUR_DEVICE_ID_SYNC_TOKEN&#39;</span><span class="p">);</span><span class="w"> </span><span class="c1">// TODO: создать специальный Event Token в Adjust Dashboard для синхронизации device ID</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160" href="#__codelineno-0-160"></a><span class="w">        </span><span class="n">adjustEvent</span><span class="p">.</span><span class="n">addCallbackParameter</span><span class="p">(</span><span class="s1">&#39;appmetrica_device_id&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">appMetricaDeviceId</span><span class="p">);</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161" href="#__codelineno-0-161"></a><span class="w">        </span><span class="n">adjustEvent</span><span class="p">.</span><span class="n">addCallbackParameter</span><span class="p">(</span><span class="s1">&#39;adjust_adid&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">Adjust</span><span class="p">.</span><span class="n">getAdid</span><span class="p">()</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">);</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162" href="#__codelineno-0-162"></a><span class="w">        </span><span class="n">adjustEvent</span><span class="p">.</span><span class="n">addCallbackParameter</span><span class="p">(</span><span class="s1">&#39;sync_type&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;appmetrica_to_adjust&#39;</span><span class="p">);</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163" href="#__codelineno-0-163"></a><span class="w">        </span><span class="n">adjustEvent</span><span class="p">.</span><span class="n">addCallbackParameter</span><span class="p">(</span><span class="s1">&#39;sync_timestamp&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">DateTime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">millisecondsSinceEpoch</span><span class="w"> </span><span class="o">~/</span><span class="w"> </span><span class="m">1000</span><span class="p">).</span><span class="n">toString</span><span class="p">());</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164" href="#__codelineno-0-164"></a><span class="w">        </span><span class="n">Adjust</span><span class="p">.</span><span class="n">trackEvent</span><span class="p">(</span><span class="n">adjustEvent</span><span class="p">);</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165" href="#__codelineno-0-165"></a><span class="w">        </span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;✅ AppMetrica Device ID синхронизирован в Adjust: </span><span class="si">$</span><span class="n">appMetricaDeviceId</span><span class="s1">&#39;</span><span class="p">);</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166" href="#__codelineno-0-166"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167" href="#__codelineno-0-167"></a>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168" href="#__codelineno-0-168"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169" href="#__codelineno-0-169"></a><span class="w">      </span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;❌ Ошибка синхронизации идентификаторов: </span><span class="si">$</span><span class="n">e</span><span class="s1">&#39;</span><span class="p">);</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170" href="#__codelineno-0-170"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171" href="#__codelineno-0-171"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172" href="#__codelineno-0-172"></a>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173" href="#__codelineno-0-173"></a><span class="w">  </span><span class="c1">// ✅ ЛОГИРОВАНИЕ: В flow.rick.ai</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174" href="#__codelineno-0-174"></a><span class="w">  </span><span class="n">Future</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">_logToRickAI</span><span class="p">(</span><span class="n">AdjustAttribution</span><span class="w"> </span><span class="n">attribution</span><span class="p">,</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">dynamic</span><span class="o">&gt;</span><span class="w"> </span><span class="n">params</span><span class="p">)</span><span class="w"> </span><span class="kd">async</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175" href="#__codelineno-0-175"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176" href="#__codelineno-0-176"></a><span class="w">      </span><span class="kd">final</span><span class="w"> </span><span class="n">appMetricaDeviceId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AppMetrica</span><span class="p">.</span><span class="n">getDeviceID</span><span class="p">();</span><span class="w"> </span><span class="c1">// Синхронный вызов</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177" href="#__codelineno-0-177"></a>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178" href="#__codelineno-0-178"></a><span class="w">      </span><span class="kd">final</span><span class="w"> </span><span class="n">logData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179" href="#__codelineno-0-179"></a><span class="w">        </span><span class="s1">&#39;event_type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;attribution_data&#39;</span><span class="p">,</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180" href="#__codelineno-0-180"></a><span class="w">        </span><span class="s1">&#39;timestamp&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">DateTime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">toIso8601String</span><span class="p">(),</span>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181" href="#__codelineno-0-181"></a><span class="w">        </span><span class="s1">&#39;app_info&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182" href="#__codelineno-0-182"></a><span class="w">          </span><span class="s1">&#39;app_id&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;com.vipavenue.app&#39;</span><span class="p">,</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183" href="#__codelineno-0-183"></a><span class="w">          </span><span class="s1">&#39;platform&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;flutter&#39;</span><span class="p">,</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184" href="#__codelineno-0-184"></a><span class="w">          </span><span class="s1">&#39;version&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1.0.0&#39;</span><span class="p">,</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185" href="#__codelineno-0-185"></a><span class="w">          </span><span class="s1">&#39;build&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1&#39;</span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186" href="#__codelineno-0-186"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187" href="#__codelineno-0-187"></a><span class="w">        </span><span class="s1">&#39;device_info&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188" href="#__codelineno-0-188"></a><span class="w">          </span><span class="s1">&#39;device_id&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">Adjust</span><span class="p">.</span><span class="n">getAdid</span><span class="p">()</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189" href="#__codelineno-0-189"></a><span class="w">          </span><span class="s1">&#39;appmetrica_device_id&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">appMetricaDeviceId</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190" href="#__codelineno-0-190"></a><span class="w">          </span><span class="s1">&#39;platform&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;flutter&#39;</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191" href="#__codelineno-0-191"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192" href="#__codelineno-0-192"></a><span class="w">        </span><span class="s1">&#39;attribution_data&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193" href="#__codelineno-0-193"></a><span class="w">          </span><span class="s1">&#39;adjust_network&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">attribution</span><span class="p">.</span><span class="n">network</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194" href="#__codelineno-0-194"></a><span class="w">          </span><span class="s1">&#39;adjust_campaign&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">attribution</span><span class="p">.</span><span class="n">campaign</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195" href="#__codelineno-0-195"></a><span class="w">          </span><span class="s1">&#39;adjust_creative&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">attribution</span><span class="p">.</span><span class="n">creative</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196" href="#__codelineno-0-196"></a><span class="w">          </span><span class="s1">&#39;adjust_tracker&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">attribution</span><span class="p">.</span><span class="n">trackerName</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197" href="#__codelineno-0-197"></a><span class="w">          </span><span class="s1">&#39;adjust_click_label&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">attribution</span><span class="p">.</span><span class="n">clickLabel</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198" href="#__codelineno-0-198"></a><span class="w">          </span><span class="s1">&#39;is_first_launch&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">attribution</span><span class="p">.</span><span class="n">isFirstLaunch</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199" href="#__codelineno-0-199"></a><span class="w">          </span><span class="s1">&#39;attribution_type&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">attribution</span><span class="p">.</span><span class="n">isFirstLaunch</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;install&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;reinstall&#39;</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200" href="#__codelineno-0-200"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201" href="#__codelineno-0-201"></a><span class="w">        </span><span class="s1">&#39;utm_data&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202" href="#__codelineno-0-202"></a><span class="w">          </span><span class="s1">&#39;utm_source&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">attribution</span><span class="p">.</span><span class="n">network</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203" href="#__codelineno-0-203"></a><span class="w">          </span><span class="s1">&#39;utm_medium&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Восстанавливается в Rick.ai по правилам</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204" href="#__codelineno-0-204"></a><span class="w">          </span><span class="s1">&#39;utm_campaign&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">attribution</span><span class="p">.</span><span class="n">campaign</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205" href="#__codelineno-0-205"></a><span class="w">          </span><span class="s1">&#39;utm_content&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">attribution</span><span class="p">.</span><span class="n">creative</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206" href="#__codelineno-0-206"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207" href="#__codelineno-0-207"></a><span class="w">        </span><span class="s1">&#39;sdk_status&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208" href="#__codelineno-0-208"></a><span class="w">          </span><span class="s1">&#39;adjust_initialized&#39;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209" href="#__codelineno-0-209"></a><span class="w">          </span><span class="s1">&#39;appmetrica_initialized&#39;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210" href="#__codelineno-0-210"></a><span class="w">          </span><span class="s1">&#39;attribution_received&#39;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211" href="#__codelineno-0-211"></a><span class="w">          </span><span class="s1">&#39;event_sent_to_appmetrica&#39;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212" href="#__codelineno-0-212"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213" href="#__codelineno-0-213"></a><span class="w">        </span><span class="s1">&#39;error_info&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214" href="#__codelineno-0-214"></a><span class="w">          </span><span class="s1">&#39;has_errors&#39;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215" href="#__codelineno-0-215"></a><span class="w">          </span><span class="s1">&#39;error_messages&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216" href="#__codelineno-0-216"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217" href="#__codelineno-0-217"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218" href="#__codelineno-0-218"></a>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219" href="#__codelineno-0-219"></a><span class="w">      </span><span class="c1">// Отправка в flow.rick.ai</span>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220" href="#__codelineno-0-220"></a><span class="w">      </span><span class="kd">await</span><span class="w"> </span><span class="n">_sendToRickAI</span><span class="p">(</span><span class="n">logData</span><span class="p">);</span>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221" href="#__codelineno-0-221"></a>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222" href="#__codelineno-0-222"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223" href="#__codelineno-0-223"></a><span class="w">      </span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;❌ Ошибка логирования в Rick.ai: </span><span class="si">$</span><span class="n">e</span><span class="s1">&#39;</span><span class="p">);</span>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224" href="#__codelineno-0-224"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225" href="#__codelineno-0-225"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226" href="#__codelineno-0-226"></a>
</span><span id="__span-0-227"><a id="__codelineno-0-227" name="__codelineno-0-227" href="#__codelineno-0-227"></a><span class="w">  </span><span class="c1">// 🌐 ОТПРАВКА: В flow.rick.ai</span>
</span><span id="__span-0-228"><a id="__codelineno-0-228" name="__codelineno-0-228" href="#__codelineno-0-228"></a><span class="w">  </span><span class="n">Future</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">_sendToRickAI</span><span class="p">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">dynamic</span><span class="o">&gt;</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="kd">async</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-229"><a id="__codelineno-0-229" name="__codelineno-0-229" href="#__codelineno-0-229"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230" href="#__codelineno-0-230"></a><span class="w">      </span><span class="kd">final</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Uri</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;https://flow.rick.ai/webhook/ff27caff-574f-4183-a29b-c2cac4147d43&#39;</span><span class="p">);</span>
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231" href="#__codelineno-0-231"></a>
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232" href="#__codelineno-0-232"></a><span class="w">      </span><span class="kd">final</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">await</span><span class="w"> </span><span class="n">http</span><span class="p">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="__span-0-233"><a id="__codelineno-0-233" name="__codelineno-0-233" href="#__codelineno-0-233"></a><span class="w">        </span><span class="n">url</span><span class="p">,</span>
</span><span id="__span-0-234"><a id="__codelineno-0-234" name="__codelineno-0-234" href="#__codelineno-0-234"></a><span class="w">        </span><span class="nl">headers:</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">},</span>
</span><span id="__span-0-235"><a id="__codelineno-0-235" name="__codelineno-0-235" href="#__codelineno-0-235"></a><span class="w">        </span><span class="nl">body:</span><span class="w"> </span><span class="n">jsonEncode</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
</span><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236" href="#__codelineno-0-236"></a><span class="w">      </span><span class="p">);</span>
</span><span id="__span-0-237"><a id="__codelineno-0-237" name="__codelineno-0-237" href="#__codelineno-0-237"></a>
</span><span id="__span-0-238"><a id="__codelineno-0-238" name="__codelineno-0-238" href="#__codelineno-0-238"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">statusCode</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m">200</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-239"><a id="__codelineno-0-239" name="__codelineno-0-239" href="#__codelineno-0-239"></a><span class="w">        </span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;❌ Rick.ai вернул статус: </span><span class="si">${</span><span class="n">response</span><span class="p">.</span><span class="n">statusCode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">);</span>
</span><span id="__span-0-240"><a id="__codelineno-0-240" name="__codelineno-0-240" href="#__codelineno-0-240"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-241"><a id="__codelineno-0-241" name="__codelineno-0-241" href="#__codelineno-0-241"></a><span class="w">        </span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;✅ Данные отправлены в Rick.ai&#39;</span><span class="p">);</span>
</span><span id="__span-0-242"><a id="__codelineno-0-242" name="__codelineno-0-242" href="#__codelineno-0-242"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-0-243"><a id="__codelineno-0-243" name="__codelineno-0-243" href="#__codelineno-0-243"></a>
</span><span id="__span-0-244"><a id="__codelineno-0-244" name="__codelineno-0-244" href="#__codelineno-0-244"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-245"><a id="__codelineno-0-245" name="__codelineno-0-245" href="#__codelineno-0-245"></a><span class="w">      </span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;❌ Ошибка отправки в Rick.ai: </span><span class="si">$</span><span class="n">e</span><span class="s1">&#39;</span><span class="p">);</span>
</span><span id="__span-0-246"><a id="__codelineno-0-246" name="__codelineno-0-246" href="#__codelineno-0-246"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-247"><a id="__codelineno-0-247" name="__codelineno-0-247" href="#__codelineno-0-247"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-248"><a id="__codelineno-0-248" name="__codelineno-0-248" href="#__codelineno-0-248"></a>
</span><span id="__span-0-249"><a id="__codelineno-0-249" name="__codelineno-0-249" href="#__codelineno-0-249"></a><span class="w">  </span><span class="nd">@override</span>
</span><span id="__span-0-250"><a id="__codelineno-0-250" name="__codelineno-0-250" href="#__codelineno-0-250"></a><span class="w">  </span><span class="n">Widget</span><span class="w"> </span><span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-251"><a id="__codelineno-0-251" name="__codelineno-0-251" href="#__codelineno-0-251"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Scaffold</span><span class="p">(</span>
</span><span id="__span-0-252"><a id="__codelineno-0-252" name="__codelineno-0-252" href="#__codelineno-0-252"></a><span class="w">      </span><span class="nl">appBar:</span><span class="w"> </span><span class="n">AppBar</span><span class="p">(</span><span class="nl">title:</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;VipAvenue&#39;</span><span class="p">)),</span>
</span><span id="__span-0-253"><a id="__codelineno-0-253" name="__codelineno-0-253" href="#__codelineno-0-253"></a><span class="w">      </span><span class="nl">body:</span><span class="w"> </span><span class="n">Center</span><span class="p">(</span>
</span><span id="__span-0-254"><a id="__codelineno-0-254" name="__codelineno-0-254" href="#__codelineno-0-254"></a><span class="w">        </span><span class="nl">child:</span><span class="w"> </span><span class="n">Column</span><span class="p">(</span>
</span><span id="__span-0-255"><a id="__codelineno-0-255" name="__codelineno-0-255" href="#__codelineno-0-255"></a><span class="w">          </span><span class="nl">mainAxisAlignment:</span><span class="w"> </span><span class="n">MainAxisAlignment</span><span class="p">.</span><span class="n">center</span><span class="p">,</span>
</span><span id="__span-0-256"><a id="__codelineno-0-256" name="__codelineno-0-256" href="#__codelineno-0-256"></a><span class="w">          </span><span class="nl">children:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-257"><a id="__codelineno-0-257" name="__codelineno-0-257" href="#__codelineno-0-257"></a><span class="w">            </span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;SDK инициализированы&#39;</span><span class="p">),</span>
</span><span id="__span-0-258"><a id="__codelineno-0-258" name="__codelineno-0-258" href="#__codelineno-0-258"></a><span class="w">            </span><span class="n">SizedBox</span><span class="p">(</span><span class="nl">height:</span><span class="w"> </span><span class="m">20</span><span class="p">),</span>
</span><span id="__span-0-259"><a id="__codelineno-0-259" name="__codelineno-0-259" href="#__codelineno-0-259"></a><span class="w">            </span><span class="n">ElevatedButton</span><span class="p">(</span>
</span><span id="__span-0-260"><a id="__codelineno-0-260" name="__codelineno-0-260" href="#__codelineno-0-260"></a><span class="w">              </span><span class="nl">onPressed:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-261"><a id="__codelineno-0-261" name="__codelineno-0-261" href="#__codelineno-0-261"></a><span class="w">                </span><span class="c1">// ✅ Тестовое событие с adjust_adid</span>
</span><span id="__span-0-262"><a id="__codelineno-0-262" name="__codelineno-0-262" href="#__codelineno-0-262"></a><span class="w">                </span><span class="kd">final</span><span class="w"> </span><span class="n">adjustAdid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Adjust</span><span class="p">.</span><span class="n">getAdid</span><span class="p">();</span>
</span><span id="__span-0-263"><a id="__codelineno-0-263" name="__codelineno-0-263" href="#__codelineno-0-263"></a><span class="w">                </span><span class="n">AppMetrica</span><span class="p">.</span><span class="n">reportEvent</span><span class="p">(</span><span class="s1">&#39;test_event&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-264"><a id="__codelineno-0-264" name="__codelineno-0-264" href="#__codelineno-0-264"></a><span class="w">                  </span><span class="s1">&#39;test_param&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test_value&#39;</span><span class="p">,</span>
</span><span id="__span-0-265"><a id="__codelineno-0-265" name="__codelineno-0-265" href="#__codelineno-0-265"></a><span class="w">                  </span><span class="s1">&#39;adjust_adid&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">adjustAdid</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-0-266"><a id="__codelineno-0-266" name="__codelineno-0-266" href="#__codelineno-0-266"></a><span class="w">                  </span><span class="s1">&#39;timestamp&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">DateTime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">millisecondsSinceEpoch</span><span class="w"> </span><span class="o">~/</span><span class="w"> </span><span class="m">1000</span>
</span><span id="__span-0-267"><a id="__codelineno-0-267" name="__codelineno-0-267" href="#__codelineno-0-267"></a><span class="w">                </span><span class="p">});</span>
</span><span id="__span-0-268"><a id="__codelineno-0-268" name="__codelineno-0-268" href="#__codelineno-0-268"></a><span class="w">                </span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;✅ Тестовое событие с adjust_adid отправлено&#39;</span><span class="p">);</span>
</span><span id="__span-0-269"><a id="__codelineno-0-269" name="__codelineno-0-269" href="#__codelineno-0-269"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-0-270"><a id="__codelineno-0-270" name="__codelineno-0-270" href="#__codelineno-0-270"></a><span class="w">              </span><span class="nl">child:</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Отправить тестовое событие&#39;</span><span class="p">),</span>
</span><span id="__span-0-271"><a id="__codelineno-0-271" name="__codelineno-0-271" href="#__codelineno-0-271"></a><span class="w">            </span><span class="p">),</span>
</span><span id="__span-0-272"><a id="__codelineno-0-272" name="__codelineno-0-272" href="#__codelineno-0-272"></a><span class="w">            </span><span class="n">SizedBox</span><span class="p">(</span><span class="nl">height:</span><span class="w"> </span><span class="m">20</span><span class="p">),</span>
</span><span id="__span-0-273"><a id="__codelineno-0-273" name="__codelineno-0-273" href="#__codelineno-0-273"></a><span class="w">            </span><span class="n">ElevatedButton</span><span class="p">(</span>
</span><span id="__span-0-274"><a id="__codelineno-0-274" name="__codelineno-0-274" href="#__codelineno-0-274"></a><span class="w">              </span><span class="nl">onPressed:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-275"><a id="__codelineno-0-275" name="__codelineno-0-275" href="#__codelineno-0-275"></a><span class="w">                </span><span class="c1">// ✅ Пример покупки с adjust_adid</span>
</span><span id="__span-0-276"><a id="__codelineno-0-276" name="__codelineno-0-276" href="#__codelineno-0-276"></a><span class="w">                </span><span class="kd">final</span><span class="w"> </span><span class="n">adjustAdid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Adjust</span><span class="p">.</span><span class="n">getAdid</span><span class="p">();</span>
</span><span id="__span-0-277"><a id="__codelineno-0-277" name="__codelineno-0-277" href="#__codelineno-0-277"></a><span class="w">                </span><span class="n">AppMetrica</span><span class="p">.</span><span class="n">reportEvent</span><span class="p">(</span><span class="s1">&#39;purchase&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-278"><a id="__codelineno-0-278" name="__codelineno-0-278" href="#__codelineno-0-278"></a><span class="w">                  </span><span class="s1">&#39;amount&#39;</span><span class="o">:</span><span class="w"> </span><span class="m">1000.0</span><span class="p">,</span>
</span><span id="__span-0-279"><a id="__codelineno-0-279" name="__codelineno-0-279" href="#__codelineno-0-279"></a><span class="w">                  </span><span class="s1">&#39;currency&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;RUB&#39;</span><span class="p">,</span>
</span><span id="__span-0-280"><a id="__codelineno-0-280" name="__codelineno-0-280" href="#__codelineno-0-280"></a><span class="w">                  </span><span class="s1">&#39;product_id&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test_product&#39;</span><span class="p">,</span>
</span><span id="__span-0-281"><a id="__codelineno-0-281" name="__codelineno-0-281" href="#__codelineno-0-281"></a><span class="w">                  </span><span class="s1">&#39;adjust_adid&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">adjustAdid</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-0-282"><a id="__codelineno-0-282" name="__codelineno-0-282" href="#__codelineno-0-282"></a><span class="w">                  </span><span class="s1">&#39;timestamp&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">DateTime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">millisecondsSinceEpoch</span><span class="w"> </span><span class="o">~/</span><span class="w"> </span><span class="m">1000</span>
</span><span id="__span-0-283"><a id="__codelineno-0-283" name="__codelineno-0-283" href="#__codelineno-0-283"></a><span class="w">                </span><span class="p">});</span>
</span><span id="__span-0-284"><a id="__codelineno-0-284" name="__codelineno-0-284" href="#__codelineno-0-284"></a><span class="w">                </span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;✅ Событие покупки с adjust_adid отправлено&#39;</span><span class="p">);</span>
</span><span id="__span-0-285"><a id="__codelineno-0-285" name="__codelineno-0-285" href="#__codelineno-0-285"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-0-286"><a id="__codelineno-0-286" name="__codelineno-0-286" href="#__codelineno-0-286"></a><span class="w">              </span><span class="nl">child:</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Отправить событие покупки&#39;</span><span class="p">),</span>
</span><span id="__span-0-287"><a id="__codelineno-0-287" name="__codelineno-0-287" href="#__codelineno-0-287"></a><span class="w">            </span><span class="p">),</span>
</span><span id="__span-0-288"><a id="__codelineno-0-288" name="__codelineno-0-288" href="#__codelineno-0-288"></a><span class="w">          </span><span class="p">],</span>
</span><span id="__span-0-289"><a id="__codelineno-0-289" name="__codelineno-0-289" href="#__codelineno-0-289"></a><span class="w">        </span><span class="p">),</span>
</span><span id="__span-0-290"><a id="__codelineno-0-290" name="__codelineno-0-290" href="#__codelineno-0-290"></a><span class="w">      </span><span class="p">),</span>
</span><span id="__span-0-291"><a id="__codelineno-0-291" name="__codelineno-0-291" href="#__codelineno-0-291"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-0-292"><a id="__codelineno-0-292" name="__codelineno-0-292" href="#__codelineno-0-292"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-293"><a id="__codelineno-0-293" name="__codelineno-0-293" href="#__codelineno-0-293"></a><span class="p">}</span>
</span></code></pre></div>

### **Конфигурация Flutter:**

#### **pubspec.yaml:**
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nt">dependencies</span><span class="p">:</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="nt">flutter</span><span class="p">:</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="nt">sdk</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flutter</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">  </span><span class="nt">adjust_sdk</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^5.4.2</span><span class="w">  </span><span class="c1"># ✅ ПРАВИЛЬНАЯ ВЕРСИЯ (официальная документация)</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">  </span><span class="nt">appmetrica_plugin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^2.0.0</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">  </span><span class="nt">http</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^1.1.0</span>
</span></code></pre></div>

#### **Android: android/app/src/main/AndroidManifest.xml**
<div class="language-xml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nt">&lt;manifest&gt;</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="nt">&lt;application&gt;</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">        </span><span class="cm">&lt;!-- AppMetrica --&gt;</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">        </span><span class="nt">&lt;meta-data</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">            </span><span class="na">android:name=</span><span class="s">&quot;com.yandex.metrica.ApiKey&quot;</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">            </span><span class="na">android:value=</span><span class="s">&quot;YOUR_APPMETRICA_API_KEY&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">        </span><span class="cm">&lt;!-- Adjust --&gt;</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">        </span><span class="nt">&lt;meta-data</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">            </span><span class="na">android:name=</span><span class="s">&quot;com.adjust.sdk.AppToken&quot;</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">            </span><span class="na">android:value=</span><span class="s">&quot;YOUR_ADJUST_APP_TOKEN&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">    </span><span class="nt">&lt;/application&gt;</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="nt">&lt;/manifest&gt;</span>
</span></code></pre></div>

#### **iOS: ios/Runner/Info.plist**
<div class="language-xml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nt">&lt;dict&gt;</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="cm">&lt;!-- AppMetrica --&gt;</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="nt">&lt;key&gt;</span>APPMETRICA_API_KEY<span class="nt">&lt;/key&gt;</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="nt">&lt;string&gt;</span>YOUR_APPMETRICA_API_KEY<span class="nt">&lt;/string&gt;</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">    </span><span class="cm">&lt;!-- Adjust --&gt;</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">    </span><span class="nt">&lt;key&gt;</span>ADJUST_APP_TOKEN<span class="nt">&lt;/key&gt;</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">    </span><span class="nt">&lt;string&gt;</span>YOUR_ADJUST_APP_TOKEN<span class="nt">&lt;/string&gt;</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">    </span><span class="cm">&lt;!-- App Tracking Transparency --&gt;</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">    </span><span class="nt">&lt;key&gt;</span>NSUserTrackingUsageDescription<span class="nt">&lt;/key&gt;</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">    </span><span class="nt">&lt;string&gt;</span>Мы<span class="w"> </span>используем<span class="w"> </span>данные<span class="w"> </span>для<span class="w"> </span>персонализации<span class="w"> </span>вашего<span class="w"> </span>опыта<span class="w"> </span>и<span class="w"> </span>показа<span class="w"> </span>подходящих<span class="w"> </span>вам<span class="w"> </span>товаров.<span class="nt">&lt;/string&gt;</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="nt">&lt;/dict&gt;</span>
</span></code></pre></div>

</details>

### **📋 ЧЕКЛИСТ ДЛЯ КОМАНДЫ РАЗРАБОТКИ**

#### **🔧 Техническая проверка:**
- [ ] **SDK инициализация**: AppMetrica инициализируется ПЕРВОЙ, затем Adjust
- [ ] **API ключи**: Добавлены в Info.plist/strings.xml/AndroidManifest.xml
- [ ] **Версия SDK**: `adjust_sdk: ^5.4.2` в pubspec.yaml
- [ ] **Callback**: `setAttributionChangedCallback` настроен правильно
- [ ] **Device ID**: Синхронизация между Adjust и AppMetrica работает

#### **📊 События, которые должны отправляться в AppMetrica:**

**1. Основные события атрибуции:**
- [ ] `adjust attributed utm params` - с полными UTM параметрами и `adjust_adid`
- [ ] `adjust_id_synced` - подтверждение синхронизации ID
- [ ] `device_id_sync` - синхронизация при запуске

**2. События App Tracking Transparency (iOS):**
- [ ] `tracking_authorized` - пользователь разрешил трекинг
- [ ] `tracking_denied` - пользователь отказал в трекинге
- [ ] `tracking_restricted` - трекинг ограничен системой

**3. События Deep Links:**
- [ ] `deep_link_opened` - открытие через deep link
- [ ] `deep_link_deferred` - отложенный deep link
- [ ] `universal_link` - универсальная ссылка

**4. События покупок:**
- [ ] `purchase` - покупка товара с `adjust_adid`
- [ ] `purchase_with_utm` - покупка с UTM параметрами

**5. События пользовательского опыта:**
- [ ] `location_permission_granted` - разрешение на локацию
- [ ] `location_permission_denied` - отказ в локации
- [ ] `notification_permission_granted` - разрешение на уведомления
- [ ] `notification_permission_denied` - отказ в уведомлениях

#### **🎯 Проверка в AppMetrica Dashboard:**
- [ ] Все события содержат параметр `adjust_adid`
- [ ] UTM параметры корректно передаются
- [ ] Связь между Adjust и AppMetrica работает
- [ ] Нет ошибок в логах приложения

#### **📱 Тестирование на устройствах:**
- [ ] iOS 14.5+ - ATT диалог появляется
- [ ] Android - Google Play Services работают
- [ ] Deep links открывают правильные страницы
- [ ] Покупки трекаются корректно

<details>
<summary><strong>iOS (AppDelegate.swift)</strong></summary>

        appMetricaConfig.locationTracking = true // AI todo: допиши зачем и как правильно 
        задает, привести пример. Правильно обработать в листалке...
        appMetricaConfig.handleFirstActivationAsUpdate = false // AI todo: допиши зачем и как правильно


<div class="language-swift highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kd">import</span> <span class="nc">AdjustSdk</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="kd">import</span> <span class="nc">AppMetricaCore</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="kd">import</span> <span class="nc">AppTrackingTransparency</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="kd">import</span> <span class="nc">os</span><span class="p">.</span><span class="nc">log</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="kd">class</span> <span class="nc">AppDelegate</span><span class="p">:</span> <span class="bp">UIResponder</span><span class="p">,</span> <span class="bp">UIApplicationDelegate</span> <span class="p">{</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>    <span class="kd">private</span> <span class="kd">let</span> <span class="nv">logger</span> <span class="p">=</span> <span class="n">Logger</span><span class="p">(</span><span class="n">subsystem</span><span class="p">:</span> <span class="s">&quot;com.vipavenue.app&quot;</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="s">&quot;SDK&quot;</span><span class="p">)</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>    <span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="kc">_</span> <span class="n">application</span><span class="p">:</span> <span class="bp">UIApplication</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span> <span class="n">launchOptions</span><span class="p">:</span> <span class="p">[</span><span class="bp">UIApplication</span><span class="p">.</span><span class="n">LaunchOptionsKey</span><span class="p">:</span> <span class="nb">Any</span><span class="p">]?)</span> <span class="p">-&gt;</span> <span class="nb">Bool</span> <span class="p">{</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>        <span class="c1">// 1. AppMetrica (первым!)</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>        <span class="k">guard</span> <span class="kd">let</span> <span class="nv">appMetricaKey</span> <span class="p">=</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">object</span><span class="p">(</span><span class="n">forInfoDictionaryKey</span><span class="p">:</span> <span class="s">&quot;APPMETRICA_API_KEY&quot;</span><span class="p">)</span> <span class="k">as</span><span class="p">?</span> <span class="nb">String</span><span class="p">,</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>              <span class="o">!</span><span class="n">appMetricaKey</span><span class="p">.</span><span class="bp">isEmpty</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>            <span class="n">logger</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;APPMETRICA_API_KEY не найден в Info.plist&quot;</span><span class="p">)</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>            <span class="k">return</span> <span class="kc">true</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>        <span class="p">}</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>        <span class="kd">let</span> <span class="nv">appMetricaConfig</span> <span class="p">=</span> <span class="n">AppMetricaConfiguration</span><span class="p">(</span><span class="n">apiKey</span><span class="p">:</span> <span class="n">appMetricaKey</span><span class="p">)</span><span class="o">!</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>        <span class="c1">// ✅ КОНФИГУРАЦИЯ: Настройки AppMetrica через UserDefaults</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>        <span class="kd">let</span> <span class="nv">userDefaults</span> <span class="p">=</span> <span class="n">UserDefaults</span><span class="p">.</span><span class="n">standard</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>        <span class="c1">// 📍 locationTracking - разрешает AppMetrica собирать данные о местоположении пользователя</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>        <span class="kd">let</span> <span class="nv">locationTracking</span> <span class="p">=</span> <span class="n">userDefaults</span><span class="p">.</span><span class="n">bool</span><span class="p">(</span><span class="n">forKey</span><span class="p">:</span> <span class="s">&quot;appmetrica_location_tracking&quot;</span><span class="p">)</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>        <span class="c1">// 🔄 handleFirstActivationAsUpdate - как обрабатывать первый запуск приложения</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>        <span class="c1">// true = считать первый запуск как обновление (для статистики)</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>        <span class="c1">// false = считать как новый установ (правильно для аналитики установок)</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>        <span class="kd">let</span> <span class="nv">handleFirstActivationAsUpdate</span> <span class="p">=</span> <span class="n">userDefaults</span><span class="p">.</span><span class="n">bool</span><span class="p">(</span><span class="n">forKey</span><span class="p">:</span> <span class="s">&quot;appmetrica_handle_first_activation_as_update&quot;</span><span class="p">)</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>        <span class="n">appMetricaConfig</span><span class="p">.</span><span class="n">locationTracking</span> <span class="p">=</span> <span class="n">locationTracking</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>        <span class="n">appMetricaConfig</span><span class="p">.</span><span class="n">handleFirstActivationAsUpdate</span> <span class="p">=</span> <span class="n">handleFirstActivationAsUpdate</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a>        <span class="c1">// Логируем настройки</span>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a>        <span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;AppMetrica config: locationTracking=</span><span class="si">\(</span><span class="n">locationTracking</span><span class="si">)</span><span class="s">, handleFirstActivationAsUpdate=</span><span class="si">\(</span><span class="n">handleFirstActivationAsUpdate</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span> 
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a>        <span class="n">AppMetrica</span><span class="p">.</span><span class="n">activate</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="n">appMetricaConfig</span><span class="p">)</span>
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a>
</span><span id="__span-4-38"><a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a>        <span class="c1">// 2. Adjust (вторым!)</span>
</span><span id="__span-4-39"><a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a>        <span class="k">guard</span> <span class="kd">let</span> <span class="nv">adjustToken</span> <span class="p">=</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">object</span><span class="p">(</span><span class="n">forInfoDictionaryKey</span><span class="p">:</span> <span class="s">&quot;ADJUST_APP_TOKEN&quot;</span><span class="p">)</span> <span class="k">as</span><span class="p">?</span> <span class="nb">String</span><span class="p">,</span>
</span><span id="__span-4-40"><a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a>              <span class="o">!</span><span class="n">adjustToken</span><span class="p">.</span><span class="bp">isEmpty</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-4-41"><a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a>            <span class="n">logger</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;ADJUST_APP_TOKEN не найден в Info.plist&quot;</span><span class="p">)</span>
</span><span id="__span-4-42"><a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a>            <span class="k">return</span> <span class="kc">true</span>
</span><span id="__span-4-43"><a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a>        <span class="p">}</span>
</span><span id="__span-4-44"><a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a>
</span><span id="__span-4-45"><a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a>        <span class="kd">let</span> <span class="nv">adjustConfig</span> <span class="p">=</span> <span class="n">ADJConfig</span><span class="p">(</span><span class="n">appToken</span><span class="p">:</span> <span class="n">adjustToken</span><span class="p">,</span> <span class="n">environment</span><span class="p">:</span> <span class="n">ADJEnvironmentProduction</span><span class="p">)</span>
</span><span id="__span-4-46"><a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a>
</span><span id="__span-4-47"><a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a>        <span class="c1">// Callback: Adjust → AppMetrica</span>
</span><span id="__span-4-48"><a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a>        <span class="n">adjustConfig</span><span class="p">?.</span><span class="n">setAttributionChangedBlock</span> <span class="p">{</span> <span class="n">attribution</span> <span class="k">in</span>
</span><span id="__span-4-49"><a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a>            <span class="k">if</span> <span class="kd">let</span> <span class="nv">attribution</span> <span class="p">=</span> <span class="n">attribution</span> <span class="p">{</span>
</span><span id="__span-4-50"><a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a>                <span class="c1">// Проверяем что AppMetrica готова</span>
</span><span id="__span-4-51"><a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a>                <span class="k">if</span> <span class="n">AppMetrica</span><span class="p">.</span><span class="n">isActivated</span> <span class="p">{</span>
</span><span id="__span-4-52"><a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a>                    <span class="kd">let</span> <span class="nv">params</span> <span class="p">=</span> <span class="p">[</span>
</span><span id="__span-4-53"><a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a>                        <span class="c1">// 🎯 Adjust параметры для аналитики - данные от системы атрибуции</span>
</span><span id="__span-4-54"><a id="__codelineno-4-54" name="__codelineno-4-54" href="#__codelineno-4-54"></a>
</span><span id="__span-4-55"><a id="__codelineno-4-55" name="__codelineno-4-55" href="#__codelineno-4-55"></a>                        <span class="c1">// 📊 adjust_tracker - уникальный идентификатор трекера в Adjust</span>
</span><span id="__span-4-56"><a id="__codelineno-4-56" name="__codelineno-4-56" href="#__codelineno-4-56"></a>                        <span class="c1">// Трекер = ссылка в Adjust, которая отслеживает откуда пришел пользователь</span>
</span><span id="__span-4-57"><a id="__codelineno-4-57" name="__codelineno-4-57" href="#__codelineno-4-57"></a>                        <span class="c1">// Пример: &quot;abc123&quot; - это ID конкретной рекламной ссылки</span>
</span><span id="__span-4-58"><a id="__codelineno-4-58" name="__codelineno-4-58" href="#__codelineno-4-58"></a>                        <span class="s">&quot;adjust_tracker&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">trackerName</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-4-59"><a id="__codelineno-4-59" name="__codelineno-4-59" href="#__codelineno-4-59"></a>
</span><span id="__span-4-60"><a id="__codelineno-4-60" name="__codelineno-4-60" href="#__codelineno-4-60"></a>                        <span class="c1">// 🌐 adjust_network - источник трафика (рекламная сеть)</span>
</span><span id="__span-4-61"><a id="__codelineno-4-61" name="__codelineno-4-61" href="#__codelineno-4-61"></a>                        <span class="c1">// Примеры: &quot;facebook&quot;, &quot;google&quot;, &quot;yandex&quot;, &quot;organic&quot; (органический трафик)</span>
</span><span id="__span-4-62"><a id="__codelineno-4-62" name="__codelineno-4-62" href="#__codelineno-4-62"></a>                        <span class="c1">// Показывает где была размещена реклама</span>
</span><span id="__span-4-63"><a id="__codelineno-4-63" name="__codelineno-4-63" href="#__codelineno-4-63"></a>                        <span class="s">&quot;adjust_network&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">network</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-4-64"><a id="__codelineno-4-64" name="__codelineno-4-64" href="#__codelineno-4-64"></a>
</span><span id="__span-4-65"><a id="__codelineno-4-65" name="__codelineno-4-65" href="#__codelineno-4-65"></a>                        <span class="c1">// 📢 adjust_campaign - название рекламной кампании</span>
</span><span id="__span-4-66"><a id="__codelineno-4-66" name="__codelineno-4-66" href="#__codelineno-4-66"></a>                        <span class="c1">// Пример: &quot;summer2025_dresses&quot;, &quot;black_friday_2025&quot;</span>
</span><span id="__span-4-67"><a id="__codelineno-4-67" name="__codelineno-4-67" href="#__codelineno-4-67"></a>                        <span class="c1">// Помогает понять какая кампания привела пользователя</span>
</span><span id="__span-4-68"><a id="__codelineno-4-68" name="__codelineno-4-68" href="#__codelineno-4-68"></a>                        <span class="s">&quot;adjust_campaign&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">campaign</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-4-69"><a id="__codelineno-4-69" name="__codelineno-4-69" href="#__codelineno-4-69"></a>
</span><span id="__span-4-70"><a id="__codelineno-4-70" name="__codelineno-4-70" href="#__codelineno-4-70"></a>                        <span class="c1">// 🎨 adjust_creative - креатив/баннер рекламы</span>
</span><span id="__span-4-71"><a id="__codelineno-4-71" name="__codelineno-4-71" href="#__codelineno-4-71"></a>                        <span class="c1">// Пример: &quot;video_banner&quot;, &quot;story_ad&quot;, &quot;carousel_ad&quot;</span>
</span><span id="__span-4-72"><a id="__codelineno-4-72" name="__codelineno-4-72" href="#__codelineno-4-72"></a>                        <span class="c1">// Показывает какой именно рекламный материал сработал</span>
</span><span id="__span-4-73"><a id="__codelineno-4-73" name="__codelineno-4-73" href="#__codelineno-4-73"></a>                        <span class="s">&quot;adjust_creative&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">creative</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-4-74"><a id="__codelineno-4-74" name="__codelineno-4-74" href="#__codelineno-4-74"></a>
</span><span id="__span-4-75"><a id="__codelineno-4-75" name="__codelineno-4-75" href="#__codelineno-4-75"></a>                        <span class="c1">// 🏷️ adjust_click_label - дополнительная метка клика</span>
</span><span id="__span-4-76"><a id="__codelineno-4-76" name="__codelineno-4-76" href="#__codelineno-4-76"></a>                        <span class="c1">// Используется для детализации: &quot;premium_dresses&quot;, &quot;discount_30%&quot;</span>
</span><span id="__span-4-77"><a id="__codelineno-4-77" name="__codelineno-4-77" href="#__codelineno-4-77"></a>                        <span class="c1">// Помогает понять на что именно кликнул пользователь</span>
</span><span id="__span-4-78"><a id="__codelineno-4-78" name="__codelineno-4-78" href="#__codelineno-4-78"></a>                        <span class="s">&quot;adjust_click_label&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">clickLabel</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-4-79"><a id="__codelineno-4-79" name="__codelineno-4-79" href="#__codelineno-4-79"></a>
</span><span id="__span-4-80"><a id="__codelineno-4-80" name="__codelineno-4-80" href="#__codelineno-4-80"></a>                        <span class="c1">// 📱 adjust_adid - уникальный идентификатор устройства в Adjust</span>
</span><span id="__span-4-81"><a id="__codelineno-4-81" name="__codelineno-4-81" href="#__codelineno-4-81"></a>                        <span class="c1">// Постоянный ID устройства, не меняется при переустановке приложения</span>
</span><span id="__span-4-82"><a id="__codelineno-4-82" name="__codelineno-4-82" href="#__codelineno-4-82"></a>                        <span class="c1">// Используется для связывания данных между сессиями</span>
</span><span id="__span-4-83"><a id="__codelineno-4-83" name="__codelineno-4-83" href="#__codelineno-4-83"></a>                        <span class="s">&quot;adjust_adid&quot;</span><span class="p">:</span> <span class="n">Adjust</span><span class="p">.</span><span class="n">adid</span><span class="p">()</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-4-84"><a id="__codelineno-4-84" name="__codelineno-4-84" href="#__codelineno-4-84"></a>
</span><span id="__span-4-85"><a id="__codelineno-4-85" name="__codelineno-4-85" href="#__codelineno-4-85"></a>                        <span class="c1">// 🆕 is_first_launch - первый ли это запуск приложения</span>
</span><span id="__span-4-86"><a id="__codelineno-4-86" name="__codelineno-4-86" href="#__codelineno-4-86"></a>                        <span class="c1">// true = пользователь установил приложение впервые</span>
</span><span id="__span-4-87"><a id="__codelineno-4-87" name="__codelineno-4-87" href="#__codelineno-4-87"></a>                        <span class="c1">// false = пользователь уже запускал приложение раньше</span>
</span><span id="__span-4-88"><a id="__codelineno-4-88" name="__codelineno-4-88" href="#__codelineno-4-88"></a>                        <span class="s">&quot;is_first_launch&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">isFirstLaunch</span> <span class="p">??</span> <span class="kc">false</span><span class="p">,</span>
</span><span id="__span-4-89"><a id="__codelineno-4-89" name="__codelineno-4-89" href="#__codelineno-4-89"></a>
</span><span id="__span-4-90"><a id="__codelineno-4-90" name="__codelineno-4-90" href="#__codelineno-4-90"></a>                        <span class="c1">// 🔗 UTM параметры для корректной атрибуции - стандарт веб-аналитики</span>
</span><span id="__span-4-91"><a id="__codelineno-4-91" name="__codelineno-4-91" href="#__codelineno-4-91"></a>
</span><span id="__span-4-92"><a id="__codelineno-4-92" name="__codelineno-4-92" href="#__codelineno-4-92"></a>                        <span class="c1">// 📍 utm_source - источник трафика (тот же что и adjust_network)</span>
</span><span id="__span-4-93"><a id="__codelineno-4-93" name="__codelineno-4-93" href="#__codelineno-4-93"></a>                        <span class="c1">// Используется для совместимости с веб-аналитикой</span>
</span><span id="__span-4-94"><a id="__codelineno-4-94" name="__codelineno-4-94" href="#__codelineno-4-94"></a>                        <span class="s">&quot;utm_source&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">network</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-4-95"><a id="__codelineno-4-95" name="__codelineno-4-95" href="#__codelineno-4-95"></a>
</span><span id="__span-4-96"><a id="__codelineno-4-96" name="__codelineno-4-96" href="#__codelineno-4-96"></a>                        <span class="c1">// 📢 utm_campaign - название кампании (тот же что и adjust_campaign)</span>
</span><span id="__span-4-97"><a id="__codelineno-4-97" name="__codelineno-4-97" href="#__codelineno-4-97"></a>                        <span class="c1">// Стандартный параметр для всех аналитических систем</span>
</span><span id="__span-4-98"><a id="__codelineno-4-98" name="__codelineno-4-98" href="#__codelineno-4-98"></a>                        <span class="s">&quot;utm_campaign&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">campaign</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-4-99"><a id="__codelineno-4-99" name="__codelineno-4-99" href="#__codelineno-4-99"></a>
</span><span id="__span-4-100"><a id="__codelineno-4-100" name="__codelineno-4-100" href="#__codelineno-4-100"></a>                        <span class="c1">// 🎨 utm_content - контент рекламы (тот же что и adjust_creative)</span>
</span><span id="__span-4-101"><a id="__codelineno-4-101" name="__codelineno-4-101" href="#__codelineno-4-101"></a>                        <span class="s">&quot;utm_content&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">creative</span> <span class="p">??</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-4-102"><a id="__codelineno-4-102" name="__codelineno-4-102" href="#__codelineno-4-102"></a>
</span><span id="__span-4-103"><a id="__codelineno-4-103" name="__codelineno-4-103" href="#__codelineno-4-103"></a>                        <span class="c1">// 📊 utm_medium - канал рекламы (пустой, восстанавливается в Rick.ai)</span>
</span><span id="__span-4-104"><a id="__codelineno-4-104" name="__codelineno-4-104" href="#__codelineno-4-104"></a>                        <span class="c1">// Примеры: &quot;cpc&quot;, &quot;banner&quot;, &quot;video&quot;, &quot;social&quot;</span>
</span><span id="__span-4-105"><a id="__codelineno-4-105" name="__codelineno-4-105" href="#__codelineno-4-105"></a>                        <span class="c1">// Восстанавливается автоматически по правилам Rick.ai</span>
</span><span id="__span-4-106"><a id="__codelineno-4-106" name="__codelineno-4-106" href="#__codelineno-4-106"></a>                        <span class="s">&quot;utm_medium&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-4-107"><a id="__codelineno-4-107" name="__codelineno-4-107" href="#__codelineno-4-107"></a>
</span><span id="__span-4-108"><a id="__codelineno-4-108" name="__codelineno-4-108" href="#__codelineno-4-108"></a>                        <span class="c1">// ⏰ Дополнительные параметры для аналитики</span>
</span><span id="__span-4-109"><a id="__codelineno-4-109" name="__codelineno-4-109" href="#__codelineno-4-109"></a>
</span><span id="__span-4-110"><a id="__codelineno-4-110" name="__codelineno-4-110" href="#__codelineno-4-110"></a>                        <span class="c1">// 🕐 attribution_timestamp - время получения атрибуции</span>
</span><span id="__span-4-111"><a id="__codelineno-4-111" name="__codelineno-4-111" href="#__codelineno-4-111"></a>                        <span class="c1">// Unix timestamp (секунды с 1970 года)</span>
</span><span id="__span-4-112"><a id="__codelineno-4-112" name="__codelineno-4-112" href="#__codelineno-4-112"></a>                        <span class="c1">// Нужен для анализа времени между кликом и установкой</span>
</span><span id="__span-4-113"><a id="__codelineno-4-113" name="__codelineno-4-113" href="#__codelineno-4-113"></a>                        <span class="s">&quot;attribution_timestamp&quot;</span><span class="p">:</span> <span class="n">Date</span><span class="p">().</span><span class="n">timeIntervalSince1970</span><span class="p">,</span>
</span><span id="__span-4-114"><a id="__codelineno-4-114" name="__codelineno-4-114" href="#__codelineno-4-114"></a>
</span><span id="__span-4-115"><a id="__codelineno-4-115" name="__codelineno-4-115" href="#__codelineno-4-115"></a>                        <span class="c1">// 📈 attribution_type - тип атрибуции</span>
</span><span id="__span-4-116"><a id="__codelineno-4-116" name="__codelineno-4-116" href="#__codelineno-4-116"></a>                        <span class="c1">// &quot;install&quot; = новый пользователь установил приложение</span>
</span><span id="__span-4-117"><a id="__codelineno-4-117" name="__codelineno-4-117" href="#__codelineno-4-117"></a>                        <span class="c1">// &quot;reinstall&quot; = существующий пользователь переустановил приложение</span>
</span><span id="__span-4-118"><a id="__codelineno-4-118" name="__codelineno-4-118" href="#__codelineno-4-118"></a>                        <span class="s">&quot;attribution_type&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">isFirstLaunch</span> <span class="p">==</span> <span class="kc">true</span> <span class="p">?</span> <span class="s">&quot;install&quot;</span> <span class="p">:</span> <span class="s">&quot;reinstall&quot;</span>
</span><span id="__span-4-119"><a id="__codelineno-4-119" name="__codelineno-4-119" href="#__codelineno-4-119"></a>                    <span class="p">]</span>
</span><span id="__span-4-120"><a id="__codelineno-4-120" name="__codelineno-4-120" href="#__codelineno-4-120"></a>
</span><span id="__span-4-121"><a id="__codelineno-4-121" name="__codelineno-4-121" href="#__codelineno-4-121"></a>                    <span class="c1">// ✅ Отправляем событие в AppMetrica с adjust_adid</span>
</span><span id="__span-4-122"><a id="__codelineno-4-122" name="__codelineno-4-122" href="#__codelineno-4-122"></a>                    <span class="kd">let</span> <span class="nv">adjustAdid</span> <span class="p">=</span> <span class="n">Adjust</span><span class="p">.</span><span class="n">adid</span><span class="p">()</span>
</span><span id="__span-4-123"><a id="__codelineno-4-123" name="__codelineno-4-123" href="#__codelineno-4-123"></a>                    <span class="kd">var</span> <span class="nv">paramsWithAdjustID</span> <span class="p">=</span> <span class="n">params</span>
</span><span id="__span-4-124"><a id="__codelineno-4-124" name="__codelineno-4-124" href="#__codelineno-4-124"></a>                    <span class="n">paramsWithAdjustID</span><span class="p">[</span><span class="s">&quot;adjust_adid&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">adjustAdid</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span>
</span><span id="__span-4-125"><a id="__codelineno-4-125" name="__codelineno-4-125" href="#__codelineno-4-125"></a>                    <span class="n">AppMetrica</span><span class="p">.</span><span class="n">reportEvent</span><span class="p">(</span><span class="s">&quot;adjust attributed utm params&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">paramsWithAdjustID</span><span class="p">)</span>
</span><span id="__span-4-126"><a id="__codelineno-4-126" name="__codelineno-4-126" href="#__codelineno-4-126"></a>
</span><span id="__span-4-127"><a id="__codelineno-4-127" name="__codelineno-4-127" href="#__codelineno-4-127"></a>                    <span class="c1">// 🔄 ОБМЕН ИДЕНТИФИКАТОРАМИ: Записываем adjust_adid в AppMetrica</span>
</span><span id="__span-4-128"><a id="__codelineno-4-128" name="__codelineno-4-128" href="#__codelineno-4-128"></a>                    <span class="c1">// Это позволяет связывать данные между Adjust и AppMetrica</span>
</span><span id="__span-4-129"><a id="__codelineno-4-129" name="__codelineno-4-129" href="#__codelineno-4-129"></a>                    <span class="k">if</span> <span class="kd">let</span> <span class="nv">adjustAdid</span> <span class="p">=</span> <span class="n">Adjust</span><span class="p">.</span><span class="n">adid</span><span class="p">()</span> <span class="p">{</span>
</span><span id="__span-4-130"><a id="__codelineno-4-130" name="__codelineno-4-130" href="#__codelineno-4-130"></a>                        <span class="c1">// setUserProfileID - устанавливает постоянный ID пользователя в AppMetrica</span>
</span><span id="__span-4-131"><a id="__codelineno-4-131" name="__codelineno-4-131" href="#__codelineno-4-131"></a>                        <span class="c1">// ⚠️ ВАЖНО: adjust_adid НЕ добавляется в каждое событие!</span>
</span><span id="__span-4-132"><a id="__codelineno-4-132" name="__codelineno-4-132" href="#__codelineno-4-132"></a>                        <span class="c1">// Вместо этого AppMetrica автоматически связывает ВСЕ события пользователя с этим ID</span>
</span><span id="__span-4-133"><a id="__codelineno-4-133" name="__codelineno-4-133" href="#__codelineno-4-133"></a>                        <span class="c1">// Это более эффективно чем добавлять adjust_adid в каждое событие</span>
</span><span id="__span-4-134"><a id="__codelineno-4-134" name="__codelineno-4-134" href="#__codelineno-4-134"></a>                        <span class="n">AppMetrica</span><span class="p">.</span><span class="n">setUserProfileID</span><span class="p">(</span><span class="n">adjustAdid</span><span class="p">)</span>
</span><span id="__span-4-135"><a id="__codelineno-4-135" name="__codelineno-4-135" href="#__codelineno-4-135"></a>                        <span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Adjust ADID записан в AppMetrica: </span><span class="si">\(</span><span class="n">adjustAdid</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
</span><span id="__span-4-136"><a id="__codelineno-4-136" name="__codelineno-4-136" href="#__codelineno-4-136"></a>
</span><span id="__span-4-137"><a id="__codelineno-4-137" name="__codelineno-4-137" href="#__codelineno-4-137"></a>                        <span class="c1">// 📊 Отправляем специальное событие с adjust_adid для аналитики</span>
</span><span id="__span-4-138"><a id="__codelineno-4-138" name="__codelineno-4-138" href="#__codelineno-4-138"></a>                        <span class="c1">// Это событие поможет отследить связь между Adjust и AppMetrica</span>
</span><span id="__span-4-139"><a id="__codelineno-4-139" name="__codelineno-4-139" href="#__codelineno-4-139"></a>                        <span class="n">AppMetrica</span><span class="p">.</span><span class="n">reportEvent</span><span class="p">(</span><span class="s">&quot;adjust_id_synced&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-4-140"><a id="__codelineno-4-140" name="__codelineno-4-140" href="#__codelineno-4-140"></a>                            <span class="s">&quot;adjust_adid&quot;</span><span class="p">:</span> <span class="n">adjustAdid</span><span class="p">,</span>
</span><span id="__span-4-141"><a id="__codelineno-4-141" name="__codelineno-4-141" href="#__codelineno-4-141"></a>                            <span class="s">&quot;appmetrica_device_id&quot;</span><span class="p">:</span> <span class="n">AppMetrica</span><span class="p">.</span><span class="n">deviceID</span><span class="p">()</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-4-142"><a id="__codelineno-4-142" name="__codelineno-4-142" href="#__codelineno-4-142"></a>                            <span class="s">&quot;sync_timestamp&quot;</span><span class="p">:</span> <span class="n">Date</span><span class="p">().</span><span class="n">timeIntervalSince1970</span>
</span><span id="__span-4-143"><a id="__codelineno-4-143" name="__codelineno-4-143" href="#__codelineno-4-143"></a>                        <span class="p">])</span>
</span><span id="__span-4-144"><a id="__codelineno-4-144" name="__codelineno-4-144" href="#__codelineno-4-144"></a>                    <span class="p">}</span>
</span><span id="__span-4-145"><a id="__codelineno-4-145" name="__codelineno-4-145" href="#__codelineno-4-145"></a>
</span><span id="__span-4-146"><a id="__codelineno-4-146" name="__codelineno-4-146" href="#__codelineno-4-146"></a>                    <span class="c1">// 🔄 ОБМЕН ИДЕНТИФИКАТОРАМИ: Записываем appmetrica_device_id в Adjust</span>
</span><span id="__span-4-147"><a id="__codelineno-4-147" name="__codelineno-4-147" href="#__codelineno-4-147"></a>                    <span class="c1">// Это позволяет Adjust знать ID устройства из AppMetrica для связывания данных</span>
</span><span id="__span-4-148"><a id="__codelineno-4-148" name="__codelineno-4-148" href="#__codelineno-4-148"></a>                    <span class="k">if</span> <span class="kd">let</span> <span class="nv">appMetricaDeviceId</span> <span class="p">=</span> <span class="n">AppMetrica</span><span class="p">.</span><span class="n">deviceID</span><span class="p">()</span> <span class="p">{</span>
</span><span id="__span-4-149"><a id="__codelineno-4-149" name="__codelineno-4-149" href="#__codelineno-4-149"></a>                        <span class="c1">// Создаем специальное событие в Adjust для синхронизации ID</span>
</span><span id="__span-4-150"><a id="__codelineno-4-150" name="__codelineno-4-150" href="#__codelineno-4-150"></a>                        <span class="kd">let</span> <span class="nv">adjustEvent</span> <span class="p">=</span> <span class="n">ADJEvent</span><span class="p">(</span><span class="n">eventToken</span><span class="p">:</span> <span class="s">&quot;YOUR_DEVICE_ID_SYNC_TOKEN&quot;</span><span class="p">)</span>
</span><span id="__span-4-151"><a id="__codelineno-4-151" name="__codelineno-4-151" href="#__codelineno-4-151"></a>
</span><span id="__span-4-152"><a id="__codelineno-4-152" name="__codelineno-4-152" href="#__codelineno-4-152"></a>                        <span class="c1">// addCallbackParameter - добавляет параметр к событию</span>
</span><span id="__span-4-153"><a id="__codelineno-4-153" name="__codelineno-4-153" href="#__codelineno-4-153"></a>                        <span class="c1">// ⚠️ ВАЖНО: appmetrica_device_id добавляется ТОЛЬКО в это специальное событие</span>
</span><span id="__span-4-154"><a id="__codelineno-4-154" name="__codelineno-4-154" href="#__codelineno-4-154"></a>                        <span class="c1">// Adjust НЕ будет автоматически добавлять его во все события</span>
</span><span id="__span-4-155"><a id="__codelineno-4-155" name="__codelineno-4-155" href="#__codelineno-4-155"></a>                        <span class="c1">// Это отличается от AppMetrica.setUserProfileID()</span>
</span><span id="__span-4-156"><a id="__codelineno-4-156" name="__codelineno-4-156" href="#__codelineno-4-156"></a>                        <span class="n">adjustEvent</span><span class="p">?.</span><span class="n">addCallbackParameter</span><span class="p">(</span><span class="s">&quot;appmetrica_device_id&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">appMetricaDeviceId</span><span class="p">)</span>
</span><span id="__span-4-157"><a id="__codelineno-4-157" name="__codelineno-4-157" href="#__codelineno-4-157"></a>                        <span class="n">adjustEvent</span><span class="p">?.</span><span class="n">addCallbackParameter</span><span class="p">(</span><span class="s">&quot;sync_timestamp&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">String</span><span class="p">(</span><span class="n">Date</span><span class="p">().</span><span class="n">timeIntervalSince1970</span><span class="p">))</span>
</span><span id="__span-4-158"><a id="__codelineno-4-158" name="__codelineno-4-158" href="#__codelineno-4-158"></a>
</span><span id="__span-4-159"><a id="__codelineno-4-159" name="__codelineno-4-159" href="#__codelineno-4-159"></a>                        <span class="c1">// trackEvent - отправляет событие в Adjust</span>
</span><span id="__span-4-160"><a id="__codelineno-4-160" name="__codelineno-4-160" href="#__codelineno-4-160"></a>                        <span class="n">Adjust</span><span class="p">.</span><span class="n">trackEvent</span><span class="p">(</span><span class="n">adjustEvent</span><span class="p">)</span>
</span><span id="__span-4-161"><a id="__codelineno-4-161" name="__codelineno-4-161" href="#__codelineno-4-161"></a>                        <span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;AppMetrica Device ID записан в Adjust: </span><span class="si">\(</span><span class="n">appMetricaDeviceId</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
</span><span id="__span-4-162"><a id="__codelineno-4-162" name="__codelineno-4-162" href="#__codelineno-4-162"></a>                    <span class="p">}</span>
</span><span id="__span-4-163"><a id="__codelineno-4-163" name="__codelineno-4-163" href="#__codelineno-4-163"></a>
</span><span id="__span-4-164"><a id="__codelineno-4-164" name="__codelineno-4-164" href="#__codelineno-4-164"></a>                    <span class="c1">// Логирование в flow.rick.ai</span>
</span><span id="__span-4-165"><a id="__codelineno-4-165" name="__codelineno-4-165" href="#__codelineno-4-165"></a>                    <span class="kc">self</span><span class="p">.</span><span class="n">logToRickAI</span><span class="p">(</span><span class="n">attribution</span><span class="p">:</span> <span class="n">attribution</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">params</span><span class="p">)</span>
</span><span id="__span-4-166"><a id="__codelineno-4-166" name="__codelineno-4-166" href="#__codelineno-4-166"></a>                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-4-167"><a id="__codelineno-4-167" name="__codelineno-4-167" href="#__codelineno-4-167"></a>                    <span class="kc">self</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;AppMetrica не активирована при получении attribution&quot;</span><span class="p">)</span>
</span><span id="__span-4-168"><a id="__codelineno-4-168" name="__codelineno-4-168" href="#__codelineno-4-168"></a>                <span class="p">}</span>
</span><span id="__span-4-169"><a id="__codelineno-4-169" name="__codelineno-4-169" href="#__codelineno-4-169"></a>            <span class="p">}</span>
</span><span id="__span-4-170"><a id="__codelineno-4-170" name="__codelineno-4-170" href="#__codelineno-4-170"></a>        <span class="p">}</span>
</span><span id="__span-4-171"><a id="__codelineno-4-171" name="__codelineno-4-171" href="#__codelineno-4-171"></a>
</span><span id="__span-4-172"><a id="__codelineno-4-172" name="__codelineno-4-172" href="#__codelineno-4-172"></a>        <span class="n">Adjust</span><span class="p">.</span><span class="n">appDidLaunch</span><span class="p">(</span><span class="n">adjustConfig</span><span class="p">)</span>
</span><span id="__span-4-173"><a id="__codelineno-4-173" name="__codelineno-4-173" href="#__codelineno-4-173"></a>
</span><span id="__span-4-174"><a id="__codelineno-4-174" name="__codelineno-4-174" href="#__codelineno-4-174"></a>        <span class="c1">// ✅ ОБМЕН ИДЕНТИФИКАТОРАМИ: Синхронизация при запуске приложения</span>
</span><span id="__span-4-175"><a id="__codelineno-4-175" name="__codelineno-4-175" href="#__codelineno-4-175"></a>        <span class="n">DispatchQueue</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">asyncAfter</span><span class="p">(</span><span class="n">deadline</span><span class="p">:</span> <span class="p">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="mf">2.0</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-4-176"><a id="__codelineno-4-176" name="__codelineno-4-176" href="#__codelineno-4-176"></a>            <span class="kc">self</span><span class="p">.</span><span class="n">syncDeviceIdentifiers</span><span class="p">()</span>
</span><span id="__span-4-177"><a id="__codelineno-4-177" name="__codelineno-4-177" href="#__codelineno-4-177"></a>        <span class="p">}</span>
</span><span id="__span-4-178"><a id="__codelineno-4-178" name="__codelineno-4-178" href="#__codelineno-4-178"></a>
</span><span id="__span-4-179"><a id="__codelineno-4-179" name="__codelineno-4-179" href="#__codelineno-4-179"></a>        <span class="c1">// 🔒 3. Запрашиваем разрешение на трекинг (iOS 14.5+)</span>
</span><span id="__span-4-180"><a id="__codelineno-4-180" name="__codelineno-4-180" href="#__codelineno-4-180"></a>        <span class="c1">// App Tracking Transparency (ATT) - система Apple для защиты конфиденциальности</span>
</span><span id="__span-4-181"><a id="__codelineno-4-181" name="__codelineno-4-181" href="#__codelineno-4-181"></a>        <span class="c1">// Пользователь должен дать разрешение на использование IDFA (рекламный идентификатор)</span>
</span><span id="__span-4-182"><a id="__codelineno-4-182" name="__codelineno-4-182" href="#__codelineno-4-182"></a>        <span class="c1">// Если не дают разрешение, то Adjust работает без IDFA (ограниченная атрибуция)</span>
</span><span id="__span-4-183"><a id="__codelineno-4-183" name="__codelineno-4-183" href="#__codelineno-4-183"></a>
</span><span id="__span-4-184"><a id="__codelineno-4-184" name="__codelineno-4-184" href="#__codelineno-4-184"></a>        <span class="c1">// asyncAfter - выполняем код через 1 секунду после запуска</span>
</span><span id="__span-4-185"><a id="__codelineno-4-185" name="__codelineno-4-185" href="#__codelineno-4-185"></a>        <span class="c1">// Это требование Apple - нельзя запрашивать разрешение сразу при запуске</span>
</span><span id="__span-4-186"><a id="__codelineno-4-186" name="__codelineno-4-186" href="#__codelineno-4-186"></a>        <span class="n">DispatchQueue</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">asyncAfter</span><span class="p">(</span><span class="n">deadline</span><span class="p">:</span> <span class="p">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-4-187"><a id="__codelineno-4-187" name="__codelineno-4-187" href="#__codelineno-4-187"></a>            <span class="kc">self</span><span class="p">.</span><span class="n">requestTrackingAuthorization</span><span class="p">()</span>
</span><span id="__span-4-188"><a id="__codelineno-4-188" name="__codelineno-4-188" href="#__codelineno-4-188"></a>        <span class="p">}</span>
</span><span id="__span-4-189"><a id="__codelineno-4-189" name="__codelineno-4-189" href="#__codelineno-4-189"></a>
</span><span id="__span-4-190"><a id="__codelineno-4-190" name="__codelineno-4-190" href="#__codelineno-4-190"></a>        <span class="k">return</span> <span class="kc">true</span>
</span><span id="__span-4-191"><a id="__codelineno-4-191" name="__codelineno-4-191" href="#__codelineno-4-191"></a>    <span class="p">}</span>
</span><span id="__span-4-192"><a id="__codelineno-4-192" name="__codelineno-4-192" href="#__codelineno-4-192"></a>
</span><span id="__span-4-193"><a id="__codelineno-4-193" name="__codelineno-4-193" href="#__codelineno-4-193"></a>    <span class="c1">// </span><span class="cs">MARK:</span><span class="c1"> - App Tracking Transparency (ATT)</span>
</span><span id="__span-4-194"><a id="__codelineno-4-194" name="__codelineno-4-194" href="#__codelineno-4-194"></a>    <span class="c1">// 🔒 Система Apple для защиты конфиденциальности пользователей</span>
</span><span id="__span-4-195"><a id="__codelineno-4-195" name="__codelineno-4-195" href="#__codelineno-4-195"></a>
</span><span id="__span-4-196"><a id="__codelineno-4-196" name="__codelineno-4-196" href="#__codelineno-4-196"></a>    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">requestTrackingAuthorization</span><span class="p">()</span> <span class="p">{</span>
</span><span id="__span-4-197"><a id="__codelineno-4-197" name="__codelineno-4-197" href="#__codelineno-4-197"></a>        <span class="c1">// #available(iOS 14.5, *) - проверяем доступность ATT (только с iOS 14.5)</span>
</span><span id="__span-4-198"><a id="__codelineno-4-198" name="__codelineno-4-198" href="#__codelineno-4-198"></a>        <span class="k">if</span> <span class="cp">#available</span><span class="p">(</span><span class="cp">iOS</span> <span class="mf">14.5</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-4-199"><a id="__codelineno-4-199" name="__codelineno-4-199" href="#__codelineno-4-199"></a>            <span class="c1">// requestTrackingAuthorization - запрашиваем разрешение на трекинг</span>
</span><span id="__span-4-200"><a id="__codelineno-4-200" name="__codelineno-4-200" href="#__codelineno-4-200"></a>            <span class="c1">// Показывает пользователю диалог с объяснением зачем нужны данные</span>
</span><span id="__span-4-201"><a id="__codelineno-4-201" name="__codelineno-4-201" href="#__codelineno-4-201"></a>            <span class="bp">ATTrackingManager</span><span class="p">.</span><span class="n">requestTrackingAuthorization</span> <span class="p">{</span> <span class="n">status</span> <span class="k">in</span>
</span><span id="__span-4-202"><a id="__codelineno-4-202" name="__codelineno-4-202" href="#__codelineno-4-202"></a>                <span class="c1">// Обработка результата должна быть на главном потоке (UI)</span>
</span><span id="__span-4-203"><a id="__codelineno-4-203" name="__codelineno-4-203" href="#__codelineno-4-203"></a>                <span class="n">DispatchQueue</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="k">async</span> <span class="p">{</span>
</span><span id="__span-4-204"><a id="__codelineno-4-204" name="__codelineno-4-204" href="#__codelineno-4-204"></a>                    <span class="kc">self</span><span class="p">.</span><span class="n">handleTrackingAuthorizationStatus</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
</span><span id="__span-4-205"><a id="__codelineno-4-205" name="__codelineno-4-205" href="#__codelineno-4-205"></a>                <span class="p">}</span>
</span><span id="__span-4-206"><a id="__codelineno-4-206" name="__codelineno-4-206" href="#__codelineno-4-206"></a>            <span class="p">}</span>
</span><span id="__span-4-207"><a id="__codelineno-4-207" name="__codelineno-4-207" href="#__codelineno-4-207"></a>        <span class="p">}</span>
</span><span id="__span-4-208"><a id="__codelineno-4-208" name="__codelineno-4-208" href="#__codelineno-4-208"></a>    <span class="p">}</span>
</span><span id="__span-4-209"><a id="__codelineno-4-209" name="__codelineno-4-209" href="#__codelineno-4-209"></a>
</span><span id="__span-4-210"><a id="__codelineno-4-210" name="__codelineno-4-210" href="#__codelineno-4-210"></a>    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">handleTrackingAuthorizationStatus</span><span class="p">(</span><span class="kc">_</span> <span class="n">status</span><span class="p">:</span> <span class="bp">ATTrackingManager</span><span class="p">.</span><span class="n">AuthorizationStatus</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-4-211"><a id="__codelineno-4-211" name="__codelineno-4-211" href="#__codelineno-4-211"></a>        <span class="c1">// Обрабатываем результат запроса разрешения на трекинг</span>
</span><span id="__span-4-212"><a id="__codelineno-4-212" name="__codelineno-4-212" href="#__codelineno-4-212"></a>        <span class="k">switch</span> <span class="n">status</span> <span class="p">{</span>
</span><span id="__span-4-213"><a id="__codelineno-4-213" name="__codelineno-4-213" href="#__codelineno-4-213"></a>        <span class="k">case</span> <span class="p">.</span><span class="n">authorized</span><span class="p">:</span>
</span><span id="__span-4-214"><a id="__codelineno-4-214" name="__codelineno-4-214" href="#__codelineno-4-214"></a>            <span class="c1">// ✅ Пользователь разрешил трекинг - получаем IDFA</span>
</span><span id="__span-4-215"><a id="__codelineno-4-215" name="__codelineno-4-215" href="#__codelineno-4-215"></a>            <span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Пользователь разрешил трекинг - получаем IDFA&quot;</span><span class="p">)</span>
</span><span id="__span-4-216"><a id="__codelineno-4-216" name="__codelineno-4-216" href="#__codelineno-4-216"></a>
</span><span id="__span-4-217"><a id="__codelineno-4-217" name="__codelineno-4-217" href="#__codelineno-4-217"></a>            <span class="c1">// IDFA (Identifier for Advertisers) - уникальный рекламный идентификатор</span>
</span><span id="__span-4-218"><a id="__codelineno-4-218" name="__codelineno-4-218" href="#__codelineno-4-218"></a>            <span class="c1">// Доступен для Adjust и AppMetrica для точной атрибуции</span>
</span><span id="__span-4-219"><a id="__codelineno-4-219" name="__codelineno-4-219" href="#__codelineno-4-219"></a>            <span class="kd">let</span> <span class="nv">idfa</span> <span class="p">=</span> <span class="bp">ASIdentifierManager</span><span class="p">.</span><span class="n">shared</span><span class="p">().</span><span class="n">advertisingIdentifier</span><span class="p">.</span><span class="n">uuidString</span>
</span><span id="__span-4-220"><a id="__codelineno-4-220" name="__codelineno-4-220" href="#__codelineno-4-220"></a>            <span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;IDFA получен: </span><span class="si">\(</span><span class="n">idfa</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
</span><span id="__span-4-221"><a id="__codelineno-4-221" name="__codelineno-4-221" href="#__codelineno-4-221"></a>
</span><span id="__span-4-222"><a id="__codelineno-4-222" name="__codelineno-4-222" href="#__codelineno-4-222"></a>        <span class="k">case</span> <span class="p">.</span><span class="n">denied</span><span class="p">:</span>
</span><span id="__span-4-223"><a id="__codelineno-4-223" name="__codelineno-4-223" href="#__codelineno-4-223"></a>            <span class="c1">// ❌ Пользователь отказал в трекинге - используем ограниченную аналитику</span>
</span><span id="__span-4-224"><a id="__codelineno-4-224" name="__codelineno-4-224" href="#__codelineno-4-224"></a>            <span class="n">logger</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Пользователь отказал в трекинге - используем ограниченную аналитику&quot;</span><span class="p">)</span>
</span><span id="__span-4-225"><a id="__codelineno-4-225" name="__codelineno-4-225" href="#__codelineno-4-225"></a>
</span><span id="__span-4-226"><a id="__codelineno-4-226" name="__codelineno-4-226" href="#__codelineno-4-226"></a>            <span class="c1">// ✅ Отправляем событие об отказе с adjust_adid</span>
</span><span id="__span-4-227"><a id="__codelineno-4-227" name="__codelineno-4-227" href="#__codelineno-4-227"></a>            <span class="kd">let</span> <span class="nv">adjustAdid</span> <span class="p">=</span> <span class="n">Adjust</span><span class="p">.</span><span class="n">adid</span><span class="p">()</span>
</span><span id="__span-4-228"><a id="__codelineno-4-228" name="__codelineno-4-228" href="#__codelineno-4-228"></a>            <span class="n">AppMetrica</span><span class="p">.</span><span class="n">reportEvent</span><span class="p">(</span><span class="s">&quot;tracking_denied&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-4-229"><a id="__codelineno-4-229" name="__codelineno-4-229" href="#__codelineno-4-229"></a>                <span class="s">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">Date</span><span class="p">().</span><span class="n">timeIntervalSince1970</span><span class="p">,</span>
</span><span id="__span-4-230"><a id="__codelineno-4-230" name="__codelineno-4-230" href="#__codelineno-4-230"></a>                <span class="s">&quot;platform&quot;</span><span class="p">:</span> <span class="s">&quot;ios&quot;</span><span class="p">,</span>
</span><span id="__span-4-231"><a id="__codelineno-4-231" name="__codelineno-4-231" href="#__codelineno-4-231"></a>                <span class="s">&quot;adjust_adid&quot;</span><span class="p">:</span> <span class="n">adjustAdid</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span>
</span><span id="__span-4-232"><a id="__codelineno-4-232" name="__codelineno-4-232" href="#__codelineno-4-232"></a>            <span class="p">])</span>
</span><span id="__span-4-233"><a id="__codelineno-4-233" name="__codelineno-4-233" href="#__codelineno-4-233"></a>
</span><span id="__span-4-234"><a id="__codelineno-4-234" name="__codelineno-4-234" href="#__codelineno-4-234"></a>        <span class="k">case</span> <span class="p">.</span><span class="n">restricted</span><span class="p">:</span>
</span><span id="__span-4-235"><a id="__codelineno-4-235" name="__codelineno-4-235" href="#__codelineno-4-235"></a>            <span class="n">logger</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Трекинг ограничен системой - используем ограниченную аналитику&quot;</span><span class="p">)</span>
</span><span id="__span-4-236"><a id="__codelineno-4-236" name="__codelineno-4-236" href="#__codelineno-4-236"></a>            <span class="c1">// ✅ Отправляем событие с adjust_adid</span>
</span><span id="__span-4-237"><a id="__codelineno-4-237" name="__codelineno-4-237" href="#__codelineno-4-237"></a>            <span class="kd">let</span> <span class="nv">adjustAdid</span> <span class="p">=</span> <span class="n">Adjust</span><span class="p">.</span><span class="n">adid</span><span class="p">()</span>
</span><span id="__span-4-238"><a id="__codelineno-4-238" name="__codelineno-4-238" href="#__codelineno-4-238"></a>            <span class="n">AppMetrica</span><span class="p">.</span><span class="n">reportEvent</span><span class="p">(</span><span class="s">&quot;tracking_restricted&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-4-239"><a id="__codelineno-4-239" name="__codelineno-4-239" href="#__codelineno-4-239"></a>                <span class="s">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">Date</span><span class="p">().</span><span class="n">timeIntervalSince1970</span><span class="p">,</span>
</span><span id="__span-4-240"><a id="__codelineno-4-240" name="__codelineno-4-240" href="#__codelineno-4-240"></a>                <span class="s">&quot;platform&quot;</span><span class="p">:</span> <span class="s">&quot;ios&quot;</span><span class="p">,</span>
</span><span id="__span-4-241"><a id="__codelineno-4-241" name="__codelineno-4-241" href="#__codelineno-4-241"></a>                <span class="s">&quot;adjust_adid&quot;</span><span class="p">:</span> <span class="n">adjustAdid</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span>
</span><span id="__span-4-242"><a id="__codelineno-4-242" name="__codelineno-4-242" href="#__codelineno-4-242"></a>            <span class="p">])</span>
</span><span id="__span-4-243"><a id="__codelineno-4-243" name="__codelineno-4-243" href="#__codelineno-4-243"></a>
</span><span id="__span-4-244"><a id="__codelineno-4-244" name="__codelineno-4-244" href="#__codelineno-4-244"></a>        <span class="k">case</span> <span class="p">.</span><span class="n">notDetermined</span><span class="p">:</span>
</span><span id="__span-4-245"><a id="__codelineno-4-245" name="__codelineno-4-245" href="#__codelineno-4-245"></a>            <span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Статус трекинга не определен&quot;</span><span class="p">)</span>
</span><span id="__span-4-246"><a id="__codelineno-4-246" name="__codelineno-4-246" href="#__codelineno-4-246"></a>
</span><span id="__span-4-247"><a id="__codelineno-4-247" name="__codelineno-4-247" href="#__codelineno-4-247"></a>        <span class="p">@</span><span class="n">unknown</span> <span class="k">default</span><span class="p">:</span>
</span><span id="__span-4-248"><a id="__codelineno-4-248" name="__codelineno-4-248" href="#__codelineno-4-248"></a>            <span class="n">logger</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Неизвестный статус трекинга: </span><span class="si">\(</span><span class="n">status</span><span class="p">.</span><span class="n">rawValue</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
</span><span id="__span-4-249"><a id="__codelineno-4-249" name="__codelineno-4-249" href="#__codelineno-4-249"></a>        <span class="p">}</span>
</span><span id="__span-4-250"><a id="__codelineno-4-250" name="__codelineno-4-250" href="#__codelineno-4-250"></a>    <span class="p">}</span>
</span><span id="__span-4-251"><a id="__codelineno-4-251" name="__codelineno-4-251" href="#__codelineno-4-251"></a>
</span><span id="__span-4-252"><a id="__codelineno-4-252" name="__codelineno-4-252" href="#__codelineno-4-252"></a>    <span class="c1">// TODO создать вебхук на сервере, который логирует все данные, например, в redis или PostgreSQL для аналитики</span>
</span><span id="__span-4-253"><a id="__codelineno-4-253" name="__codelineno-4-253" href="#__codelineno-4-253"></a>    <span class="c1">// Логирование в flow.rick.ai</span>
</span><span id="__span-4-254"><a id="__codelineno-4-254" name="__codelineno-4-254" href="#__codelineno-4-254"></a>    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">logToRickAI</span><span class="p">(</span><span class="n">attribution</span><span class="p">:</span> <span class="n">ADJAttribution</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="p">[</span><span class="nb">String</span><span class="p">:</span> <span class="nb">Any</span><span class="p">])</span> <span class="p">{</span>
</span><span id="__span-4-255"><a id="__codelineno-4-255" name="__codelineno-4-255" href="#__codelineno-4-255"></a>        <span class="kd">let</span> <span class="nv">logData</span><span class="p">:</span> <span class="p">[</span><span class="nb">String</span><span class="p">:</span> <span class="nb">Any</span><span class="p">]</span> <span class="p">=</span> <span class="p">[</span>
</span><span id="__span-4-256"><a id="__codelineno-4-256" name="__codelineno-4-256" href="#__codelineno-4-256"></a>            <span class="s">&quot;event_type&quot;</span><span class="p">:</span> <span class="s">&quot;attribution_data&quot;</span><span class="p">,</span>
</span><span id="__span-4-257"><a id="__codelineno-4-257" name="__codelineno-4-257" href="#__codelineno-4-257"></a>            <span class="s">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">ISO8601DateFormatter</span><span class="p">().</span><span class="n">string</span><span class="p">(</span><span class="n">from</span><span class="p">:</span> <span class="n">Date</span><span class="p">()),</span>
</span><span id="__span-4-258"><a id="__codelineno-4-258" name="__codelineno-4-258" href="#__codelineno-4-258"></a>            <span class="s">&quot;app_info&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-4-259"><a id="__codelineno-4-259" name="__codelineno-4-259" href="#__codelineno-4-259"></a>                <span class="s">&quot;app_id&quot;</span><span class="p">:</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">bundleIdentifier</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-4-260"><a id="__codelineno-4-260" name="__codelineno-4-260" href="#__codelineno-4-260"></a>                <span class="s">&quot;platform&quot;</span><span class="p">:</span> <span class="s">&quot;ios&quot;</span><span class="p">,</span>
</span><span id="__span-4-261"><a id="__codelineno-4-261" name="__codelineno-4-261" href="#__codelineno-4-261"></a>                <span class="s">&quot;version&quot;</span><span class="p">:</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">infoDictionary</span><span class="p">?[</span><span class="s">&quot;CFBundleShortVersionString&quot;</span><span class="p">]</span> <span class="k">as</span><span class="p">?</span> <span class="nb">String</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-4-262"><a id="__codelineno-4-262" name="__codelineno-4-262" href="#__codelineno-4-262"></a>                <span class="s">&quot;build&quot;</span><span class="p">:</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">infoDictionary</span><span class="p">?[</span><span class="s">&quot;CFBundleVersion&quot;</span><span class="p">]</span> <span class="k">as</span><span class="p">?</span> <span class="nb">String</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span>
</span><span id="__span-4-263"><a id="__codelineno-4-263" name="__codelineno-4-263" href="#__codelineno-4-263"></a>            <span class="p">],</span>
</span><span id="__span-4-264"><a id="__codelineno-4-264" name="__codelineno-4-264" href="#__codelineno-4-264"></a>            <span class="s">&quot;device_info&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-4-265"><a id="__codelineno-4-265" name="__codelineno-4-265" href="#__codelineno-4-265"></a>                <span class="s">&quot;device_id&quot;</span><span class="p">:</span> <span class="n">Adjust</span><span class="p">.</span><span class="n">adid</span><span class="p">()</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span> <span class="c1">// </span><span class="cs">TODO:</span><span class="c1"> перепроверить код - убедиться что Adjust.adid() возвращает корректный ID устройства</span>
</span><span id="__span-4-266"><a id="__codelineno-4-266" name="__codelineno-4-266" href="#__codelineno-4-266"></a>                <span class="s">&quot;appmetrica_device_id&quot;</span><span class="p">:</span> <span class="n">AppMetrica</span><span class="p">.</span><span class="n">deviceID</span><span class="p">()</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-4-267"><a id="__codelineno-4-267" name="__codelineno-4-267" href="#__codelineno-4-267"></a>                <span class="s">&quot;idfa&quot;</span><span class="p">:</span> <span class="bp">ASIdentifierManager</span><span class="p">.</span><span class="n">shared</span><span class="p">().</span><span class="n">advertisingIdentifier</span><span class="p">.</span><span class="n">uuidString</span><span class="p">,</span>
</span><span id="__span-4-268"><a id="__codelineno-4-268" name="__codelineno-4-268" href="#__codelineno-4-268"></a>                <span class="s">&quot;idfv&quot;</span><span class="p">:</span> <span class="bp">UIDevice</span><span class="p">.</span><span class="n">current</span><span class="p">.</span><span class="n">identifierForVendor</span><span class="p">?.</span><span class="n">uuidString</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-4-269"><a id="__codelineno-4-269" name="__codelineno-4-269" href="#__codelineno-4-269"></a>                <span class="s">&quot;os_version&quot;</span><span class="p">:</span> <span class="bp">UIDevice</span><span class="p">.</span><span class="n">current</span><span class="p">.</span><span class="n">systemVersion</span><span class="p">,</span>
</span><span id="__span-4-270"><a id="__codelineno-4-270" name="__codelineno-4-270" href="#__codelineno-4-270"></a>                <span class="s">&quot;device_model&quot;</span><span class="p">:</span> <span class="bp">UIDevice</span><span class="p">.</span><span class="n">current</span><span class="p">.</span><span class="n">model</span>
</span><span id="__span-4-271"><a id="__codelineno-4-271" name="__codelineno-4-271" href="#__codelineno-4-271"></a>            <span class="p">],</span>
</span><span id="__span-4-272"><a id="__codelineno-4-272" name="__codelineno-4-272" href="#__codelineno-4-272"></a>            <span class="s">&quot;attribution_data&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-4-273"><a id="__codelineno-4-273" name="__codelineno-4-273" href="#__codelineno-4-273"></a>                <span class="s">&quot;adjust_network&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">network</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-4-274"><a id="__codelineno-4-274" name="__codelineno-4-274" href="#__codelineno-4-274"></a>                <span class="s">&quot;adjust_campaign&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">campaign</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-4-275"><a id="__codelineno-4-275" name="__codelineno-4-275" href="#__codelineno-4-275"></a>                <span class="s">&quot;adjust_creative&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">creative</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-4-276"><a id="__codelineno-4-276" name="__codelineno-4-276" href="#__codelineno-4-276"></a>                <span class="s">&quot;adjust_tracker&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">trackerName</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-4-277"><a id="__codelineno-4-277" name="__codelineno-4-277" href="#__codelineno-4-277"></a>                <span class="s">&quot;adjust_click_label&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">clickLabel</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-4-278"><a id="__codelineno-4-278" name="__codelineno-4-278" href="#__codelineno-4-278"></a>                <span class="s">&quot;is_first_launch&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">isFirstLaunch</span> <span class="p">??</span> <span class="kc">false</span><span class="p">,</span>
</span><span id="__span-4-279"><a id="__codelineno-4-279" name="__codelineno-4-279" href="#__codelineno-4-279"></a>                <span class="s">&quot;attribution_type&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">isFirstLaunch</span> <span class="p">==</span> <span class="kc">true</span> <span class="p">?</span> <span class="s">&quot;install&quot;</span> <span class="p">:</span> <span class="s">&quot;reinstall&quot;</span>
</span><span id="__span-4-280"><a id="__codelineno-4-280" name="__codelineno-4-280" href="#__codelineno-4-280"></a>            <span class="p">],</span>
</span><span id="__span-4-281"><a id="__codelineno-4-281" name="__codelineno-4-281" href="#__codelineno-4-281"></a>            <span class="s">&quot;utm_data&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-4-282"><a id="__codelineno-4-282" name="__codelineno-4-282" href="#__codelineno-4-282"></a>                <span class="s">&quot;utm_source&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">network</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-4-283"><a id="__codelineno-4-283" name="__codelineno-4-283" href="#__codelineno-4-283"></a>                <span class="s">&quot;utm_medium&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span> <span class="c1">// Восстанавливается в Rick.ai по правилам        </span>
</span><span id="__span-4-284"><a id="__codelineno-4-284" name="__codelineno-4-284" href="#__codelineno-4-284"></a>                <span class="s">&quot;utm_campaign&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">campaign</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-4-285"><a id="__codelineno-4-285" name="__codelineno-4-285" href="#__codelineno-4-285"></a>                <span class="s">&quot;utm_content&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">creative</span> <span class="p">??</span> <span class="s">&quot;&quot;</span>
</span><span id="__span-4-286"><a id="__codelineno-4-286" name="__codelineno-4-286" href="#__codelineno-4-286"></a>            <span class="p">],</span>
</span><span id="__span-4-287"><a id="__codelineno-4-287" name="__codelineno-4-287" href="#__codelineno-4-287"></a>            <span class="s">&quot;sdk_status&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-4-288"><a id="__codelineno-4-288" name="__codelineno-4-288" href="#__codelineno-4-288"></a>                <span class="s">&quot;adjust_initialized&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span id="__span-4-289"><a id="__codelineno-4-289" name="__codelineno-4-289" href="#__codelineno-4-289"></a>                <span class="s">&quot;appmetrica_initialized&quot;</span><span class="p">:</span> <span class="n">AppMetrica</span><span class="p">.</span><span class="n">isActivated</span><span class="p">,</span>
</span><span id="__span-4-290"><a id="__codelineno-4-290" name="__codelineno-4-290" href="#__codelineno-4-290"></a>                <span class="s">&quot;attribution_received&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span id="__span-4-291"><a id="__codelineno-4-291" name="__codelineno-4-291" href="#__codelineno-4-291"></a>                <span class="s">&quot;event_sent_to_appmetrica&quot;</span><span class="p">:</span> <span class="kc">true</span>
</span><span id="__span-4-292"><a id="__codelineno-4-292" name="__codelineno-4-292" href="#__codelineno-4-292"></a>            <span class="p">],</span>
</span><span id="__span-4-293"><a id="__codelineno-4-293" name="__codelineno-4-293" href="#__codelineno-4-293"></a>            <span class="s">&quot;error_info&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-4-294"><a id="__codelineno-4-294" name="__codelineno-4-294" href="#__codelineno-4-294"></a>                <span class="s">&quot;has_errors&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span id="__span-4-295"><a id="__codelineno-4-295" name="__codelineno-4-295" href="#__codelineno-4-295"></a>                <span class="s">&quot;error_messages&quot;</span><span class="p">:</span> <span class="p">[]</span>
</span><span id="__span-4-296"><a id="__codelineno-4-296" name="__codelineno-4-296" href="#__codelineno-4-296"></a>            <span class="p">]</span>
</span><span id="__span-4-297"><a id="__codelineno-4-297" name="__codelineno-4-297" href="#__codelineno-4-297"></a>        <span class="p">]</span>
</span><span id="__span-4-298"><a id="__codelineno-4-298" name="__codelineno-4-298" href="#__codelineno-4-298"></a>
</span><span id="__span-4-299"><a id="__codelineno-4-299" name="__codelineno-4-299" href="#__codelineno-4-299"></a>        <span class="c1">// Отправка в flow.rick.ai</span>
</span><span id="__span-4-300"><a id="__codelineno-4-300" name="__codelineno-4-300" href="#__codelineno-4-300"></a>        <span class="n">sendToRickAI</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">logData</span><span class="p">)</span>
</span><span id="__span-4-301"><a id="__codelineno-4-301" name="__codelineno-4-301" href="#__codelineno-4-301"></a>    <span class="p">}</span>
</span><span id="__span-4-302"><a id="__codelineno-4-302" name="__codelineno-4-302" href="#__codelineno-4-302"></a>
</span><span id="__span-4-303"><a id="__codelineno-4-303" name="__codelineno-4-303" href="#__codelineno-4-303"></a>    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">sendToRickAI</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="p">[</span><span class="nb">String</span><span class="p">:</span> <span class="nb">Any</span><span class="p">])</span> <span class="p">{</span>
</span><span id="__span-4-304"><a id="__codelineno-4-304" name="__codelineno-4-304" href="#__codelineno-4-304"></a>        <span class="k">guard</span> <span class="kd">let</span> <span class="nv">url</span> <span class="p">=</span> <span class="n">URL</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="s">&quot;https://flow.rick.ai/webhook/ff27caff-574f-4183-a29b-c2cac4147d43&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
</span><span id="__span-4-305"><a id="__codelineno-4-305" name="__codelineno-4-305" href="#__codelineno-4-305"></a>
</span><span id="__span-4-306"><a id="__codelineno-4-306" name="__codelineno-4-306" href="#__codelineno-4-306"></a>        <span class="kd">var</span> <span class="nv">request</span> <span class="p">=</span> <span class="n">URLRequest</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
</span><span id="__span-4-307"><a id="__codelineno-4-307" name="__codelineno-4-307" href="#__codelineno-4-307"></a>        <span class="n">request</span><span class="p">.</span><span class="n">httpMethod</span> <span class="p">=</span> <span class="s">&quot;POST&quot;</span>
</span><span id="__span-4-308"><a id="__codelineno-4-308" name="__codelineno-4-308" href="#__codelineno-4-308"></a>        <span class="n">request</span><span class="p">.</span><span class="n">setValue</span><span class="p">(</span><span class="s">&quot;application/json&quot;</span><span class="p">,</span> <span class="n">forHTTPHeaderField</span><span class="p">:</span> <span class="s">&quot;Content-Type&quot;</span><span class="p">)</span>
</span><span id="__span-4-309"><a id="__codelineno-4-309" name="__codelineno-4-309" href="#__codelineno-4-309"></a>
</span><span id="__span-4-310"><a id="__codelineno-4-310" name="__codelineno-4-310" href="#__codelineno-4-310"></a>        <span class="k">do</span> <span class="p">{</span>
</span><span id="__span-4-311"><a id="__codelineno-4-311" name="__codelineno-4-311" href="#__codelineno-4-311"></a>            <span class="n">request</span><span class="p">.</span><span class="n">httpBody</span> <span class="p">=</span> <span class="k">try</span> <span class="n">JSONSerialization</span><span class="p">.</span><span class="n">data</span><span class="p">(</span><span class="n">withJSONObject</span><span class="p">:</span> <span class="n">data</span><span class="p">)</span>
</span><span id="__span-4-312"><a id="__codelineno-4-312" name="__codelineno-4-312" href="#__codelineno-4-312"></a>        <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-4-313"><a id="__codelineno-4-313" name="__codelineno-4-313" href="#__codelineno-4-313"></a>            <span class="n">logger</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;Ошибка сериализации данных для Rick.ai: </span><span class="si">\(</span><span class="n">error</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
</span><span id="__span-4-314"><a id="__codelineno-4-314" name="__codelineno-4-314" href="#__codelineno-4-314"></a>            <span class="k">return</span>
</span><span id="__span-4-315"><a id="__codelineno-4-315" name="__codelineno-4-315" href="#__codelineno-4-315"></a>        <span class="p">}</span>
</span><span id="__span-4-316"><a id="__codelineno-4-316" name="__codelineno-4-316" href="#__codelineno-4-316"></a>
</span><span id="__span-4-317"><a id="__codelineno-4-317" name="__codelineno-4-317" href="#__codelineno-4-317"></a>        <span class="n">URLSession</span><span class="p">.</span><span class="n">shared</span><span class="p">.</span><span class="n">dataTask</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="n">request</span><span class="p">)</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
</span><span id="__span-4-318"><a id="__codelineno-4-318" name="__codelineno-4-318" href="#__codelineno-4-318"></a>            <span class="k">if</span> <span class="kd">let</span> <span class="nv">error</span> <span class="p">=</span> <span class="n">error</span> <span class="p">{</span>
</span><span id="__span-4-319"><a id="__codelineno-4-319" name="__codelineno-4-319" href="#__codelineno-4-319"></a>                <span class="kc">self</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;Ошибка отправки в Rick.ai: </span><span class="si">\(</span><span class="n">error</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
</span><span id="__span-4-320"><a id="__codelineno-4-320" name="__codelineno-4-320" href="#__codelineno-4-320"></a>            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="kd">let</span> <span class="nv">httpResponse</span> <span class="p">=</span> <span class="n">response</span> <span class="k">as</span><span class="p">?</span> <span class="n">HTTPURLResponse</span> <span class="p">{</span>
</span><span id="__span-4-321"><a id="__codelineno-4-321" name="__codelineno-4-321" href="#__codelineno-4-321"></a>                <span class="k">if</span> <span class="n">httpResponse</span><span class="p">.</span><span class="n">statusCode</span> <span class="o">!=</span> <span class="mi">200</span> <span class="p">{</span>
</span><span id="__span-4-322"><a id="__codelineno-4-322" name="__codelineno-4-322" href="#__codelineno-4-322"></a>                    <span class="kc">self</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;Rick.ai вернул статус: </span><span class="si">\(</span><span class="n">httpResponse</span><span class="p">.</span><span class="n">statusCode</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
</span><span id="__span-4-323"><a id="__codelineno-4-323" name="__codelineno-4-323" href="#__codelineno-4-323"></a>                <span class="p">}</span>
</span><span id="__span-4-324"><a id="__codelineno-4-324" name="__codelineno-4-324" href="#__codelineno-4-324"></a>            <span class="p">}</span>
</span><span id="__span-4-325"><a id="__codelineno-4-325" name="__codelineno-4-325" href="#__codelineno-4-325"></a>        <span class="p">}.</span><span class="n">resume</span><span class="p">()</span>
</span><span id="__span-4-326"><a id="__codelineno-4-326" name="__codelineno-4-326" href="#__codelineno-4-326"></a>    <span class="p">}</span>
</span><span id="__span-4-327"><a id="__codelineno-4-327" name="__codelineno-4-327" href="#__codelineno-4-327"></a><span class="p">}</span>
</span></code></pre></div>
</details>
<details>
<summary><strong>Android (MainApplication.kt)</strong></summary>


- везде flatter

<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">import</span><span class="w"> </span><span class="nn">com.adjust.sdk.Adjust</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="k">import</span><span class="w"> </span><span class="nn">com.adjust.sdk.AdjustConfig</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="k">import</span><span class="w"> </span><span class="nn">com.adjust.sdk.AdjustAttribution</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="k">import</span><span class="w"> </span><span class="nn">com.yandex.metrica.AppMetrica</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="k">import</span><span class="w"> </span><span class="nn">com.yandex.metrica.AppMetricaConfig</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="k">import</span><span class="w"> </span><span class="nn">android.util.Log</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="kd">class</span><span class="w"> </span><span class="nc">MainApplication</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Application</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">    </span><span class="kd">companion</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">TAG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;MainApplication&quot;</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">        </span><span class="k">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">()</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w">        </span><span class="c1">// 1. AppMetrica (первым!)</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">appMetricaKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getString</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">appmetrica_api_key</span><span class="p">)</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">appMetricaKey</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">            </span><span class="n">Log</span><span class="p">.</span><span class="na">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;APPMETRICA_API_KEY не найден в strings.xml&quot;</span><span class="p">)</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="w">            </span><span class="k">return</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">appMetricaConfig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AppMetricaConfig</span><span class="p">.</span><span class="na">newConfigBuilder</span><span class="p">(</span><span class="n">appMetricaKey</span><span class="p">)</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="w">            </span><span class="p">.</span><span class="na">withLocationTracking</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="w">            </span><span class="p">.</span><span class="na">handleFirstActivationAsUpdate</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a><span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a>
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a><span class="w">        </span><span class="n">AppMetrica</span><span class="p">.</span><span class="na">activate</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">appMetricaConfig</span><span class="p">)</span>
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a>
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a><span class="w">        </span><span class="c1">// 2. Adjust (вторым!)</span>
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">adjustToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getString</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">adjust_app_token</span><span class="p">)</span>
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">adjustToken</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a><span class="w">            </span><span class="n">Log</span><span class="p">.</span><span class="na">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ADJUST_APP_TOKEN не найден в strings.xml&quot;</span><span class="p">)</span>
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a><span class="w">            </span><span class="k">return</span>
</span><span id="__span-5-35"><a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-5-36"><a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a>
</span><span id="__span-5-37"><a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">adjustConfig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AdjustConfig</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">adjustToken</span><span class="p">,</span><span class="w"> </span><span class="n">AdjustConfig</span><span class="p">.</span><span class="na">ENVIRONMENT_PRODUCTION</span><span class="p">)</span>
</span><span id="__span-5-38"><a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a>
</span><span id="__span-5-39"><a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a><span class="w">        </span><span class="c1">// Callback: Adjust → AppMetrica</span>
</span><span id="__span-5-40"><a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a><span class="w">        </span><span class="n">adjustConfig</span><span class="p">.</span><span class="na">setOnAttributionChangedListener</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">attribution</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-5-41"><a id="__codelineno-5-41" name="__codelineno-5-41" href="#__codelineno-5-41"></a><span class="w">            </span><span class="n">attribution</span><span class="o">?.</span><span class="na">let</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-42"><a id="__codelineno-5-42" name="__codelineno-5-42" href="#__codelineno-5-42"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AppMetrica</span><span class="p">.</span><span class="na">isActivated</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-43"><a id="__codelineno-5-43" name="__codelineno-5-43" href="#__codelineno-5-43"></a><span class="w">                    </span><span class="kd">val</span><span class="w"> </span><span class="nv">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapOf</span><span class="p">(</span>
</span><span id="__span-5-44"><a id="__codelineno-5-44" name="__codelineno-5-44" href="#__codelineno-5-44"></a><span class="w">                        </span><span class="c1">// Adjust параметры для аналитики</span>
</span><span id="__span-5-45"><a id="__codelineno-5-45" name="__codelineno-5-45" href="#__codelineno-5-45"></a><span class="w">                        </span><span class="s">&quot;adjust_tracker&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="nb">it</span><span class="p">.</span><span class="na">trackerName</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="__span-5-46"><a id="__codelineno-5-46" name="__codelineno-5-46" href="#__codelineno-5-46"></a><span class="w">                        </span><span class="s">&quot;adjust_network&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="nb">it</span><span class="p">.</span><span class="na">network</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="__span-5-47"><a id="__codelineno-5-47" name="__codelineno-5-47" href="#__codelineno-5-47"></a><span class="w">                        </span><span class="s">&quot;adjust_campaign&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="nb">it</span><span class="p">.</span><span class="na">campaign</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="__span-5-48"><a id="__codelineno-5-48" name="__codelineno-5-48" href="#__codelineno-5-48"></a><span class="w">                        </span><span class="s">&quot;adjust_creative&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="nb">it</span><span class="p">.</span><span class="na">creative</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="__span-5-49"><a id="__codelineno-5-49" name="__codelineno-5-49" href="#__codelineno-5-49"></a><span class="w">                        </span><span class="s">&quot;adjust_click_label&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="nb">it</span><span class="p">.</span><span class="na">clickLabel</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="__span-5-50"><a id="__codelineno-5-50" name="__codelineno-5-50" href="#__codelineno-5-50"></a><span class="w">                        </span><span class="s">&quot;adjust_adid&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="n">Adjust</span><span class="p">.</span><span class="na">getAdid</span><span class="p">()</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="__span-5-51"><a id="__codelineno-5-51" name="__codelineno-5-51" href="#__codelineno-5-51"></a><span class="w">                        </span><span class="s">&quot;is_first_launch&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="nb">it</span><span class="p">.</span><span class="na">isFirstLaunch</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="kc">false</span><span class="p">),</span>
</span><span id="__span-5-52"><a id="__codelineno-5-52" name="__codelineno-5-52" href="#__codelineno-5-52"></a>
</span><span id="__span-5-53"><a id="__codelineno-5-53" name="__codelineno-5-53" href="#__codelineno-5-53"></a><span class="w">                        </span><span class="c1">// UTM параметры для корректной атрибуции</span>
</span><span id="__span-5-54"><a id="__codelineno-5-54" name="__codelineno-5-54" href="#__codelineno-5-54"></a><span class="w">                        </span><span class="s">&quot;utm_source&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="nb">it</span><span class="p">.</span><span class="na">network</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="__span-5-55"><a id="__codelineno-5-55" name="__codelineno-5-55" href="#__codelineno-5-55"></a><span class="w">                        </span><span class="s">&quot;utm_campaign&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="nb">it</span><span class="p">.</span><span class="na">campaign</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="__span-5-56"><a id="__codelineno-5-56" name="__codelineno-5-56" href="#__codelineno-5-56"></a><span class="w">                        </span><span class="s">&quot;utm_content&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="nb">it</span><span class="p">.</span><span class="na">creative</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">),</span>
</span><span id="__span-5-57"><a id="__codelineno-5-57" name="__codelineno-5-57" href="#__codelineno-5-57"></a><span class="w">                        </span><span class="s">&quot;utm_medium&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1">// Восстанавливается в Rick.ai по правилам</span>
</span><span id="__span-5-58"><a id="__codelineno-5-58" name="__codelineno-5-58" href="#__codelineno-5-58"></a>
</span><span id="__span-5-59"><a id="__codelineno-5-59" name="__codelineno-5-59" href="#__codelineno-5-59"></a><span class="w">                        </span><span class="c1">// Дополнительные параметры для аналитики</span>
</span><span id="__span-5-60"><a id="__codelineno-5-60" name="__codelineno-5-60" href="#__codelineno-5-60"></a><span class="w">                        </span><span class="s">&quot;attribution_timestamp&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span>
</span><span id="__span-5-61"><a id="__codelineno-5-61" name="__codelineno-5-61" href="#__codelineno-5-61"></a><span class="w">                        </span><span class="s">&quot;attribution_type&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">it</span><span class="p">.</span><span class="na">isFirstLaunch</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;install&quot;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s">&quot;reinstall&quot;</span><span class="p">)</span>
</span><span id="__span-5-62"><a id="__codelineno-5-62" name="__codelineno-5-62" href="#__codelineno-5-62"></a><span class="w">                    </span><span class="p">)</span>
</span><span id="__span-5-63"><a id="__codelineno-5-63" name="__codelineno-5-63" href="#__codelineno-5-63"></a>
</span><span id="__span-5-64"><a id="__codelineno-5-64" name="__codelineno-5-64" href="#__codelineno-5-64"></a><span class="w">                    </span><span class="n">AppMetrica</span><span class="p">.</span><span class="na">reportEvent</span><span class="p">(</span><span class="s">&quot;adjust attributed utm params&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">)</span>
</span><span id="__span-5-65"><a id="__codelineno-5-65" name="__codelineno-5-65" href="#__codelineno-5-65"></a>
</span><span id="__span-5-66"><a id="__codelineno-5-66" name="__codelineno-5-66" href="#__codelineno-5-66"></a><span class="w">                    </span><span class="c1">// Логирование в flow.rick.ai</span>
</span><span id="__span-5-67"><a id="__codelineno-5-67" name="__codelineno-5-67" href="#__codelineno-5-67"></a><span class="w">                    </span><span class="n">logToRickAI</span><span class="p">(</span><span class="nb">it</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">)</span>
</span><span id="__span-5-68"><a id="__codelineno-5-68" name="__codelineno-5-68" href="#__codelineno-5-68"></a><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-69"><a id="__codelineno-5-69" name="__codelineno-5-69" href="#__codelineno-5-69"></a><span class="w">                    </span><span class="n">Log</span><span class="p">.</span><span class="na">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;AppMetrica не активирована при получении attribution&quot;</span><span class="p">)</span>
</span><span id="__span-5-70"><a id="__codelineno-5-70" name="__codelineno-5-70" href="#__codelineno-5-70"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-5-71"><a id="__codelineno-5-71" name="__codelineno-5-71" href="#__codelineno-5-71"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-5-72"><a id="__codelineno-5-72" name="__codelineno-5-72" href="#__codelineno-5-72"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-5-73"><a id="__codelineno-5-73" name="__codelineno-5-73" href="#__codelineno-5-73"></a>
</span><span id="__span-5-74"><a id="__codelineno-5-74" name="__codelineno-5-74" href="#__codelineno-5-74"></a><span class="w">        </span><span class="n">Adjust</span><span class="p">.</span><span class="na">onCreate</span><span class="p">(</span><span class="n">adjustConfig</span><span class="p">)</span>
</span><span id="__span-5-75"><a id="__codelineno-5-75" name="__codelineno-5-75" href="#__codelineno-5-75"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-5-76"><a id="__codelineno-5-76" name="__codelineno-5-76" href="#__codelineno-5-76"></a>
</span><span id="__span-5-77"><a id="__codelineno-5-77" name="__codelineno-5-77" href="#__codelineno-5-77"></a><span class="w">    </span><span class="c1">// Логирование в flow.rick.ai</span>
</span><span id="__span-5-78"><a id="__codelineno-5-78" name="__codelineno-5-78" href="#__codelineno-5-78"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">logToRickAI</span><span class="p">(</span><span class="n">attribution</span><span class="p">:</span><span class="w"> </span><span class="n">AdjustAttribution</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">Any</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-79"><a id="__codelineno-5-79" name="__codelineno-5-79" href="#__codelineno-5-79"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">logData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapOf</span><span class="p">(</span>
</span><span id="__span-5-80"><a id="__codelineno-5-80" name="__codelineno-5-80" href="#__codelineno-5-80"></a><span class="w">            </span><span class="s">&quot;event_type&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="s">&quot;attribution_data&quot;</span><span class="p">,</span>
</span><span id="__span-5-81"><a id="__codelineno-5-81" name="__codelineno-5-81" href="#__codelineno-5-81"></a><span class="w">            </span><span class="s">&quot;timestamp&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">time</span><span class="p">.</span><span class="na">Instant</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">toString</span><span class="p">(),</span>
</span><span id="__span-5-82"><a id="__codelineno-5-82" name="__codelineno-5-82" href="#__codelineno-5-82"></a><span class="w">            </span><span class="s">&quot;app_info&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">mapOf</span><span class="p">(</span>
</span><span id="__span-5-83"><a id="__codelineno-5-83" name="__codelineno-5-83" href="#__codelineno-5-83"></a><span class="w">                </span><span class="s">&quot;app_id&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="n">packageName</span><span class="p">),</span>
</span><span id="__span-5-84"><a id="__codelineno-5-84" name="__codelineno-5-84" href="#__codelineno-5-84"></a><span class="w">                </span><span class="s">&quot;platform&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="s">&quot;android&quot;</span><span class="p">,</span>
</span><span id="__span-5-85"><a id="__codelineno-5-85" name="__codelineno-5-85" href="#__codelineno-5-85"></a><span class="w">                </span><span class="s">&quot;version&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">packageManager</span><span class="p">.</span><span class="na">getPackageInfo</span><span class="p">(</span><span class="n">packageName</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">).</span><span class="na">versionName</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="w"> </span><span class="p">}),</span>
</span><span id="__span-5-86"><a id="__codelineno-5-86" name="__codelineno-5-86" href="#__codelineno-5-86"></a><span class="w">                </span><span class="s">&quot;build&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">packageManager</span><span class="p">.</span><span class="na">getPackageInfo</span><span class="p">(</span><span class="n">packageName</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">).</span><span class="na">versionCode</span><span class="p">.</span><span class="na">toString</span><span class="p">()</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="w"> </span><span class="p">})</span>
</span><span id="__span-5-87"><a id="__codelineno-5-87" name="__codelineno-5-87" href="#__codelineno-5-87"></a><span class="w">            </span><span class="p">),</span>
</span><span id="__span-5-88"><a id="__codelineno-5-88" name="__codelineno-5-88" href="#__codelineno-5-88"></a><span class="w">            </span><span class="s">&quot;device_info&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">mapOf</span><span class="p">(</span>
</span><span id="__span-5-89"><a id="__codelineno-5-89" name="__codelineno-5-89" href="#__codelineno-5-89"></a><span class="w">                </span><span class="s">&quot;device_id&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="n">Adjust</span><span class="p">.</span><span class="na">getAdid</span><span class="p">()</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="__span-5-90"><a id="__codelineno-5-90" name="__codelineno-5-90" href="#__codelineno-5-90"></a><span class="w">                </span><span class="s">&quot;appmetrica_device_id&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="n">AppMetrica</span><span class="p">.</span><span class="na">getDeviceID</span><span class="p">()</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="__span-5-91"><a id="__codelineno-5-91" name="__codelineno-5-91" href="#__codelineno-5-91"></a><span class="w">                </span><span class="s">&quot;android_id&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="n">Settings</span><span class="p">.</span><span class="na">Secure</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="n">contentResolver</span><span class="p">,</span><span class="w"> </span><span class="n">Settings</span><span class="p">.</span><span class="na">Secure</span><span class="p">.</span><span class="na">ANDROID_ID</span><span class="p">)</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="__span-5-92"><a id="__codelineno-5-92" name="__codelineno-5-92" href="#__codelineno-5-92"></a><span class="w">                </span><span class="s">&quot;os_version&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">Build</span><span class="p">.</span><span class="na">VERSION</span><span class="p">.</span><span class="na">RELEASE</span><span class="p">,</span>
</span><span id="__span-5-93"><a id="__codelineno-5-93" name="__codelineno-5-93" href="#__codelineno-5-93"></a><span class="w">                </span><span class="s">&quot;device_model&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">Build</span><span class="p">.</span><span class="na">MODEL</span>
</span><span id="__span-5-94"><a id="__codelineno-5-94" name="__codelineno-5-94" href="#__codelineno-5-94"></a><span class="w">            </span><span class="p">),</span>
</span><span id="__span-5-95"><a id="__codelineno-5-95" name="__codelineno-5-95" href="#__codelineno-5-95"></a><span class="w">            </span><span class="s">&quot;attribution_data&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">mapOf</span><span class="p">(</span>
</span><span id="__span-5-96"><a id="__codelineno-5-96" name="__codelineno-5-96" href="#__codelineno-5-96"></a><span class="w">                </span><span class="s">&quot;adjust_network&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="n">attribution</span><span class="p">.</span><span class="na">network</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// ✅ Adjust Network - источник трафика (facebook, google, organic)</span>
</span><span id="__span-5-97"><a id="__codelineno-5-97" name="__codelineno-5-97" href="#__codelineno-5-97"></a><span class="w">                </span><span class="s">&quot;adjust_tracker&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="n">attribution</span><span class="p">.</span><span class="na">trackerName</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// ✅ Adjust Tracker - уникальный идентификатор трекера</span>
</span><span id="__span-5-98"><a id="__codelineno-5-98" name="__codelineno-5-98" href="#__codelineno-5-98"></a><span class="w">                </span><span class="s">&quot;adjust_campaign&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="n">attribution</span><span class="p">.</span><span class="na">campaign</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// ✅ Adjust Campaign - название рекламной кампании</span>
</span><span id="__span-5-99"><a id="__codelineno-5-99" name="__codelineno-5-99" href="#__codelineno-5-99"></a><span class="w">                </span><span class="s">&quot;adjust_creative&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="n">attribution</span><span class="p">.</span><span class="na">creative</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// ✅ Adjust Creative - креатив/баннер рекламы</span>
</span><span id="__span-5-100"><a id="__codelineno-5-100" name="__codelineno-5-100" href="#__codelineno-5-100"></a><span class="w">                </span><span class="s">&quot;adjust_click_label&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="n">attribution</span><span class="p">.</span><span class="na">clickLabel</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// ✅ Adjust Click Label - метка клика для детализации</span>
</span><span id="__span-5-101"><a id="__codelineno-5-101" name="__codelineno-5-101" href="#__codelineno-5-101"></a><span class="w">                </span><span class="s">&quot;is_first_launch&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="n">attribution</span><span class="p">.</span><span class="na">isFirstLaunch</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="kc">false</span><span class="p">),</span><span class="w"> </span><span class="c1">// ✅ Is First Launch - первый запуск приложения</span>
</span><span id="__span-5-102"><a id="__codelineno-5-102" name="__codelineno-5-102" href="#__codelineno-5-102"></a><span class="w">                </span><span class="s">&quot;attribution_type&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attribution</span><span class="p">.</span><span class="na">isFirstLaunch</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;install&quot;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s">&quot;reinstall&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// ✅ Attribution Type - тип атрибуции</span>
</span><span id="__span-5-103"><a id="__codelineno-5-103" name="__codelineno-5-103" href="#__codelineno-5-103"></a><span class="w">            </span><span class="p">),</span>
</span><span id="__span-5-104"><a id="__codelineno-5-104" name="__codelineno-5-104" href="#__codelineno-5-104"></a><span class="w">            </span><span class="s">&quot;utm_data&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">mapOf</span><span class="p">(</span>
</span><span id="__span-5-105"><a id="__codelineno-5-105" name="__codelineno-5-105" href="#__codelineno-5-105"></a><span class="w">                </span><span class="s">&quot;utm_source&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="n">attribution</span><span class="p">.</span><span class="na">network</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="__span-5-106"><a id="__codelineno-5-106" name="__codelineno-5-106" href="#__codelineno-5-106"></a><span class="w">                </span><span class="s">&quot;utm_campaign&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="n">attribution</span><span class="p">.</span><span class="na">campaign</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="__span-5-107"><a id="__codelineno-5-107" name="__codelineno-5-107" href="#__codelineno-5-107"></a><span class="w">                </span><span class="s">&quot;utm_content&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="n">attribution</span><span class="p">.</span><span class="na">creative</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">),</span>
</span><span id="__span-5-108"><a id="__codelineno-5-108" name="__codelineno-5-108" href="#__codelineno-5-108"></a><span class="w">                </span><span class="s">&quot;utm_medium&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1">// Восстанавливается в Rick.ai по правилам</span>
</span><span id="__span-5-109"><a id="__codelineno-5-109" name="__codelineno-5-109" href="#__codelineno-5-109"></a><span class="w">            </span><span class="p">),</span>
</span><span id="__span-5-110"><a id="__codelineno-5-110" name="__codelineno-5-110" href="#__codelineno-5-110"></a><span class="w">            </span><span class="s">&quot;sdk_status&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">mapOf</span><span class="p">(</span>
</span><span id="__span-5-111"><a id="__codelineno-5-111" name="__codelineno-5-111" href="#__codelineno-5-111"></a><span class="w">                </span><span class="s">&quot;adjust_initialized&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-5-112"><a id="__codelineno-5-112" name="__codelineno-5-112" href="#__codelineno-5-112"></a><span class="w">                </span><span class="s">&quot;appmetrica_initialized&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">AppMetrica</span><span class="p">.</span><span class="na">isActivated</span><span class="p">,</span>
</span><span id="__span-5-113"><a id="__codelineno-5-113" name="__codelineno-5-113" href="#__codelineno-5-113"></a><span class="w">                </span><span class="s">&quot;attribution_received&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-5-114"><a id="__codelineno-5-114" name="__codelineno-5-114" href="#__codelineno-5-114"></a><span class="w">                </span><span class="s">&quot;event_sent_to_appmetrica&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-5-115"><a id="__codelineno-5-115" name="__codelineno-5-115" href="#__codelineno-5-115"></a><span class="w">            </span><span class="p">),</span>
</span><span id="__span-5-116"><a id="__codelineno-5-116" name="__codelineno-5-116" href="#__codelineno-5-116"></a><span class="w">            </span><span class="s">&quot;error_info&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">mapOf</span><span class="p">(</span>
</span><span id="__span-5-117"><a id="__codelineno-5-117" name="__codelineno-5-117" href="#__codelineno-5-117"></a><span class="w">                </span><span class="s">&quot;has_errors&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-5-118"><a id="__codelineno-5-118" name="__codelineno-5-118" href="#__codelineno-5-118"></a><span class="w">                </span><span class="s">&quot;error_messages&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">emptyList</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">()</span>
</span><span id="__span-5-119"><a id="__codelineno-5-119" name="__codelineno-5-119" href="#__codelineno-5-119"></a><span class="w">            </span><span class="p">)</span>
</span><span id="__span-5-120"><a id="__codelineno-5-120" name="__codelineno-5-120" href="#__codelineno-5-120"></a><span class="w">        </span><span class="p">)</span>
</span><span id="__span-5-121"><a id="__codelineno-5-121" name="__codelineno-5-121" href="#__codelineno-5-121"></a>
</span><span id="__span-5-122"><a id="__codelineno-5-122" name="__codelineno-5-122" href="#__codelineno-5-122"></a><span class="w">        </span><span class="c1">// Отправка в flow.rick.ai</span>
</span><span id="__span-5-123"><a id="__codelineno-5-123" name="__codelineno-5-123" href="#__codelineno-5-123"></a><span class="w">        </span><span class="n">sendToRickAI</span><span class="p">(</span><span class="n">logData</span><span class="p">)</span>
</span><span id="__span-5-124"><a id="__codelineno-5-124" name="__codelineno-5-124" href="#__codelineno-5-124"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-5-125"><a id="__codelineno-5-125" name="__codelineno-5-125" href="#__codelineno-5-125"></a>
</span><span id="__span-5-126"><a id="__codelineno-5-126" name="__codelineno-5-126" href="#__codelineno-5-126"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">sendToRickAI</span><span class="p">(</span><span class="n">data</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">Any</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-127"><a id="__codelineno-5-127" name="__codelineno-5-127" href="#__codelineno-5-127"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">URL</span><span class="p">(</span><span class="s">&quot;https://flow.rick.ai/webhook/ff27caff-574f-4183-a29b-c2cac4147d43&quot;</span><span class="p">)</span>
</span><span id="__span-5-128"><a id="__codelineno-5-128" name="__codelineno-5-128" href="#__codelineno-5-128"></a>
</span><span id="__span-5-129"><a id="__codelineno-5-129" name="__codelineno-5-129" href="#__codelineno-5-129"></a><span class="w">        </span><span class="n">Thread</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-130"><a id="__codelineno-5-130" name="__codelineno-5-130" href="#__codelineno-5-130"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-131"><a id="__codelineno-5-131" name="__codelineno-5-131" href="#__codelineno-5-131"></a><span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">url</span><span class="p">.</span><span class="na">openConnection</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">HttpURLConnection</span>
</span><span id="__span-5-132"><a id="__codelineno-5-132" name="__codelineno-5-132" href="#__codelineno-5-132"></a><span class="w">                </span><span class="n">connection</span><span class="p">.</span><span class="na">requestMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;POST&quot;</span>
</span><span id="__span-5-133"><a id="__codelineno-5-133" name="__codelineno-5-133" href="#__codelineno-5-133"></a><span class="w">                </span><span class="n">connection</span><span class="p">.</span><span class="na">setRequestProperty</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
</span><span id="__span-5-134"><a id="__codelineno-5-134" name="__codelineno-5-134" href="#__codelineno-5-134"></a><span class="w">                </span><span class="n">connection</span><span class="p">.</span><span class="na">doOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-5-135"><a id="__codelineno-5-135" name="__codelineno-5-135" href="#__codelineno-5-135"></a>
</span><span id="__span-5-136"><a id="__codelineno-5-136" name="__codelineno-5-136" href="#__codelineno-5-136"></a><span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">jsonData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">org</span><span class="p">.</span><span class="na">json</span><span class="p">.</span><span class="na">JSONObject</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-5-137"><a id="__codelineno-5-137" name="__codelineno-5-137" href="#__codelineno-5-137"></a><span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">outputStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connection</span><span class="p">.</span><span class="na">outputStream</span>
</span><span id="__span-5-138"><a id="__codelineno-5-138" name="__codelineno-5-138" href="#__codelineno-5-138"></a><span class="w">                </span><span class="n">outputStream</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">jsonData</span><span class="p">.</span><span class="na">toString</span><span class="p">().</span><span class="na">toByteArray</span><span class="p">())</span>
</span><span id="__span-5-139"><a id="__codelineno-5-139" name="__codelineno-5-139" href="#__codelineno-5-139"></a><span class="w">                </span><span class="n">outputStream</span><span class="p">.</span><span class="na">flush</span><span class="p">()</span>
</span><span id="__span-5-140"><a id="__codelineno-5-140" name="__codelineno-5-140" href="#__codelineno-5-140"></a><span class="w">                </span><span class="n">outputStream</span><span class="p">.</span><span class="na">close</span><span class="p">()</span>
</span><span id="__span-5-141"><a id="__codelineno-5-141" name="__codelineno-5-141" href="#__codelineno-5-141"></a>
</span><span id="__span-5-142"><a id="__codelineno-5-142" name="__codelineno-5-142" href="#__codelineno-5-142"></a><span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">responseCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connection</span><span class="p">.</span><span class="na">responseCode</span>
</span><span id="__span-5-143"><a id="__codelineno-5-143" name="__codelineno-5-143" href="#__codelineno-5-143"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">responseCode</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m">200</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-144"><a id="__codelineno-5-144" name="__codelineno-5-144" href="#__codelineno-5-144"></a><span class="w">                    </span><span class="n">Log</span><span class="p">.</span><span class="na">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Rick.ai вернул статус: </span><span class="si">$</span><span class="n">responseCode</span><span class="s">&quot;</span><span class="p">)</span>
</span><span id="__span-5-145"><a id="__codelineno-5-145" name="__codelineno-5-145" href="#__codelineno-5-145"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-5-146"><a id="__codelineno-5-146" name="__codelineno-5-146" href="#__codelineno-5-146"></a>
</span><span id="__span-5-147"><a id="__codelineno-5-147" name="__codelineno-5-147" href="#__codelineno-5-147"></a><span class="w">                </span><span class="n">connection</span><span class="p">.</span><span class="na">disconnect</span><span class="p">()</span>
</span><span id="__span-5-148"><a id="__codelineno-5-148" name="__codelineno-5-148" href="#__codelineno-5-148"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-149"><a id="__codelineno-5-149" name="__codelineno-5-149" href="#__codelineno-5-149"></a><span class="w">                </span><span class="n">Log</span><span class="p">.</span><span class="na">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Ошибка отправки в Rick.ai: </span><span class="si">${</span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
</span><span id="__span-5-150"><a id="__codelineno-5-150" name="__codelineno-5-150" href="#__codelineno-5-150"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-5-151"><a id="__codelineno-5-151" name="__codelineno-5-151" href="#__codelineno-5-151"></a><span class="w">        </span><span class="p">}.</span><span class="na">start</span><span class="p">()</span>
</span><span id="__span-5-152"><a id="__codelineno-5-152" name="__codelineno-5-152" href="#__codelineno-5-152"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-5-153"><a id="__codelineno-5-153" name="__codelineno-5-153" href="#__codelineno-5-153"></a><span class="p">}</span>
</span></code></pre></div>
</details>

### **Конфигурация API ключей:**

#### **iOS: Info.plist**
<div class="language-xml highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="cm">&lt;!-- Добавьте в Info.plist --&gt;</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nt">&lt;key&gt;</span>APPMETRICA_API_KEY<span class="nt">&lt;/key&gt;</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="nt">&lt;string&gt;</span>YOUR_APPMETRICA_API_KEY_HERE<span class="nt">&lt;/string&gt;</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="nt">&lt;key&gt;</span>ADJUST_APP_TOKEN<span class="nt">&lt;/key&gt;</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="nt">&lt;string&gt;</span>YOUR_ADJUST_APP_TOKEN_HERE<span class="nt">&lt;/string&gt;</span>
</span></code></pre></div>

#### **Android: strings.xml**
<div class="language-xml highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="cm">&lt;!-- Добавьте в res/values/strings.xml --&gt;</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="nt">&lt;resources&gt;</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span><span class="nt">&lt;string</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;appmetrica_api_key&quot;</span><span class="nt">&gt;</span>YOUR_APPMETRICA_API_KEY_HERE<span class="nt">&lt;/string&gt;</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span><span class="nt">&lt;string</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;adjust_app_token&quot;</span><span class="nt">&gt;</span>YOUR_ADJUST_APP_TOKEN_HERE<span class="nt">&lt;/string&gt;</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="nt">&lt;/resources&gt;</span>
</span></code></pre></div>

### **Чек-лист из 5 пунктов:**
1. ✅ Добавьте API ключи в Info.plist/strings.xml
2. ✅ Замените `YOUR_*_KEY` на реальные ключи
3. ✅ Добавьте код в AppDelegate/MainApplication
4. ✅ Проверьте что AppMetrica инициализируется первой
5. ✅ Запустите приложение и проверьте логи

### **Тест "работает/не работает":**
- ✅ **Работает**: В AppMetrica dashboard видите событие `adjust_attribution` с полными параметрами
- ❌ **Не работает**: В логах ошибки "API_KEY не найден" или событие отсутствует в AppMetrica

### **Параметры для проверки в AppMetrica:**
- `adjust_network` - источник трафика (yandex direct, google ads, aso organic)
- `adjust_campaign` - название кампании
- `adjust_adid` - уникальный adjust device ID устройства
- `is_first_launch` - true для новых пользователей
- `attribution_type` - "install" или "reinstall"
- `utm_source` - источник для UTM аналитики

</details>

<hr />
<details open>
<summary><strong>## 🔐 iOS App Tracking Transparency (ATT) - Обязательно!</strong></summary>

### **1.1 Что нужно для iOS ATTrackingManager:**

#### **Обязательные требования:**
- **iOS 14.5+**: ATTrackingManager доступен только с iOS 14.5
- **Info.plist**: Добавить описание использования данных
- **Timing**: Запрашивать разрешение не раньше чем через 1 секунду после запуска
- **Fallback**: Обрабатывать все статусы разрешения

#### **Что получаем при согласии:**
- **IDFA** (Identifier for Advertisers) - уникальный идентификатор
- **Полная атрибуция** - Adjust получает IDFA и точнее определяет какой пользователь перешел.

#### **Что получаем при отказе:**
- **Ограниченная атрибуция** - только через SKAdNetwork
- **Нет IDFA** - используем другие идентификаторы
- **Базовая аналитика** - основные события работают

### **1.2 Экран согласия пользователя - что написать:**

#### **✅ ПРАВИЛЬНЫЙ ТЕКСТ (высокий конверсия):**
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>🎯 Персонализированный опыт
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>Мы используем данные для:
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>• Показывать релевантные товары и предложения
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>• Анализировать эффективность рекламных кампаний
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>• Улучшать работу приложения
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>Ваши данные:
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>• Не передаются третьим лицам
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>• Используются только для улучшения сервиса
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>• Хранятся в соответствии с GDPR
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>Разрешить персонализацию?
</span></code></pre></div>

#### **❌ НЕПРАВИЛЬНЫЙ ТЕКСТ (низкая конверсия):**
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>Мы собираем ваши данные для рекламы
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>Разрешить трекинг?
</span></code></pre></div>
### **1.3 Настройка Info.plist:**

<div class="language-xml highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="cm">&lt;!-- Добавьте в Info.plist --&gt;</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="nt">&lt;key&gt;</span>NSUserTrackingUsageDescription<span class="nt">&lt;/key&gt;</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="nt">&lt;string&gt;</span>Мы<span class="w"> </span>используем<span class="w"> </span>данные<span class="w"> </span>для<span class="w"> </span>персонализации<span class="w"> </span>вашего<span class="w"> </span>опыта<span class="w"> </span>и<span class="w"> </span>показа<span class="w"> </span>подходящих<span class="w"> </span>вам<span class="w"> </span>товаров.<span class="w"> </span>Ваши<span class="w"> </span>данные<span class="w"> </span>не<span class="w"> </span>передаются<span class="w"> </span>третьим<span class="w"> </span>лицам<span class="w"> </span>и<span class="w"> </span>используются<span class="w"> </span>только<span class="w"> </span>для<span class="w"> </span>улучшения<span class="w"> </span>сервиса<span class="w"> </span>VipAvenue.<span class="nt">&lt;/string&gt;</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="nt">&lt;key&gt;</span>SKAdNetworkItems<span class="nt">&lt;/key&gt;</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="nt">&lt;array&gt;</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">    </span><span class="nt">&lt;dict&gt;</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">        </span><span class="nt">&lt;key&gt;</span>SKAdNetworkIdentifier<span class="nt">&lt;/key&gt;</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">        </span><span class="nt">&lt;string&gt;</span>v79kvwwj4g.skadnetwork<span class="nt">&lt;/string&gt;</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">    </span><span class="nt">&lt;/dict&gt;</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">    </span><span class="nt">&lt;dict&gt;</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">        </span><span class="nt">&lt;key&gt;</span>SKAdNetworkIdentifier<span class="nt">&lt;/key&gt;</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">        </span><span class="nt">&lt;string&gt;</span>22mmun2rn5.skadnetwork<span class="nt">&lt;/string&gt;</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">    </span><span class="nt">&lt;/dict&gt;</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="w">    </span><span class="cm">&lt;!-- Добавьте все нужные SKAdNetwork идентификаторы --&gt;</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="nt">&lt;/array&gt;</span>
</span></code></pre></div>

### **1.4 Обработка всех статусов:**

<div class="language-swift highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1">// В AppDelegate добавьте:</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="kd">private</span> <span class="kd">func</span> <span class="nf">handleTrackingAuthorizationStatus</span><span class="p">(</span><span class="kc">_</span> <span class="n">status</span><span class="p">:</span> <span class="bp">ATTrackingManager</span><span class="p">.</span><span class="n">AuthorizationStatus</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>    <span class="k">switch</span> <span class="n">status</span> <span class="p">{</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>    <span class="k">case</span> <span class="p">.</span><span class="n">authorized</span><span class="p">:</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>        <span class="c1">// ✅ Пользователь согласился - полная аналитика</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>        <span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Трекинг разрешен - используем IDFA&quot;</span><span class="p">)</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>        <span class="kd">let</span> <span class="nv">idfa</span> <span class="p">=</span> <span class="bp">ASIdentifierManager</span><span class="p">.</span><span class="n">shared</span><span class="p">().</span><span class="n">advertisingIdentifier</span><span class="p">.</span><span class="n">uuidString</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>        <span class="c1">// Отправляем событие о согласии</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>        <span class="n">AppMetrica</span><span class="p">.</span><span class="n">reportEvent</span><span class="p">(</span><span class="s">&quot;tracking_authorized&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>            <span class="s">&quot;idfa&quot;</span><span class="p">:</span> <span class="n">idfa</span><span class="p">,</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>            <span class="s">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">Date</span><span class="p">().</span><span class="n">timeIntervalSince1970</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>        <span class="p">])</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>    <span class="k">case</span> <span class="p">.</span><span class="n">denied</span><span class="p">:</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>        <span class="c1">// ❌ Пользователь отказал - ограниченная аналитика</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>        <span class="n">logger</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Трекинг отклонен - используем SKAdNetwork&quot;</span><span class="p">)</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>        <span class="n">AppMetrica</span><span class="p">.</span><span class="n">reportEvent</span><span class="p">(</span><span class="s">&quot;tracking_denied&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>            <span class="s">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">Date</span><span class="p">().</span><span class="n">timeIntervalSince1970</span><span class="p">,</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>            <span class="s">&quot;reason&quot;</span><span class="p">:</span> <span class="s">&quot;user_denied&quot;</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>        <span class="p">])</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>    <span class="k">case</span> <span class="p">.</span><span class="n">restricted</span><span class="p">:</span>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>        <span class="c1">// ⚠️ Система ограничила - ограниченная аналитика</span>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>        <span class="n">logger</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Трекинг ограничен системой&quot;</span><span class="p">)</span>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>        <span class="n">AppMetrica</span><span class="p">.</span><span class="n">reportEvent</span><span class="p">(</span><span class="s">&quot;tracking_restricted&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>            <span class="s">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">Date</span><span class="p">().</span><span class="n">timeIntervalSince1970</span><span class="p">,</span>
</span><span id="__span-11-28"><a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a>            <span class="s">&quot;reason&quot;</span><span class="p">:</span> <span class="s">&quot;system_restricted&quot;</span>
</span><span id="__span-11-29"><a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>        <span class="p">])</span>
</span><span id="__span-11-30"><a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a>
</span><span id="__span-11-31"><a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a>    <span class="k">case</span> <span class="p">.</span><span class="n">notDetermined</span><span class="p">:</span>
</span><span id="__span-11-32"><a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a>        <span class="c1">// 🔄 Статус не определен</span>
</span><span id="__span-11-33"><a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a>        <span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Статус трекинга не определен&quot;</span><span class="p">)</span>
</span><span id="__span-11-34"><a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a>
</span><span id="__span-11-35"><a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a>    <span class="p">@</span><span class="n">unknown</span> <span class="k">default</span><span class="p">:</span>
</span><span id="__span-11-36"><a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a>        <span class="n">logger</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Неизвестный статус трекинга&quot;</span><span class="p">)</span>
</span><span id="__span-11-37"><a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a>    <span class="p">}</span>
</span><span id="__span-11-38"><a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a><span class="p">}</span>
</span></code></pre></div>

### **1.5 Чек-лист для ATT:**
1. ✅ Добавлен `NSUserTrackingUsageDescription` в Info.plist
2. ✅ Добавлены `SKAdNetworkItems` для fallback
3. ✅ Запрос разрешения через 1+ секунду после запуска
4. ✅ Обработка всех статусов разрешения
5. ✅ Логирование событий согласия/отказа
6. ✅ Тестирование на реальном устройстве iOS 14.5+
7. ✅ Проверка что App Store не отклоняет приложение

</details>

<hr />
<details open>
<summary><strong>🔄 СХЕМА РАБОТЫ ADJUST И APPMETRICA</strong></summary>


### **Как работает интеграция по коду:**

<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>│   Реклама с     │───▶│  Adjust Tracker │───▶│   Adjust SDK    │
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>│      UTM        │    │                 │    │                 │
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>└─────────────────┘    └─────────────────┘    └─────────┬───────┘
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>                                                        │
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>                                                        ▼
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>│  Analytics      │◀───│  AppMetrica SDK │◀───│ Attribution     │
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>│   Dashboard     │    │                 │    │   Callback      │
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>└─────────────────┘    └─────────────────┘    └─────────────────┘
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>┌─────────────────┐    ┌─────────────────┐
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>│ Rick.ai         │◀───│  flow.rick.ai   │
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>│ (выгружает      │    │  (логирование)  │
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>│ данные из       │    │                 │
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>│ AppMetrica)     │    └─────────────────┘
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>└─────────┬───────┘
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>          │
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>          ▼
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>┌─────────────────┐    ┌─────────────────┐
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>│ Rick.js сниппет │───▶│  Веб-сайт       │
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>│ (на сайте)      │    │  (VipAvenue)    │
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>└─────────────────┘    └─────────────────┘
</span></code></pre></div>

### **Поток данных:**

#### **1. Мобильное приложение:**
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>1. Пользователь устанавливает приложение
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>2. Adjust получает attribution данные
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>3. Adjust отправляет данные в AppMetrica через callback
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>4. AppMetrica сохраняет данные в своем dashboard
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>5. Данные отправляются в flow.rick.ai для логирования
</span></code></pre></div>

#### **2. Веб-сайт:**
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>1. Rick.js сниппет размещен на сайте
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>2. Rick.js может принимать идентификаторы из URL
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>3. Rick.js записывает данные в Яндекс.Метрику
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>4. Rick.js НЕ работает с мобильным приложением напрямую
</span></code></pre></div>

#### **3. Дополнительные функции:**
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>1. Rick.js может помогать размещать данные в URL для кнопок установки
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>2. Rick.ai выгружает данные из AppMetrica для анализа
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>3. Кросс-платформенная связь через URL параметры
</span></code></pre></div>

</details>

<hr />
<details open>
<summary><strong>💰 ЭКОНОМИЧЕСКОЕ ОБОСНОВАНИЕ: Adjust vs AppsFlyer</strong></summary>

### **Сравнительная таблица стоимости (2025):**

| Параметр | Adjust | AppsFlyer |
|----------|--------|-----------|
| **Бесплатный план** | ✅ 12 месяцев + 1,500 атрибуций/мес | ❌ Ограниченный план "Ноль" |
| **Платный план** | $0.06/attribution | $0.08/attribution |
| **Минимальный контракт** | Нет | 12 месяцев |
| **Setup fee** | $0 | $500-2000 |
| **Partner fees** | Нет | 15-25% от стоимости |
| **API access** | ✅ Включено | ❌ Дополнительно $200/мес |
| **Raw Data Export** | ✅ Включено | ❌ Дополнительно $300/мес |
| **Protect360** | ✅ Включено | ❌ Дополнительно $500/мес |

### **Расчет ROI для проекта VipAvenue:**

#### **Сценарий 1: 10,000 атрибуций/месяц**
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>Adjust:
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>- Стоимость: 10,000 × $0.06 = $600/мес
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>- Годовая стоимость: $7,200
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>AppsFlyer:
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>- Стоимость: 10,000 × $0.08 = $800/мес
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>- Partner fees: $800 × 20% = $160/мес
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>- API access: $200/мес
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>- Годовая стоимость: $13,920
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>Экономия с Adjust: $6,720/год (48% дешевле)
</span></code></pre></div>

#### **Сценарий 2: 50,000 атрибуций/месяц**
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>Adjust:
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>- Стоимость: 50,000 × $0.06 = $3,000/мес
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>- Годовая стоимость: $36,000
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>AppsFlyer:
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>- Стоимость: 50,000 × $0.08 = $4,000/мес
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>- Partner fees: $4,000 × 20% = $800/мес
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>- API access: $200/мес
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>- Годовая стоимость: $60,000
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>Экономия с Adjust: $24,000/год (40% дешевле)
</span></code></pre></div>

### **Детали исследования рынка:**

#### **Доля рынка (2025):**
- **AppsFlyer**: 35% (лидер рынка)
- **Adjust**: 15% (растущий игрок)
- **Branch**: 12%
- **Kochava**: 8%
- **Другие**: 30%

#### **Преимущества Adjust для стартапов:**
1. **Гибкость контрактов** - нет минимальных обязательств
2. **Прозрачное ценообразование** - без скрытых платежей
3. **Быстрая интеграция** - 1-3 часа vs 2-4 часа у AppsFlyer
4. **Лучшая поддержка** - персональный аккаунт-менеджер
5. **Инновации** - быстрее внедряет новые функции

#### **Преимущества AppsFlyer для enterprise:**
1. **Больше интеграций** - 4,000+ партнеров
2. **Глобальное присутствие** - офисы в 20+ странах
3. **Enterprise features** - продвинутая аналитика
4. **Бренд-узнаваемость** - "золотой стандарт" индустрии

### **Рекомендация для VipAvenue:**

#### **✅ ВЫБИРАЕМ ADJUST потому что:**
1. **Экономия бюджета** - 40-48% дешевле AppsFlyer
2. **Гибкость** - нет долгосрочных контрактов
3. **Простота** - быстрая интеграция и настройка
4. **Качество** - достаточный функционал для проекта
5. **Масштабируемость** - легко перейти на более дорогие планы

#### **⚠️ КОГДА РАССМОТРЕТЬ APPSFLYER:**
1. **Бюджет > $50K/мес** на атрибуцию
2. **Нужны 4,000+ интеграций** с партнерами
3. **Enterprise требования** к безопасности
4. **Глобальная экспансия** в 50+ стран

### **План миграции (если понадобится):**
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>Месяц 1-3: Adjust (тестирование)
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>Месяц 4-6: Параллельная работа Adjust + AppsFlyer
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>Месяц 7+: Полная миграция на выбранную платформу
</span></code></pre></div>

</details>

<hr />
<details open>
<summary><strong>🔗 DEEP LINKS И UTM-МЕТКИ ДЛЯ РЕКЛАМНЫХ КАМПАНИЙ</strong></summary>

### **КРИТИЧНО: Правильная настройка Deep Links для Adjust + AppMetrica**


### **Структура Deep Link URL для правильной атрибуции:**

#### **Сценарий A: Приложение установлено**
- Adjust открывает приложение сразу через deep link (например: `vipavenue://catalog/product123`)
- В `AppDelegate` или `SceneDelegate` нужно перехватить URL (см. код ниже) и обработать
- Событие открытия deep link фиксируется в AppMetrica

#### **Сценарий B: Приложение не установлено**
- Adjust открывает fallback URL (обычно это ссылка на Store)
- После установки и первого запуска Adjust делает deferred deep linking — отдаёт сохранённый deep link в SDK
- AppMetrica в этот момент тоже может получить `install_referrer` с UTM-метками

#### **Примеры ссылок с реальными продуктами VipAvenue:**

<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>// Adjust tracking link с deep link
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>https://app.adjust.com/abc123?campaign=summer_dresses&amp;adgroup=premium_brands&amp;
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>creative=video_banner&amp;deep_link=vipavenue://catalog/womens/clothes/dresses/brunello-cucinelli-cotton-dress
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>// Universal link для VipAvenue
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>https://vipavenue.ru/deep-link?
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>utm_source=facebook&amp;
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>utm_medium=cpc&amp;
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>utm_campaign=summer2025_dresses&amp;
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>utm_content=video_ad&amp;
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>utm_term=brunello_cucinelli&amp;
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>adjust_tracker=abc123&amp;
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>adjust_campaign=summer2025&amp;
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>adjust_adgroup=premium_dresses&amp;
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>adjust_creative=video_banner&amp;
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>product_id=brunello-cucinelli-cotton-dress&amp;
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a>product_name=Платье хлопковое BRUNELLO CUCINELLI&amp;
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a>product_price=527800&amp;
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>deep_link_path=/catalog/womens/clothes/dresses/brunello-cucinelli-cotton-dress
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a>// Пример для платья со скидкой
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a>https://vipavenue.ru/deep-link?
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a>utm_source=yandex&amp;
</span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a>utm_medium=cpc&amp;
</span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a>utm_campaign=summer_sale_2025&amp;
</span><span id="__span-19-26"><a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a>utm_content=story_ad&amp;
</span><span id="__span-19-27"><a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a>utm_term=discount&amp;
</span><span id="__span-19-28"><a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a>adjust_tracker=def456&amp;
</span><span id="__span-19-29"><a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a>adjust_campaign=summer_sale&amp;
</span><span id="__span-19-30"><a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a>adjust_adgroup=discount_dresses&amp;
</span><span id="__span-19-31"><a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a>adjust_creative=story_banner&amp;
</span><span id="__span-19-32"><a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a>product_id=seven-lab-cotton-dress&amp;
</span><span id="__span-19-33"><a id="__codelineno-19-33" name="__codelineno-19-33" href="#__codelineno-19-33"></a>product_name=Платье хлопковое SEVEN LAB&amp;
</span><span id="__span-19-34"><a id="__codelineno-19-34" name="__codelineno-19-34" href="#__codelineno-19-34"></a>product_price=18900&amp;
</span><span id="__span-19-35"><a id="__codelineno-19-35" name="__codelineno-19-35" href="#__codelineno-19-35"></a>original_price=27000&amp;
</span><span id="__span-19-36"><a id="__codelineno-19-36" name="__codelineno-19-36" href="#__codelineno-19-36"></a>discount_percent=30&amp;
</span><span id="__span-19-37"><a id="__codelineno-19-37" name="__codelineno-19-37" href="#__codelineno-19-37"></a>deep_link_path=/catalog/womens/clothes/dresses/seven-lab-cotton-dress
</span></code></pre></div>

### **Обработка Deep Links в приложении:**

#### **iOS: Universal Links setup**
<div class="language-swift highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1">// В Info.plist добавьте:</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="p">&lt;</span><span class="n">key</span><span class="p">&gt;</span><span class="n">com</span><span class="p">.</span><span class="n">apple</span><span class="p">.</span><span class="n">developer</span><span class="p">.</span><span class="n">associated</span><span class="o">-</span><span class="n">domains</span><span class="o">&lt;/</span><span class="n">key</span><span class="p">&gt;</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="p">&lt;</span><span class="n">array</span><span class="p">&gt;</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>    <span class="p">&lt;</span><span class="n">string</span><span class="p">&gt;</span><span class="n">applinks</span><span class="p">:</span><span class="n">vipavenue</span><span class="p">.</span><span class="n">ru</span><span class="o">&lt;/</span><span class="n">string</span><span class="p">&gt;</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="o">&lt;/</span><span class="n">array</span><span class="p">&gt;</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="c1">// В AppDelegate:</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="kc">_</span> <span class="n">application</span><span class="p">:</span> <span class="bp">UIApplication</span><span class="p">,</span> <span class="k">continue</span> <span class="n">userActivity</span><span class="p">:</span> <span class="bp">NSUserActivity</span><span class="p">,</span> <span class="n">restorationHandler</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="p">([</span><span class="bp">UIUserActivityRestoring</span><span class="p">]?)</span> <span class="p">-&gt;</span> <span class="nb">Void</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Bool</span> <span class="p">{</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>    <span class="k">if</span> <span class="n">userActivity</span><span class="p">.</span><span class="n">activityType</span> <span class="p">==</span> <span class="n">NSUserActivityTypeBrowsingWeb</span> <span class="p">{</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>        <span class="k">if</span> <span class="kd">let</span> <span class="nv">url</span> <span class="p">=</span> <span class="n">userActivity</span><span class="p">.</span><span class="n">webpageURL</span> <span class="p">{</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>            <span class="c1">// Обрабатываем deep link</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>            <span class="n">handleDeepLink</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>            <span class="k">return</span> <span class="kc">true</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>        <span class="p">}</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>    <span class="p">}</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>    <span class="k">return</span> <span class="kc">false</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="p">}</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="c1">// Обработка deep link</span>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a><span class="kd">func</span> <span class="nf">handleDeepLink</span><span class="p">(</span><span class="kc">_</span> <span class="n">url</span><span class="p">:</span> <span class="n">URL</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a>    <span class="k">guard</span> <span class="kd">let</span> <span class="nv">components</span> <span class="p">=</span> <span class="n">URLComponents</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="n">resolvingAgainstBaseURL</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a>        <span class="n">logger</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;Invalid deep link URL: </span><span class="si">\(</span><span class="n">url</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a>        <span class="k">return</span>
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a>    <span class="p">}</span>
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a>
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a>    <span class="c1">// Парсим UTM параметры</span>
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a>    <span class="kd">var</span> <span class="nv">utmParams</span><span class="p">:</span> <span class="p">[</span><span class="nb">String</span><span class="p">:</span> <span class="nb">String</span><span class="p">]</span> <span class="p">=</span> <span class="p">[:]</span>
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a>    <span class="kd">var</span> <span class="nv">adjustParams</span><span class="p">:</span> <span class="p">[</span><span class="nb">String</span><span class="p">:</span> <span class="nb">String</span><span class="p">]</span> <span class="p">=</span> <span class="p">[:]</span>
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a>    <span class="kd">var</span> <span class="nv">customParams</span><span class="p">:</span> <span class="p">[</span><span class="nb">String</span><span class="p">:</span> <span class="nb">String</span><span class="p">]</span> <span class="p">=</span> <span class="p">[:]</span>
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a>
</span><span id="__span-20-31"><a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a>    <span class="n">components</span><span class="p">.</span><span class="n">queryItems</span><span class="p">?.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">item</span> <span class="k">in</span>
</span><span id="__span-20-32"><a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a>        <span class="k">if</span> <span class="n">item</span><span class="p">.</span><span class="n">name</span><span class="p">.</span><span class="n">hasPrefix</span><span class="p">(</span><span class="s">&quot;utm_&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-20-33"><a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a>            <span class="n">utmParams</span><span class="p">[</span><span class="n">item</span><span class="p">.</span><span class="n">name</span><span class="p">]</span> <span class="p">=</span> <span class="n">item</span><span class="p">.</span><span class="n">value</span>
</span><span id="__span-20-34"><a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a>        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">item</span><span class="p">.</span><span class="n">name</span><span class="p">.</span><span class="n">hasPrefix</span><span class="p">(</span><span class="s">&quot;adjust_&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-20-35"><a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a>            <span class="n">adjustParams</span><span class="p">[</span><span class="n">item</span><span class="p">.</span><span class="n">name</span><span class="p">]</span> <span class="p">=</span> <span class="n">item</span><span class="p">.</span><span class="n">value</span>
</span><span id="__span-20-36"><a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-20-37"><a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a>            <span class="n">customParams</span><span class="p">[</span><span class="n">item</span><span class="p">.</span><span class="n">name</span><span class="p">]</span> <span class="p">=</span> <span class="n">item</span><span class="p">.</span><span class="n">value</span>
</span><span id="__span-20-38"><a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a>        <span class="p">}</span>
</span><span id="__span-20-39"><a id="__codelineno-20-39" name="__codelineno-20-39" href="#__codelineno-20-39"></a>    <span class="p">}</span>
</span><span id="__span-20-40"><a id="__codelineno-20-40" name="__codelineno-20-40" href="#__codelineno-20-40"></a>
</span><span id="__span-20-41"><a id="__codelineno-20-41" name="__codelineno-20-41" href="#__codelineno-20-41"></a>    <span class="c1">// Сохраняем UTM параметры</span>
</span><span id="__span-20-42"><a id="__codelineno-20-42" name="__codelineno-20-42" href="#__codelineno-20-42"></a>    <span class="n">UserDefaults</span><span class="p">.</span><span class="n">standard</span><span class="p">.</span><span class="kr">set</span><span class="p">(</span><span class="n">utmParams</span><span class="p">,</span> <span class="n">forKey</span><span class="p">:</span> <span class="s">&quot;deep_link_utm_params&quot;</span><span class="p">)</span>
</span><span id="__span-20-43"><a id="__codelineno-20-43" name="__codelineno-20-43" href="#__codelineno-20-43"></a>
</span><span id="__span-20-44"><a id="__codelineno-20-44" name="__codelineno-20-44" href="#__codelineno-20-44"></a>    <span class="c1">// Трекаем deep link событие</span>
</span><span id="__span-20-45"><a id="__codelineno-20-45" name="__codelineno-20-45" href="#__codelineno-20-45"></a>    <span class="kd">let</span> <span class="nv">deepLinkParams</span> <span class="p">=</span> <span class="p">[</span>
</span><span id="__span-20-46"><a id="__codelineno-20-46" name="__codelineno-20-46" href="#__codelineno-20-46"></a>        <span class="s">&quot;deep_link_url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">.</span><span class="n">absoluteString</span><span class="p">,</span>
</span><span id="__span-20-47"><a id="__codelineno-20-47" name="__codelineno-20-47" href="#__codelineno-20-47"></a>        <span class="s">&quot;deep_link_source&quot;</span><span class="p">:</span> <span class="n">utmParams</span><span class="p">[</span><span class="s">&quot;utm_source&quot;</span><span class="p">]</span> <span class="p">??</span> <span class="s">&quot;deep_link&quot;</span><span class="p">,</span>
</span><span id="__span-20-48"><a id="__codelineno-20-48" name="__codelineno-20-48" href="#__codelineno-20-48"></a>        <span class="s">&quot;deep_link_campaign&quot;</span><span class="p">:</span> <span class="n">utmParams</span><span class="p">[</span><span class="s">&quot;utm_campaign&quot;</span><span class="p">]</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-20-49"><a id="__codelineno-20-49" name="__codelineno-20-49" href="#__codelineno-20-49"></a>        <span class="s">&quot;deep_link_medium&quot;</span><span class="p">:</span> <span class="n">utmParams</span><span class="p">[</span><span class="s">&quot;utm_medium&quot;</span><span class="p">]</span> <span class="p">??</span> <span class="s">&quot;deep_link&quot;</span><span class="p">,</span>
</span><span id="__span-20-50"><a id="__codelineno-20-50" name="__codelineno-20-50" href="#__codelineno-20-50"></a>        <span class="s">&quot;deep_link_path&quot;</span><span class="p">:</span> <span class="n">components</span><span class="p">.</span><span class="n">path</span><span class="p">,</span>
</span><span id="__span-20-51"><a id="__codelineno-20-51" name="__codelineno-20-51" href="#__codelineno-20-51"></a>        <span class="s">&quot;product_id&quot;</span><span class="p">:</span> <span class="n">customParams</span><span class="p">[</span><span class="s">&quot;product_id&quot;</span><span class="p">]</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-20-52"><a id="__codelineno-20-52" name="__codelineno-20-52" href="#__codelineno-20-52"></a>        <span class="s">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">customParams</span><span class="p">[</span><span class="s">&quot;user_id&quot;</span><span class="p">]</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span>
</span><span id="__span-20-53"><a id="__codelineno-20-53" name="__codelineno-20-53" href="#__codelineno-20-53"></a>    <span class="p">]</span>
</span><span id="__span-20-54"><a id="__codelineno-20-54" name="__codelineno-20-54" href="#__codelineno-20-54"></a>
</span><span id="__span-20-55"><a id="__codelineno-20-55" name="__codelineno-20-55" href="#__codelineno-20-55"></a>    <span class="c1">// ✅ Отправляем в AppMetrica с adjust_adid</span>
</span><span id="__span-20-56"><a id="__codelineno-20-56" name="__codelineno-20-56" href="#__codelineno-20-56"></a>    <span class="kd">let</span> <span class="nv">adjustAdid</span> <span class="p">=</span> <span class="n">Adjust</span><span class="p">.</span><span class="n">adid</span><span class="p">()</span>
</span><span id="__span-20-57"><a id="__codelineno-20-57" name="__codelineno-20-57" href="#__codelineno-20-57"></a>    <span class="kd">var</span> <span class="nv">deepLinkParamsWithAdjustID</span> <span class="p">=</span> <span class="n">deepLinkParams</span>
</span><span id="__span-20-58"><a id="__codelineno-20-58" name="__codelineno-20-58" href="#__codelineno-20-58"></a>    <span class="n">deepLinkParamsWithAdjustID</span><span class="p">[</span><span class="s">&quot;adjust_adid&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">adjustAdid</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span>
</span><span id="__span-20-59"><a id="__codelineno-20-59" name="__codelineno-20-59" href="#__codelineno-20-59"></a>    <span class="n">AppMetrica</span><span class="p">.</span><span class="n">reportEvent</span><span class="p">(</span><span class="s">&quot;deep_link_opened&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">deepLinkParamsWithAdjustID</span><span class="p">)</span>
</span><span id="__span-20-60"><a id="__codelineno-20-60" name="__codelineno-20-60" href="#__codelineno-20-60"></a>
</span><span id="__span-20-61"><a id="__codelineno-20-61" name="__codelineno-20-61" href="#__codelineno-20-61"></a>    <span class="c1">// Отправляем в Adjust</span>
</span><span id="__span-20-62"><a id="__codelineno-20-62" name="__codelineno-20-62" href="#__codelineno-20-62"></a>    <span class="kd">let</span> <span class="nv">adjustEvent</span> <span class="p">=</span> <span class="n">ADJEvent</span><span class="p">(</span><span class="n">eventToken</span><span class="p">:</span> <span class="s">&quot;YOUR_DEEP_LINK_EVENT_TOKEN&quot;</span><span class="p">)</span>
</span><span id="__span-20-63"><a id="__codelineno-20-63" name="__codelineno-20-63" href="#__codelineno-20-63"></a>    <span class="n">adjustEvent</span><span class="p">?.</span><span class="n">addCallbackParameter</span><span class="p">(</span><span class="s">&quot;deep_link_source&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">utmParams</span><span class="p">[</span><span class="s">&quot;utm_source&quot;</span><span class="p">]</span> <span class="p">??</span> <span class="s">&quot;deep_link&quot;</span><span class="p">)</span>
</span><span id="__span-20-64"><a id="__codelineno-20-64" name="__codelineno-20-64" href="#__codelineno-20-64"></a>    <span class="n">adjustEvent</span><span class="p">?.</span><span class="n">addCallbackParameter</span><span class="p">(</span><span class="s">&quot;deep_link_campaign&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">utmParams</span><span class="p">[</span><span class="s">&quot;utm_campaign&quot;</span><span class="p">]</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="__span-20-65"><a id="__codelineno-20-65" name="__codelineno-20-65" href="#__codelineno-20-65"></a>    <span class="n">adjustEvent</span><span class="p">?.</span><span class="n">addCallbackParameter</span><span class="p">(</span><span class="s">&quot;product_id&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">customParams</span><span class="p">[</span><span class="s">&quot;product_id&quot;</span><span class="p">]</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="__span-20-66"><a id="__codelineno-20-66" name="__codelineno-20-66" href="#__codelineno-20-66"></a>    <span class="n">Adjust</span><span class="p">.</span><span class="n">trackEvent</span><span class="p">(</span><span class="n">adjustEvent</span><span class="p">)</span>
</span><span id="__span-20-67"><a id="__codelineno-20-67" name="__codelineno-20-67" href="#__codelineno-20-67"></a>
</span><span id="__span-20-68"><a id="__codelineno-20-68" name="__codelineno-20-68" href="#__codelineno-20-68"></a>    <span class="c1">// Логируем в flow.rick.ai</span>
</span><span id="__span-20-69"><a id="__codelineno-20-69" name="__codelineno-20-69" href="#__codelineno-20-69"></a>    <span class="n">logDeepLinkToRickAI</span><span class="p">(</span><span class="n">deepLinkParams</span><span class="p">:</span> <span class="n">deepLinkParams</span><span class="p">,</span> <span class="n">utmParams</span><span class="p">:</span> <span class="n">utmParams</span><span class="p">,</span> <span class="n">customParams</span><span class="p">:</span> <span class="n">customParams</span><span class="p">)</span>
</span><span id="__span-20-70"><a id="__codelineno-20-70" name="__codelineno-20-70" href="#__codelineno-20-70"></a>
</span><span id="__span-20-71"><a id="__codelineno-20-71" name="__codelineno-20-71" href="#__codelineno-20-71"></a>    <span class="c1">// Обрабатываем deep link path</span>
</span><span id="__span-20-72"><a id="__codelineno-20-72" name="__codelineno-20-72" href="#__codelineno-20-72"></a>    <span class="n">handleDeepLinkPath</span><span class="p">(</span><span class="n">components</span><span class="p">.</span><span class="n">path</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">customParams</span><span class="p">)</span>
</span><span id="__span-20-73"><a id="__codelineno-20-73" name="__codelineno-20-73" href="#__codelineno-20-73"></a><span class="p">}</span>
</span><span id="__span-20-74"><a id="__codelineno-20-74" name="__codelineno-20-74" href="#__codelineno-20-74"></a>
</span><span id="__span-20-75"><a id="__codelineno-20-75" name="__codelineno-20-75" href="#__codelineno-20-75"></a><span class="c1">// Обработка конкретного пути deep link</span>
</span><span id="__span-20-76"><a id="__codelineno-20-76" name="__codelineno-20-76" href="#__codelineno-20-76"></a><span class="kd">func</span> <span class="nf">handleDeepLinkPath</span><span class="p">(</span><span class="kc">_</span> <span class="n">path</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="p">[</span><span class="nb">String</span><span class="p">:</span> <span class="nb">String</span><span class="p">])</span> <span class="p">{</span>
</span><span id="__span-20-77"><a id="__codelineno-20-77" name="__codelineno-20-77" href="#__codelineno-20-77"></a>    <span class="k">switch</span> <span class="n">path</span> <span class="p">{</span>
</span><span id="__span-20-78"><a id="__codelineno-20-78" name="__codelineno-20-78" href="#__codelineno-20-78"></a>    <span class="k">case</span> <span class="s">&quot;/catalog/womens/clothes/dresses&quot;</span><span class="p">:</span>
</span><span id="__span-20-79"><a id="__codelineno-20-79" name="__codelineno-20-79" href="#__codelineno-20-79"></a>        <span class="c1">// Открываем каталог платьев</span>
</span><span id="__span-20-80"><a id="__codelineno-20-80" name="__codelineno-20-80" href="#__codelineno-20-80"></a>        <span class="k">if</span> <span class="kd">let</span> <span class="nv">productId</span> <span class="p">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s">&quot;product_id&quot;</span><span class="p">]</span> <span class="p">{</span>
</span><span id="__span-20-81"><a id="__codelineno-20-81" name="__codelineno-20-81" href="#__codelineno-20-81"></a>            <span class="n">navigateToProduct</span><span class="p">(</span><span class="n">productId</span><span class="p">:</span> <span class="n">productId</span><span class="p">)</span>
</span><span id="__span-20-82"><a id="__codelineno-20-82" name="__codelineno-20-82" href="#__codelineno-20-82"></a>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-20-83"><a id="__codelineno-20-83" name="__codelineno-20-83" href="#__codelineno-20-83"></a>            <span class="n">navigateToCatalog</span><span class="p">(</span><span class="n">category</span><span class="p">:</span> <span class="s">&quot;dresses&quot;</span><span class="p">)</span>
</span><span id="__span-20-84"><a id="__codelineno-20-84" name="__codelineno-20-84" href="#__codelineno-20-84"></a>        <span class="p">}</span>
</span><span id="__span-20-85"><a id="__codelineno-20-85" name="__codelineno-20-85" href="#__codelineno-20-85"></a>    <span class="k">case</span> <span class="s">&quot;/catalog&quot;</span><span class="p">:</span>
</span><span id="__span-20-86"><a id="__codelineno-20-86" name="__codelineno-20-86" href="#__codelineno-20-86"></a>        <span class="c1">// Открываем общий каталог</span>
</span><span id="__span-20-87"><a id="__codelineno-20-87" name="__codelineno-20-87" href="#__codelineno-20-87"></a>        <span class="n">navigateToCatalog</span><span class="p">(</span><span class="n">category</span><span class="p">:</span> <span class="n">parameters</span><span class="p">[</span><span class="s">&quot;category&quot;</span><span class="p">]</span> <span class="p">??</span> <span class="s">&quot;all&quot;</span><span class="p">)</span>
</span><span id="__span-20-88"><a id="__codelineno-20-88" name="__codelineno-20-88" href="#__codelineno-20-88"></a>    <span class="k">default</span><span class="p">:</span>
</span><span id="__span-20-89"><a id="__codelineno-20-89" name="__codelineno-20-89" href="#__codelineno-20-89"></a>        <span class="c1">// Открываем главный экран</span>
</span><span id="__span-20-90"><a id="__codelineno-20-90" name="__codelineno-20-90" href="#__codelineno-20-90"></a>        <span class="n">navigateToMainScreen</span><span class="p">()</span>
</span><span id="__span-20-91"><a id="__codelineno-20-91" name="__codelineno-20-91" href="#__codelineno-20-91"></a>    <span class="p">}</span>
</span><span id="__span-20-92"><a id="__codelineno-20-92" name="__codelineno-20-92" href="#__codelineno-20-92"></a><span class="p">}</span>
</span><span id="__span-20-93"><a id="__codelineno-20-93" name="__codelineno-20-93" href="#__codelineno-20-93"></a>
</span><span id="__span-20-94"><a id="__codelineno-20-94" name="__codelineno-20-94" href="#__codelineno-20-94"></a><span class="c1">// Логирование в flow.rick.ai</span>
</span><span id="__span-20-95"><a id="__codelineno-20-95" name="__codelineno-20-95" href="#__codelineno-20-95"></a><span class="kd">func</span> <span class="nf">logDeepLinkToRickAI</span><span class="p">(</span><span class="n">deepLinkParams</span><span class="p">:</span> <span class="p">[</span><span class="nb">String</span><span class="p">:</span> <span class="nb">Any</span><span class="p">],</span> <span class="n">utmParams</span><span class="p">:</span> <span class="p">[</span><span class="nb">String</span><span class="p">:</span> <span class="nb">String</span><span class="p">],</span> <span class="n">customParams</span><span class="p">:</span> <span class="p">[</span><span class="nb">String</span><span class="p">:</span> <span class="nb">String</span><span class="p">])</span> <span class="p">{</span>
</span><span id="__span-20-96"><a id="__codelineno-20-96" name="__codelineno-20-96" href="#__codelineno-20-96"></a>    <span class="kd">let</span> <span class="nv">logData</span><span class="p">:</span> <span class="p">[</span><span class="nb">String</span><span class="p">:</span> <span class="nb">Any</span><span class="p">]</span> <span class="p">=</span> <span class="p">[</span>
</span><span id="__span-20-97"><a id="__codelineno-20-97" name="__codelineno-20-97" href="#__codelineno-20-97"></a>        <span class="s">&quot;event_type&quot;</span><span class="p">:</span> <span class="s">&quot;deep_link_opened&quot;</span><span class="p">,</span>
</span><span id="__span-20-98"><a id="__codelineno-20-98" name="__codelineno-20-98" href="#__codelineno-20-98"></a>        <span class="s">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">ISO8601DateFormatter</span><span class="p">().</span><span class="n">string</span><span class="p">(</span><span class="n">from</span><span class="p">:</span> <span class="n">Date</span><span class="p">()),</span>
</span><span id="__span-20-99"><a id="__codelineno-20-99" name="__codelineno-20-99" href="#__codelineno-20-99"></a>        <span class="s">&quot;deep_link_data&quot;</span><span class="p">:</span> <span class="n">deepLinkParams</span><span class="p">,</span>
</span><span id="__span-20-100"><a id="__codelineno-20-100" name="__codelineno-20-100" href="#__codelineno-20-100"></a>        <span class="s">&quot;utm_data&quot;</span><span class="p">:</span> <span class="n">utmParams</span><span class="p">,</span>
</span><span id="__span-20-101"><a id="__codelineno-20-101" name="__codelineno-20-101" href="#__codelineno-20-101"></a>        <span class="s">&quot;custom_data&quot;</span><span class="p">:</span> <span class="n">customParams</span><span class="p">,</span>
</span><span id="__span-20-102"><a id="__codelineno-20-102" name="__codelineno-20-102" href="#__codelineno-20-102"></a>        <span class="s">&quot;app_info&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-20-103"><a id="__codelineno-20-103" name="__codelineno-20-103" href="#__codelineno-20-103"></a>            <span class="s">&quot;app_id&quot;</span><span class="p">:</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">bundleIdentifier</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-20-104"><a id="__codelineno-20-104" name="__codelineno-20-104" href="#__codelineno-20-104"></a>            <span class="s">&quot;platform&quot;</span><span class="p">:</span> <span class="s">&quot;ios&quot;</span><span class="p">,</span>
</span><span id="__span-20-105"><a id="__codelineno-20-105" name="__codelineno-20-105" href="#__codelineno-20-105"></a>            <span class="s">&quot;version&quot;</span><span class="p">:</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">infoDictionary</span><span class="p">?[</span><span class="s">&quot;CFBundleShortVersionString&quot;</span><span class="p">]</span> <span class="k">as</span><span class="p">?</span> <span class="nb">String</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span>
</span><span id="__span-20-106"><a id="__codelineno-20-106" name="__codelineno-20-106" href="#__codelineno-20-106"></a>        <span class="p">],</span>
</span><span id="__span-20-107"><a id="__codelineno-20-107" name="__codelineno-20-107" href="#__codelineno-20-107"></a>        <span class="s">&quot;device_info&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-20-108"><a id="__codelineno-20-108" name="__codelineno-20-108" href="#__codelineno-20-108"></a>            <span class="s">&quot;device_id&quot;</span><span class="p">:</span> <span class="n">Adjust</span><span class="p">.</span><span class="n">adid</span><span class="p">()</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-20-109"><a id="__codelineno-20-109" name="__codelineno-20-109" href="#__codelineno-20-109"></a>            <span class="s">&quot;appmetrica_device_id&quot;</span><span class="p">:</span> <span class="n">AppMetrica</span><span class="p">.</span><span class="n">deviceID</span><span class="p">()</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span>
</span><span id="__span-20-110"><a id="__codelineno-20-110" name="__codelineno-20-110" href="#__codelineno-20-110"></a>        <span class="p">]</span>
</span><span id="__span-20-111"><a id="__codelineno-20-111" name="__codelineno-20-111" href="#__codelineno-20-111"></a>    <span class="p">]</span>
</span><span id="__span-20-112"><a id="__codelineno-20-112" name="__codelineno-20-112" href="#__codelineno-20-112"></a>
</span><span id="__span-20-113"><a id="__codelineno-20-113" name="__codelineno-20-113" href="#__codelineno-20-113"></a>    <span class="n">sendToRickAI</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">logData</span><span class="p">)</span>
</span><span id="__span-20-114"><a id="__codelineno-20-114" name="__codelineno-20-114" href="#__codelineno-20-114"></a><span class="p">}</span>
</span></code></pre></div>

#### **Android: App Links setup**
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1">// В AndroidManifest.xml добавьте:</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="o">&lt;</span><span class="n">activity</span><span class="w"> </span><span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;.MainActivity&quot;</span><span class="o">&gt;</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">intent</span><span class="o">-</span><span class="n">filter</span><span class="w"> </span><span class="n">android</span><span class="p">:</span><span class="n">autoVerify</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="o">&gt;</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">        </span><span class="o">&lt;</span><span class="n">action</span><span class="w"> </span><span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;android.intent.action.VIEW&quot;</span><span class="w"> </span><span class="o">/&gt;</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">        </span><span class="o">&lt;</span><span class="n">category</span><span class="w"> </span><span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;android.intent.category.DEFAULT&quot;</span><span class="w"> </span><span class="o">/&gt;</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">        </span><span class="o">&lt;</span><span class="n">category</span><span class="w"> </span><span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;android.intent.category.BROWSABLE&quot;</span><span class="w"> </span><span class="o">/&gt;</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">        </span><span class="o">&lt;</span><span class="n">data</span><span class="w"> </span><span class="n">android</span><span class="p">:</span><span class="n">scheme</span><span class="o">=</span><span class="s">&quot;https&quot;</span><span class="w"> </span><span class="n">android</span><span class="p">:</span><span class="n">host</span><span class="o">=</span><span class="s">&quot;vipavenue.ru&quot;</span><span class="w"> </span><span class="o">/&gt;</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="w">    </span><span class="o">&lt;/</span><span class="n">intent</span><span class="o">-</span><span class="n">filter</span><span class="o">&gt;</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="o">&lt;/</span><span class="n">activity</span><span class="o">&gt;</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="c1">// В MainActivity:</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span><span class="w"> </span><span class="n">Bundle?)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="w">    </span><span class="k">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="w">    </span><span class="c1">// Обрабатываем deep link если приложение запущено через него</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="w">    </span><span class="n">intent</span><span class="o">?.</span><span class="na">data</span><span class="o">?.</span><span class="na">let</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">uri</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="w">        </span><span class="n">handleDeepLink</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="p">}</span>
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a>
</span><span id="__span-21-21"><a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a><span class="c1">// Обработка deep link</span>
</span><span id="__span-21-22"><a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">handleDeepLink</span><span class="p">(</span><span class="n">uri</span><span class="p">:</span><span class="w"> </span><span class="n">Uri</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-23"><a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-24"><a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a><span class="w">        </span><span class="c1">// Парсим UTM параметры</span>
</span><span id="__span-21-25"><a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">utmParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mutableMapOf</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">String</span><span class="o">&gt;</span><span class="p">()</span>
</span><span id="__span-21-26"><a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">adjustParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mutableMapOf</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">String</span><span class="o">&gt;</span><span class="p">()</span>
</span><span id="__span-21-27"><a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">customParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mutableMapOf</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">String</span><span class="o">&gt;</span><span class="p">()</span>
</span><span id="__span-21-28"><a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a>
</span><span id="__span-21-29"><a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a><span class="w">        </span><span class="n">uri</span><span class="p">.</span><span class="na">queryParameterNames</span><span class="p">.</span><span class="na">forEach</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">paramName</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-21-30"><a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a><span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">paramValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uri</span><span class="p">.</span><span class="na">getQueryParameter</span><span class="p">(</span><span class="n">paramName</span><span class="p">)</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
</span><span id="__span-21-31"><a id="__codelineno-21-31" name="__codelineno-21-31" href="#__codelineno-21-31"></a>
</span><span id="__span-21-32"><a id="__codelineno-21-32" name="__codelineno-21-32" href="#__codelineno-21-32"></a><span class="w">            </span><span class="k">when</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-33"><a id="__codelineno-21-33" name="__codelineno-21-33" href="#__codelineno-21-33"></a><span class="w">                </span><span class="n">paramName</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;utm_&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">utmParams</span><span class="o">[</span><span class="n">paramName</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paramValue</span>
</span><span id="__span-21-34"><a id="__codelineno-21-34" name="__codelineno-21-34" href="#__codelineno-21-34"></a><span class="w">                </span><span class="n">paramName</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;adjust_&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">adjustParams</span><span class="o">[</span><span class="n">paramName</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paramValue</span>
</span><span id="__span-21-35"><a id="__codelineno-21-35" name="__codelineno-21-35" href="#__codelineno-21-35"></a><span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">customParams</span><span class="o">[</span><span class="n">paramName</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paramValue</span>
</span><span id="__span-21-36"><a id="__codelineno-21-36" name="__codelineno-21-36" href="#__codelineno-21-36"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-21-37"><a id="__codelineno-21-37" name="__codelineno-21-37" href="#__codelineno-21-37"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-21-38"><a id="__codelineno-21-38" name="__codelineno-21-38" href="#__codelineno-21-38"></a>
</span><span id="__span-21-39"><a id="__codelineno-21-39" name="__codelineno-21-39" href="#__codelineno-21-39"></a><span class="w">        </span><span class="c1">// Сохраняем UTM параметры</span>
</span><span id="__span-21-40"><a id="__codelineno-21-40" name="__codelineno-21-40" href="#__codelineno-21-40"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">sharedPrefs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getSharedPreferences</span><span class="p">(</span><span class="s">&quot;deep_link_prefs&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Context</span><span class="p">.</span><span class="na">MODE_PRIVATE</span><span class="p">)</span>
</span><span id="__span-21-41"><a id="__codelineno-21-41" name="__codelineno-21-41" href="#__codelineno-21-41"></a><span class="w">        </span><span class="n">sharedPrefs</span><span class="p">.</span><span class="na">edit</span><span class="p">().</span><span class="na">apply</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-42"><a id="__codelineno-21-42" name="__codelineno-21-42" href="#__codelineno-21-42"></a><span class="w">            </span><span class="n">utmParams</span><span class="p">.</span><span class="na">forEach</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-21-43"><a id="__codelineno-21-43" name="__codelineno-21-43" href="#__codelineno-21-43"></a><span class="w">                </span><span class="n">putString</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span>
</span><span id="__span-21-44"><a id="__codelineno-21-44" name="__codelineno-21-44" href="#__codelineno-21-44"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-21-45"><a id="__codelineno-21-45" name="__codelineno-21-45" href="#__codelineno-21-45"></a><span class="w">        </span><span class="p">}.</span><span class="na">apply</span><span class="p">()</span>
</span><span id="__span-21-46"><a id="__codelineno-21-46" name="__codelineno-21-46" href="#__codelineno-21-46"></a>
</span><span id="__span-21-47"><a id="__codelineno-21-47" name="__codelineno-21-47" href="#__codelineno-21-47"></a><span class="w">        </span><span class="c1">// Трекаем deep link событие</span>
</span><span id="__span-21-48"><a id="__codelineno-21-48" name="__codelineno-21-48" href="#__codelineno-21-48"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">deepLinkParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapOf</span><span class="p">(</span>
</span><span id="__span-21-49"><a id="__codelineno-21-49" name="__codelineno-21-49" href="#__codelineno-21-49"></a><span class="w">            </span><span class="s">&quot;deep_link_url&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">uri</span><span class="p">.</span><span class="na">toString</span><span class="p">(),</span>
</span><span id="__span-21-50"><a id="__codelineno-21-50" name="__codelineno-21-50" href="#__codelineno-21-50"></a><span class="w">            </span><span class="s">&quot;deep_link_source&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="n">utmParams</span><span class="o">[</span><span class="s">&quot;utm_source&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;deep_link&quot;</span><span class="p">),</span>
</span><span id="__span-21-51"><a id="__codelineno-21-51" name="__codelineno-21-51" href="#__codelineno-21-51"></a><span class="w">            </span><span class="s">&quot;deep_link_campaign&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="n">utmParams</span><span class="o">[</span><span class="s">&quot;utm_campaign&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="__span-21-52"><a id="__codelineno-21-52" name="__codelineno-21-52" href="#__codelineno-21-52"></a><span class="w">            </span><span class="s">&quot;deep_link_medium&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="n">utmParams</span><span class="o">[</span><span class="s">&quot;utm_medium&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;deep_link&quot;</span><span class="p">),</span>
</span><span id="__span-21-53"><a id="__codelineno-21-53" name="__codelineno-21-53" href="#__codelineno-21-53"></a><span class="w">            </span><span class="s">&quot;deep_link_path&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">uri</span><span class="p">.</span><span class="na">path</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-21-54"><a id="__codelineno-21-54" name="__codelineno-21-54" href="#__codelineno-21-54"></a><span class="w">            </span><span class="s">&quot;product_id&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="n">customParams</span><span class="o">[</span><span class="s">&quot;product_id&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="__span-21-55"><a id="__codelineno-21-55" name="__codelineno-21-55" href="#__codelineno-21-55"></a><span class="w">            </span><span class="s">&quot;user_id&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="n">customParams</span><span class="o">[</span><span class="s">&quot;user_id&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="__span-21-56"><a id="__codelineno-21-56" name="__codelineno-21-56" href="#__codelineno-21-56"></a><span class="w">        </span><span class="p">)</span>
</span><span id="__span-21-57"><a id="__codelineno-21-57" name="__codelineno-21-57" href="#__codelineno-21-57"></a>
</span><span id="__span-21-58"><a id="__codelineno-21-58" name="__codelineno-21-58" href="#__codelineno-21-58"></a><span class="w">        </span><span class="c1">// Отправляем в AppMetrica</span>
</span><span id="__span-21-59"><a id="__codelineno-21-59" name="__codelineno-21-59" href="#__codelineno-21-59"></a><span class="w">        </span><span class="n">AppMetrica</span><span class="p">.</span><span class="na">reportEvent</span><span class="p">(</span><span class="s">&quot;deep_link_opened&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">deepLinkParams</span><span class="p">)</span>
</span><span id="__span-21-60"><a id="__codelineno-21-60" name="__codelineno-21-60" href="#__codelineno-21-60"></a>
</span><span id="__span-21-61"><a id="__codelineno-21-61" name="__codelineno-21-61" href="#__codelineno-21-61"></a><span class="w">        </span><span class="c1">// Отправляем в Adjust</span>
</span><span id="__span-21-62"><a id="__codelineno-21-62" name="__codelineno-21-62" href="#__codelineno-21-62"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">adjustEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AdjustEvent</span><span class="p">(</span><span class="s">&quot;YOUR_DEEP_LINK_EVENT_TOKEN&quot;</span><span class="p">)</span>
</span><span id="__span-21-63"><a id="__codelineno-21-63" name="__codelineno-21-63" href="#__codelineno-21-63"></a><span class="w">        </span><span class="n">adjustEvent</span><span class="p">.</span><span class="na">addCallbackParameter</span><span class="p">(</span><span class="s">&quot;deep_link_source&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">utmParams</span><span class="o">[</span><span class="s">&quot;utm_source&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;deep_link&quot;</span><span class="p">)</span>
</span><span id="__span-21-64"><a id="__codelineno-21-64" name="__codelineno-21-64" href="#__codelineno-21-64"></a><span class="w">        </span><span class="n">adjustEvent</span><span class="p">.</span><span class="na">addCallbackParameter</span><span class="p">(</span><span class="s">&quot;deep_link_campaign&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">utmParams</span><span class="o">[</span><span class="s">&quot;utm_campaign&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="__span-21-65"><a id="__codelineno-21-65" name="__codelineno-21-65" href="#__codelineno-21-65"></a><span class="w">        </span><span class="n">adjustEvent</span><span class="p">.</span><span class="na">addCallbackParameter</span><span class="p">(</span><span class="s">&quot;product_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">customParams</span><span class="o">[</span><span class="s">&quot;product_id&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="__span-21-66"><a id="__codelineno-21-66" name="__codelineno-21-66" href="#__codelineno-21-66"></a><span class="w">        </span><span class="n">Adjust</span><span class="p">.</span><span class="na">trackEvent</span><span class="p">(</span><span class="n">adjustEvent</span><span class="p">)</span>
</span><span id="__span-21-67"><a id="__codelineno-21-67" name="__codelineno-21-67" href="#__codelineno-21-67"></a>
</span><span id="__span-21-68"><a id="__codelineno-21-68" name="__codelineno-21-68" href="#__codelineno-21-68"></a><span class="w">        </span><span class="c1">// Логируем в flow.rick.ai</span>
</span><span id="__span-21-69"><a id="__codelineno-21-69" name="__codelineno-21-69" href="#__codelineno-21-69"></a><span class="w">        </span><span class="n">logDeepLinkToRickAI</span><span class="p">(</span><span class="n">deepLinkParams</span><span class="p">,</span><span class="w"> </span><span class="n">utmParams</span><span class="p">,</span><span class="w"> </span><span class="n">customParams</span><span class="p">)</span>
</span><span id="__span-21-70"><a id="__codelineno-21-70" name="__codelineno-21-70" href="#__codelineno-21-70"></a>
</span><span id="__span-21-71"><a id="__codelineno-21-71" name="__codelineno-21-71" href="#__codelineno-21-71"></a><span class="w">        </span><span class="c1">// Обрабатываем deep link path</span>
</span><span id="__span-21-72"><a id="__codelineno-21-72" name="__codelineno-21-72" href="#__codelineno-21-72"></a><span class="w">        </span><span class="n">handleDeepLinkPath</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="na">path</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">customParams</span><span class="p">)</span>
</span><span id="__span-21-73"><a id="__codelineno-21-73" name="__codelineno-21-73" href="#__codelineno-21-73"></a>
</span><span id="__span-21-74"><a id="__codelineno-21-74" name="__codelineno-21-74" href="#__codelineno-21-74"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-75"><a id="__codelineno-21-75" name="__codelineno-21-75" href="#__codelineno-21-75"></a><span class="w">        </span><span class="n">Log</span><span class="p">.</span><span class="na">e</span><span class="p">(</span><span class="s">&quot;DeepLink&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Error handling deep link: </span><span class="si">${</span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
</span><span id="__span-21-76"><a id="__codelineno-21-76" name="__codelineno-21-76" href="#__codelineno-21-76"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-77"><a id="__codelineno-21-77" name="__codelineno-21-77" href="#__codelineno-21-77"></a><span class="p">}</span>
</span><span id="__span-21-78"><a id="__codelineno-21-78" name="__codelineno-21-78" href="#__codelineno-21-78"></a>
</span><span id="__span-21-79"><a id="__codelineno-21-79" name="__codelineno-21-79" href="#__codelineno-21-79"></a><span class="c1">// Обработка конкретного пути deep link</span>
</span><span id="__span-21-80"><a id="__codelineno-21-80" name="__codelineno-21-80" href="#__codelineno-21-80"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">handleDeepLinkPath</span><span class="p">(</span><span class="n">path</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">parameters</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">String</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-81"><a id="__codelineno-21-81" name="__codelineno-21-81" href="#__codelineno-21-81"></a><span class="w">            </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-82"><a id="__codelineno-21-82" name="__codelineno-21-82" href="#__codelineno-21-82"></a><span class="w">            </span><span class="s">&quot;/catalog/womens/clothes/dresses&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-83"><a id="__codelineno-21-83" name="__codelineno-21-83" href="#__codelineno-21-83"></a><span class="w">                </span><span class="c1">// Открываем каталог платьев</span>
</span><span id="__span-21-84"><a id="__codelineno-21-84" name="__codelineno-21-84" href="#__codelineno-21-84"></a><span class="w">                </span><span class="n">parameters</span><span class="o">[</span><span class="s">&quot;product_id&quot;</span><span class="o">]?.</span><span class="na">let</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">productId</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-21-85"><a id="__codelineno-21-85" name="__codelineno-21-85" href="#__codelineno-21-85"></a><span class="w">                    </span><span class="n">navigateToProduct</span><span class="p">(</span><span class="n">productId</span><span class="p">)</span>
</span><span id="__span-21-86"><a id="__codelineno-21-86" name="__codelineno-21-86" href="#__codelineno-21-86"></a><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-87"><a id="__codelineno-21-87" name="__codelineno-21-87" href="#__codelineno-21-87"></a><span class="w">                    </span><span class="n">navigateToCatalog</span><span class="p">(</span><span class="s">&quot;dresses&quot;</span><span class="p">)</span>
</span><span id="__span-21-88"><a id="__codelineno-21-88" name="__codelineno-21-88" href="#__codelineno-21-88"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-21-89"><a id="__codelineno-21-89" name="__codelineno-21-89" href="#__codelineno-21-89"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-21-90"><a id="__codelineno-21-90" name="__codelineno-21-90" href="#__codelineno-21-90"></a><span class="w">            </span><span class="s">&quot;/catalog&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-91"><a id="__codelineno-21-91" name="__codelineno-21-91" href="#__codelineno-21-91"></a><span class="w">                </span><span class="c1">// Открываем общий каталог</span>
</span><span id="__span-21-92"><a id="__codelineno-21-92" name="__codelineno-21-92" href="#__codelineno-21-92"></a><span class="w">                </span><span class="n">navigateToCatalog</span><span class="p">(</span><span class="n">parameters</span><span class="o">[</span><span class="s">&quot;category&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;all&quot;</span><span class="p">)</span>
</span><span id="__span-21-93"><a id="__codelineno-21-93" name="__codelineno-21-93" href="#__codelineno-21-93"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-21-94"><a id="__codelineno-21-94" name="__codelineno-21-94" href="#__codelineno-21-94"></a><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-95"><a id="__codelineno-21-95" name="__codelineno-21-95" href="#__codelineno-21-95"></a><span class="w">            </span><span class="c1">// Открываем главный экран</span>
</span><span id="__span-21-96"><a id="__codelineno-21-96" name="__codelineno-21-96" href="#__codelineno-21-96"></a><span class="w">            </span><span class="n">navigateToMainScreen</span><span class="p">()</span>
</span><span id="__span-21-97"><a id="__codelineno-21-97" name="__codelineno-21-97" href="#__codelineno-21-97"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-21-98"><a id="__codelineno-21-98" name="__codelineno-21-98" href="#__codelineno-21-98"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-99"><a id="__codelineno-21-99" name="__codelineno-21-99" href="#__codelineno-21-99"></a><span class="p">}</span>
</span><span id="__span-21-100"><a id="__codelineno-21-100" name="__codelineno-21-100" href="#__codelineno-21-100"></a>
</span><span id="__span-21-101"><a id="__codelineno-21-101" name="__codelineno-21-101" href="#__codelineno-21-101"></a><span class="c1">// Логирование в flow.rick.ai</span>
</span><span id="__span-21-102"><a id="__codelineno-21-102" name="__codelineno-21-102" href="#__codelineno-21-102"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">logDeepLinkToRickAI</span><span class="p">(</span><span class="n">deepLinkParams</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">Any</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">utmParams</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">customParams</span><span class="p">:</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kt">String</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-103"><a id="__codelineno-21-103" name="__codelineno-21-103" href="#__codelineno-21-103"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">logData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapOf</span><span class="p">(</span>
</span><span id="__span-21-104"><a id="__codelineno-21-104" name="__codelineno-21-104" href="#__codelineno-21-104"></a><span class="w">        </span><span class="s">&quot;event_type&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="s">&quot;deep_link_opened&quot;</span><span class="p">,</span>
</span><span id="__span-21-105"><a id="__codelineno-21-105" name="__codelineno-21-105" href="#__codelineno-21-105"></a><span class="w">        </span><span class="s">&quot;timestamp&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">time</span><span class="p">.</span><span class="na">Instant</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">toString</span><span class="p">(),</span>
</span><span id="__span-21-106"><a id="__codelineno-21-106" name="__codelineno-21-106" href="#__codelineno-21-106"></a><span class="w">        </span><span class="s">&quot;deep_link_data&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">deepLinkParams</span><span class="p">,</span>
</span><span id="__span-21-107"><a id="__codelineno-21-107" name="__codelineno-21-107" href="#__codelineno-21-107"></a><span class="w">        </span><span class="s">&quot;utm_data&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">utmParams</span><span class="p">,</span>
</span><span id="__span-21-108"><a id="__codelineno-21-108" name="__codelineno-21-108" href="#__codelineno-21-108"></a><span class="w">        </span><span class="s">&quot;custom_data&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">customParams</span><span class="p">,</span>
</span><span id="__span-21-109"><a id="__codelineno-21-109" name="__codelineno-21-109" href="#__codelineno-21-109"></a><span class="w">        </span><span class="s">&quot;app_info&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">mapOf</span><span class="p">(</span>
</span><span id="__span-21-110"><a id="__codelineno-21-110" name="__codelineno-21-110" href="#__codelineno-21-110"></a><span class="w">            </span><span class="s">&quot;app_id&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="n">packageName</span><span class="p">),</span>
</span><span id="__span-21-111"><a id="__codelineno-21-111" name="__codelineno-21-111" href="#__codelineno-21-111"></a><span class="w">            </span><span class="s">&quot;platform&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="s">&quot;android&quot;</span><span class="p">,</span>
</span><span id="__span-21-112"><a id="__codelineno-21-112" name="__codelineno-21-112" href="#__codelineno-21-112"></a><span class="w">            </span><span class="s">&quot;version&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">packageManager</span><span class="p">.</span><span class="na">getPackageInfo</span><span class="p">(</span><span class="n">packageName</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">).</span><span class="na">versionName</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="w"> </span><span class="p">})</span>
</span><span id="__span-21-113"><a id="__codelineno-21-113" name="__codelineno-21-113" href="#__codelineno-21-113"></a><span class="w">        </span><span class="p">),</span>
</span><span id="__span-21-114"><a id="__codelineno-21-114" name="__codelineno-21-114" href="#__codelineno-21-114"></a><span class="w">        </span><span class="s">&quot;device_info&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">mapOf</span><span class="p">(</span>
</span><span id="__span-21-115"><a id="__codelineno-21-115" name="__codelineno-21-115" href="#__codelineno-21-115"></a><span class="w">            </span><span class="s">&quot;device_id&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="n">Adjust</span><span class="p">.</span><span class="na">getAdid</span><span class="p">()</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="__span-21-116"><a id="__codelineno-21-116" name="__codelineno-21-116" href="#__codelineno-21-116"></a><span class="w">            </span><span class="s">&quot;appmetrica_device_id&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="n">AppMetrica</span><span class="p">.</span><span class="na">getDeviceID</span><span class="p">()</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="__span-21-117"><a id="__codelineno-21-117" name="__codelineno-21-117" href="#__codelineno-21-117"></a><span class="w">        </span><span class="p">)</span>
</span><span id="__span-21-118"><a id="__codelineno-21-118" name="__codelineno-21-118" href="#__codelineno-21-118"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-21-119"><a id="__codelineno-21-119" name="__codelineno-21-119" href="#__codelineno-21-119"></a>
</span><span id="__span-21-120"><a id="__codelineno-21-120" name="__codelineno-21-120" href="#__codelineno-21-120"></a><span class="w">    </span><span class="n">sendToRickAI</span><span class="p">(</span><span class="n">logData</span><span class="p">)</span>
</span><span id="__span-21-121"><a id="__codelineno-21-121" name="__codelineno-21-121" href="#__codelineno-21-121"></a><span class="p">}</span>
</span></code></pre></div>

### **Как не потерять UTM-метки и параметры кампании:**

#### **1. Правильная структура URL для рекламных кампаний:**
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>https://vipavenue.ru/deep-link?
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>utm_source=facebook&amp;
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>utm_medium=cpc&amp;
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>utm_campaign=summer2025_premium_dresses&amp;
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>utm_content=video_ad&amp;
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>utm_term=brunello_cucinelli&amp;
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>adjust_tracker=abc123&amp;
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>adjust_campaign=summer2025&amp;
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>adjust_adgroup=premium_dresses&amp;
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>adjust_creative=video_banner&amp;
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>product_id=brunello-cucinelli-cotton-dress&amp;
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>product_name=Платье хлопковое BRUNELLO CUCINELLI&amp;
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>product_price=527800&amp;
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>deep_link_path=/catalog/womens/clothes/dresses/brunello-cucinelli-cotton-dress
</span></code></pre></div>

#### **2. Сохранение UTM параметров:**
- **iOS**: `UserDefaults.standard.set(utmParams, forKey: "deep_link_utm_params")`
- **Android**: `SharedPreferences` для сохранения параметров
- **Передача в события**: Все UTM параметры передаются в каждое событие

#### **3. Трекинг событий с UTM:**
<div class="language-swift highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1">// iOS: Трекинг покупки платья с UTM параметрами</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="kd">func</span> <span class="nf">trackPurchaseWithUTM</span><span class="p">(</span><span class="n">amount</span><span class="p">:</span> <span class="nb">Double</span><span class="p">,</span> <span class="n">productId</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">productName</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>    <span class="c1">// Получаем сохраненные UTM параметры</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>    <span class="kd">let</span> <span class="nv">utmParams</span> <span class="p">=</span> <span class="n">UserDefaults</span><span class="p">.</span><span class="n">standard</span><span class="p">.</span><span class="n">object</span><span class="p">(</span><span class="n">forKey</span><span class="p">:</span> <span class="s">&quot;deep_link_utm_params&quot;</span><span class="p">)</span> <span class="k">as</span><span class="p">?</span> <span class="p">[</span><span class="nb">String</span><span class="p">:</span> <span class="nb">String</span><span class="p">]</span> <span class="p">??</span> <span class="p">[:]</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>    <span class="kd">var</span> <span class="nv">eventParams</span> <span class="p">=</span> <span class="p">[</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>        <span class="s">&quot;amount&quot;</span><span class="p">:</span> <span class="n">amount</span><span class="p">,</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>        <span class="s">&quot;product_id&quot;</span><span class="p">:</span> <span class="n">productId</span><span class="p">,</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>        <span class="s">&quot;product_name&quot;</span><span class="p">:</span> <span class="n">productName</span><span class="p">,</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>        <span class="s">&quot;currency&quot;</span><span class="p">:</span> <span class="s">&quot;RUB&quot;</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>    <span class="p">]</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>    <span class="c1">// Добавляем UTM параметры</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>    <span class="n">utmParams</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="k">in</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>        <span class="n">eventParams</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="p">=</span> <span class="n">value</span>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>    <span class="p">}</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>    <span class="c1">// ✅ Отправляем в AppMetrica с adjust_adid</span>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>    <span class="kd">let</span> <span class="nv">adjustAdid</span> <span class="p">=</span> <span class="n">Adjust</span><span class="p">.</span><span class="n">adid</span><span class="p">()</span>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>    <span class="kd">var</span> <span class="nv">eventParamsWithAdjustID</span> <span class="p">=</span> <span class="n">eventParams</span>
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a>    <span class="n">eventParamsWithAdjustID</span><span class="p">[</span><span class="s">&quot;adjust_adid&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">adjustAdid</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span>
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a>    <span class="n">AppMetrica</span><span class="p">.</span><span class="n">reportEvent</span><span class="p">(</span><span class="s">&quot;purchase&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">eventParamsWithAdjustID</span><span class="p">)</span>
</span><span id="__span-23-23"><a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a>
</span><span id="__span-23-24"><a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a>    <span class="c1">// Отправляем в Adjust</span>
</span><span id="__span-23-25"><a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a>    <span class="kd">let</span> <span class="nv">adjustEvent</span> <span class="p">=</span> <span class="n">ADJEvent</span><span class="p">(</span><span class="n">eventToken</span><span class="p">:</span> <span class="s">&quot;YOUR_PURCHASE_EVENT_TOKEN&quot;</span><span class="p">)</span>
</span><span id="__span-23-26"><a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a>    <span class="n">adjustEvent</span><span class="p">?.</span><span class="n">setRevenue</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">:</span> <span class="s">&quot;RUB&quot;</span><span class="p">)</span>
</span><span id="__span-23-27"><a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a>    <span class="n">adjustEvent</span><span class="p">?.</span><span class="n">addCallbackParameter</span><span class="p">(</span><span class="s">&quot;product_id&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">productId</span><span class="p">)</span>
</span><span id="__span-23-28"><a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a>    <span class="n">adjustEvent</span><span class="p">?.</span><span class="n">addCallbackParameter</span><span class="p">(</span><span class="s">&quot;product_name&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">productName</span><span class="p">)</span>
</span><span id="__span-23-29"><a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a>
</span><span id="__span-23-30"><a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a>    <span class="c1">// Добавляем UTM параметры в Adjust</span>
</span><span id="__span-23-31"><a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a>    <span class="n">utmParams</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="k">in</span>
</span><span id="__span-23-32"><a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a>        <span class="n">adjustEvent</span><span class="p">?.</span><span class="n">addCallbackParameter</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">value</span><span class="p">)</span>
</span><span id="__span-23-33"><a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a>    <span class="p">}</span>
</span><span id="__span-23-34"><a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a>
</span><span id="__span-23-35"><a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a>    <span class="n">Adjust</span><span class="p">.</span><span class="n">trackEvent</span><span class="p">(</span><span class="n">adjustEvent</span><span class="p">)</span>
</span><span id="__span-23-36"><a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a><span class="p">}</span>
</span><span id="__span-23-37"><a id="__codelineno-23-37" name="__codelineno-23-37" href="#__codelineno-23-37"></a>
</span><span id="__span-23-38"><a id="__codelineno-23-38" name="__codelineno-23-38" href="#__codelineno-23-38"></a><span class="c1">// Пример использования для платья BRUNELLO CUCINELLI</span>
</span><span id="__span-23-39"><a id="__codelineno-23-39" name="__codelineno-23-39" href="#__codelineno-23-39"></a><span class="n">trackPurchaseWithUTM</span><span class="p">(</span>
</span><span id="__span-23-40"><a id="__codelineno-23-40" name="__codelineno-23-40" href="#__codelineno-23-40"></a>    <span class="n">amount</span><span class="p">:</span> <span class="mf">527800.0</span><span class="p">,</span> 
</span><span id="__span-23-41"><a id="__codelineno-23-41" name="__codelineno-23-41" href="#__codelineno-23-41"></a>    <span class="n">productId</span><span class="p">:</span> <span class="s">&quot;brunello-cucinelli-cotton-dress&quot;</span><span class="p">,</span> 
</span><span id="__span-23-42"><a id="__codelineno-23-42" name="__codelineno-23-42" href="#__codelineno-23-42"></a>    <span class="n">productName</span><span class="p">:</span> <span class="s">&quot;Платье хлопковое BRUNELLO CUCINELLI&quot;</span>
</span><span id="__span-23-43"><a id="__codelineno-23-43" name="__codelineno-23-43" href="#__codelineno-23-43"></a><span class="p">)</span>
</span></code></pre></div>

#### **4. Проверка атрибуции:**
- **В AppMetrica**: Событие `deep_link_opened` с полными UTM параметрами
- **В Adjust**: Событие с UTM параметрами в callback parameters
- **В flow.rick.ai**: Полная логика всех параметров для анализа

### **Чек-лист для Deep Links:**
1. ✅ URL содержит все необходимые UTM параметры
2. ✅ Adjust параметры корректно передаются
3. ✅ UTM параметры сохраняются в приложении
4. ✅ Все события содержат UTM параметры
5. ✅ Deep link события трекаются в обе платформы
6. ✅ Логирование в flow.rick.ai работает
7. ✅ Навигация по deep link path корректна
8. ✅ Домены настроены на vipavenue.ru
9. ✅ Пути навигации соответствуют структуре VipAvenue

</details>

<hr />
<h2 id="2000-adjust-">🎯 Работа с 2000+ кампаниями в Adjust - Масштабируемое решение<a class="headerlink" href="#2000-adjust-" title="Permanent link">&para;</a></h2>
<h3 id="adjust-2000"><strong>🔹 Как это работает в Adjust для 2000 кампаний</strong><a class="headerlink" href="#adjust-2000" title="Permanent link">&para;</a></h3>
<h4 id="_4"><strong>Принцип работы:</strong><a class="headerlink" href="#_4" title="Permanent link">&para;</a></h4>
<p>В Adjust создаётся <strong>1 базовый трекер (tracking link) на канал</strong> — например, «Yandex Direct iOS» и «Yandex Direct Android».</p>
<p>В ссылку добавляются <strong>макросы Яндекс.Директа</strong> (<code>{campaign_id}</code>, <code>{adgroup_id}</code>, <code>{banner_id}</code>, <code>{keyword}</code>, <code>{logid}</code>, <code>{gbid}</code> и т.п.).</p>
<p>Когда пользователь кликает по объявлению, Яндекс автоматически подставляет реальные значения.</p>
<p>В Adjust они фиксируются → у тебя в отчётах сразу будет разрез по 2000 кампаниям, группам и баннерам.</p>
<h4 id="_5"><strong>Пример структуры ссылки:</strong><a class="headerlink" href="#_5" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>https://app.adjust.com/abc123?
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>campaign={campaign_id}&amp;
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>adgroup={adgroup_id}&amp;
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>creative={banner_id}&amp;
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>utm_term={keyword}&amp;
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>ya_click_id={logid}&amp;
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>publisher_id={gbid}&amp;
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>utm_source=yandex&amp;
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>utm_medium=cpc&amp;
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>utm_campaign={campaign_name}&amp;
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>utm_content={banner_name}
</span></code></pre></div>
<h3 id="_6"><strong>🔹 Что нужно реально сделать руками</strong><a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<h4 id="adjust-dashboard"><strong>В Adjust Dashboard:</strong><a class="headerlink" href="#adjust-dashboard" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Создать по одной ссылке на каждую платформу:</strong></li>
<li><code>Yandex Direct iOS</code> - для iOS кампаний</li>
<li>
<p><code>Yandex Direct Android</code> - для Android кампаний</p>
</li>
<li>
<p><strong>Вставить в параметры ссылки макросы:</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>campaign={campaign_id}
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>adgroup={adgroup_id}
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>creative={banner_id}
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>utm_term={keyword}
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>ya_click_id={logid}
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>publisher_id={gbid}
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>utm_source=yandex
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>utm_medium=cpc
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>utm_campaign={campaign_name}
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>utm_content={banner_name}
</span></code></pre></div></p>
</li>
<li>
<p><strong>Настроить Data Sharing:</strong></p>
</li>
<li>Включить <code>Data Sharing → Yandex Direct</code></li>
<li>Замаппить события: <code>install</code>, <code>purchase</code>, <code>registration</code></li>
<li>
<p>Настроить postbacks в Rick.AI</p>
</li>
<li>
<p><strong>Настроить fallback и redirect:</strong></p>
</li>
<li><strong>iOS</strong>: App Store URL + веб fallback</li>
<li><strong>Android</strong>: Play Store URL + веб fallback</li>
</ol>
<h4 id="_7"><strong>В Яндекс.Директ (рекламный аккаунт):</strong><a class="headerlink" href="#_7" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>В каждую кампанию (2000 штук) вставить именно этот Adjust-URL:</strong></li>
<li>iOS кампании → iOS Adjust URL</li>
<li>
<p>Android кампании → Android Adjust URL</p>
</li>
<li>
<p><strong>Массовая замена ссылок:</strong>
   <div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>// Excel формула для массовой замены
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>=SUBSTITUTE(A1, &quot;OLD_URL&quot;, &quot;NEW_ADJUST_URL&quot;)
</span></code></pre></div></p>
</li>
<li>
<p><strong>Проверка UTM-меток:</strong></p>
</li>
<li>В Яндексе включить автоматическую подстановку UTM</li>
<li>
<p>Проверить что макросы корректно подставляются</p>
</li>
<li>
<p><strong>Тестирование:</strong></p>
</li>
<li>Сделать 1 тестовую кампанию</li>
<li>Клик → убедиться что Adjust и AppMetrica поймали <code>install_referrer</code> и UTM</li>
</ol>
<h3 id="api"><strong>🔹 Автоматизация через API</strong><a class="headerlink" href="#api" title="Permanent link">&para;</a></h3>
<h4 id="adjust-api"><strong>Adjust API для массового создания:</strong><a class="headerlink" href="#adjust-api" title="Permanent link">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="kn">import</span> <span class="nn">requests</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="c1"># Создание множественных трекеров</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="k">def</span> <span class="nf">create_adjust_trackers</span><span class="p">():</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>    <span class="n">adjust_token</span> <span class="o">=</span> <span class="s2">&quot;YOUR_ADJUST_API_TOKEN&quot;</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>    <span class="c1"># Базовые параметры для всех трекеров</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>    <span class="n">base_params</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>        <span class="s2">&quot;campaign&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{campaign_id}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>        <span class="s2">&quot;adgroup&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{adgroup_id}</span><span class="s2">&quot;</span><span class="p">,</span> 
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>        <span class="s2">&quot;creative&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{banner_id}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>        <span class="s2">&quot;utm_term&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{keyword}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>        <span class="s2">&quot;ya_click_id&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{logid}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>        <span class="s2">&quot;publisher_id&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{gbid}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>        <span class="s2">&quot;utm_source&quot;</span><span class="p">:</span> <span class="s2">&quot;yandex&quot;</span><span class="p">,</span>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>        <span class="s2">&quot;utm_medium&quot;</span><span class="p">:</span> <span class="s2">&quot;cpc&quot;</span>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a>    <span class="p">}</span>
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a>
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a>    <span class="c1"># Создаем трекеры для каждой платформы</span>
</span><span id="__span-27-20"><a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a>    <span class="n">platforms</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ios&quot;</span><span class="p">,</span> <span class="s2">&quot;android&quot;</span><span class="p">]</span>
</span><span id="__span-27-21"><a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a>
</span><span id="__span-27-22"><a id="__codelineno-27-22" name="__codelineno-27-22" href="#__codelineno-27-22"></a>    <span class="k">for</span> <span class="n">platform</span> <span class="ow">in</span> <span class="n">platforms</span><span class="p">:</span>
</span><span id="__span-27-23"><a id="__codelineno-27-23" name="__codelineno-27-23" href="#__codelineno-27-23"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="__span-27-24"><a id="__codelineno-27-24" name="__codelineno-27-24" href="#__codelineno-27-24"></a>            <span class="sa">f</span><span class="s2">&quot;https://api.adjust.com/v1/trackers&quot;</span><span class="p">,</span>
</span><span id="__span-27-25"><a id="__codelineno-27-25" name="__codelineno-27-25" href="#__codelineno-27-25"></a>            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">adjust_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">},</span>
</span><span id="__span-27-26"><a id="__codelineno-27-26" name="__codelineno-27-26" href="#__codelineno-27-26"></a>            <span class="n">json</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-27-27"><a id="__codelineno-27-27" name="__codelineno-27-27" href="#__codelineno-27-27"></a>                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Yandex Direct </span><span class="si">{</span><span class="n">platform</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-27-28"><a id="__codelineno-27-28" name="__codelineno-27-28" href="#__codelineno-27-28"></a>                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;https://app.adjust.com/abc123&quot;</span><span class="p">,</span>
</span><span id="__span-27-29"><a id="__codelineno-27-29" name="__codelineno-27-29" href="#__codelineno-27-29"></a>                <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="n">base_params</span><span class="p">,</span>
</span><span id="__span-27-30"><a id="__codelineno-27-30" name="__codelineno-27-30" href="#__codelineno-27-30"></a>                <span class="s2">&quot;platform&quot;</span><span class="p">:</span> <span class="n">platform</span>
</span><span id="__span-27-31"><a id="__codelineno-27-31" name="__codelineno-27-31" href="#__codelineno-27-31"></a>            <span class="p">}</span>
</span><span id="__span-27-32"><a id="__codelineno-27-32" name="__codelineno-27-32" href="#__codelineno-27-32"></a>        <span class="p">)</span>
</span><span id="__span-27-33"><a id="__codelineno-27-33" name="__codelineno-27-33" href="#__codelineno-27-33"></a>
</span><span id="__span-27-34"><a id="__codelineno-27-34" name="__codelineno-27-34" href="#__codelineno-27-34"></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="__span-27-35"><a id="__codelineno-27-35" name="__codelineno-27-35" href="#__codelineno-27-35"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Трекер для </span><span class="si">{</span><span class="n">platform</span><span class="si">}</span><span class="s2"> создан: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;tracker_token&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-27-36"><a id="__codelineno-27-36" name="__codelineno-27-36" href="#__codelineno-27-36"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-27-37"><a id="__codelineno-27-37" name="__codelineno-27-37" href="#__codelineno-27-37"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ошибка создания трекера для </span><span class="si">{</span><span class="n">platform</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="api_1"><strong>Яндекс.Директ API для массовой замены:</strong><a class="headerlink" href="#api_1" title="Permanent link">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="kn">from</span> <span class="nn">yandex_direct</span> <span class="kn">import</span> <span class="n">YandexDirect</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="c1"># Массовая замена URL в кампаниях</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="k">def</span> <span class="nf">update_campaign_urls</span><span class="p">():</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>    <span class="n">client</span> <span class="o">=</span> <span class="n">YandexDirect</span><span class="p">(</span><span class="s2">&quot;YOUR_YANDEX_TOKEN&quot;</span><span class="p">)</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>    <span class="c1"># Получаем все кампании</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>    <span class="n">campaigns</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_campaigns</span><span class="p">()</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a>    <span class="n">adjust_urls</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>        <span class="s2">&quot;ios&quot;</span><span class="p">:</span> <span class="s2">&quot;https://app.adjust.com/abc123?campaign=</span><span class="si">{campaign_id}</span><span class="s2">&amp;adgroup=</span><span class="si">{adgroup_id}</span><span class="s2">&amp;creative=</span><span class="si">{banner_id}</span><span class="s2">&amp;utm_term=</span><span class="si">{keyword}</span><span class="s2">&amp;ya_click_id=</span><span class="si">{logid}</span><span class="s2">&amp;publisher_id=</span><span class="si">{gbid}</span><span class="s2">&amp;utm_source=yandex&amp;utm_medium=cpc&amp;utm_campaign=</span><span class="si">{campaign_name}</span><span class="s2">&amp;utm_content=</span><span class="si">{banner_name}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>        <span class="s2">&quot;android&quot;</span><span class="p">:</span> <span class="s2">&quot;https://app.adjust.com/def456?campaign=</span><span class="si">{campaign_id}</span><span class="s2">&amp;adgroup=</span><span class="si">{adgroup_id}</span><span class="s2">&amp;creative=</span><span class="si">{banner_id}</span><span class="s2">&amp;utm_term=</span><span class="si">{keyword}</span><span class="s2">&amp;ya_click_id=</span><span class="si">{logid}</span><span class="s2">&amp;publisher_id=</span><span class="si">{gbid}</span><span class="s2">&amp;utm_source=yandex&amp;utm_medium=cpc&amp;utm_campaign=</span><span class="si">{campaign_name}</span><span class="s2">&amp;utm_content=</span><span class="si">{banner_name}</span><span class="s2">&quot;</span>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>    <span class="p">}</span>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a>
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a>    <span class="k">for</span> <span class="n">campaign</span> <span class="ow">in</span> <span class="n">campaigns</span><span class="p">:</span>
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a>        <span class="c1"># Определяем платформу по названию кампании</span>
</span><span id="__span-28-17"><a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a>        <span class="n">platform</span> <span class="o">=</span> <span class="s2">&quot;ios&quot;</span> <span class="k">if</span> <span class="s2">&quot;iOS&quot;</span> <span class="ow">in</span> <span class="n">campaign</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;android&quot;</span>
</span><span id="__span-28-18"><a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a>
</span><span id="__span-28-19"><a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a>        <span class="c1"># Обновляем URL кампании</span>
</span><span id="__span-28-20"><a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a>        <span class="n">client</span><span class="o">.</span><span class="n">update_campaign</span><span class="p">(</span>
</span><span id="__span-28-21"><a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a>            <span class="n">campaign</span><span class="p">[</span><span class="s2">&quot;Id&quot;</span><span class="p">],</span>
</span><span id="__span-28-22"><a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a>            <span class="p">{</span><span class="s2">&quot;TrackingUrl&quot;</span><span class="p">:</span> <span class="n">adjust_urls</span><span class="p">[</span><span class="n">platform</span><span class="p">]}</span>
</span><span id="__span-28-23"><a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a>        <span class="p">)</span>
</span><span id="__span-28-24"><a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a>
</span><span id="__span-28-25"><a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Обновлена кампания </span><span class="si">{</span><span class="n">campaign</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> с URL для </span><span class="si">{</span><span class="n">platform</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="-2000"><strong>🔹 Чек-лист для 2000 кампаний:</strong><a class="headerlink" href="#-2000" title="Permanent link">&para;</a></h3>
<h4 id="_8"><strong>Подготовка:</strong><a class="headerlink" href="#_8" title="Permanent link">&para;</a></h4>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Созданы базовые трекеры в Adjust (iOS + Android)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Настроены макросы в URL параметрах</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Включен Data Sharing с Яндекс.Директ</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Настроены postbacks в Rick.AI</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Подготовлены fallback URL</li>
</ul>
<h4 id="_9"><strong>Внедрение:</strong><a class="headerlink" href="#_9" title="Permanent link">&para;</a></h4>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Заменены URL в 2000 кампаниях</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Проверена корректность макросов</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Протестирована 1 кампания</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Проверены события в Adjust и AppMetrica</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Настроена автоматическая выгрузка данных</li>
</ul>
<h4 id="_10"><strong>Мониторинг:</strong><a class="headerlink" href="#_10" title="Permanent link">&para;</a></h4>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Ежедневная проверка атрибуции</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Контроль качества данных</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Анализ конверсии по кампаниям</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Оптимизация на основе данных</li>
</ul>
<h3 id="_11"><strong>🔹 Результат:</strong><a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<h4 id="_12"><strong>Что получим:</strong><a class="headerlink" href="#_12" title="Permanent link">&para;</a></h4>
<ul>
<li>✅ <strong>Масштабируемость</strong>: 1 трекер = 2000 кампаний</li>
<li>✅ <strong>Автоматизация</strong>: Макросы подставляются автоматически</li>
<li>✅ <strong>Детализация</strong>: Разрез по кампаниям, группам, баннерам</li>
<li>✅ <strong>Консистентность</strong>: Единый формат данных для всех кампаний</li>
<li>✅ <strong>ROI оптимизация</strong>: Точная атрибуция для оптимизации</li>
</ul>
<h4 id="_13"><strong>Время внедрения:</strong><a class="headerlink" href="#_13" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Настройка трекеров</strong>: 2-4 часа</li>
<li><strong>Массовая замена URL</strong>: 1-2 дня (в зависимости от количества кампаний)</li>
<li><strong>Тестирование</strong>: 1 день</li>
<li><strong>Итого</strong>: 3-5 рабочих дней</li>
</ul>
<hr />
<details open>
<summary><strong>🚨 ИЗВЕСТНЫЕ ОШИБКИ И РЕШЕНИЯ</strong></summary>

### **1. Attribution Callback не вызывается**
**Симптомы:** События не передаются между платформами
**Решение:** Убедитесь что callback установлен ДО инициализации Adjust
<div class="language-swift highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1">// ✅ ПРАВИЛЬНО</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="n">adjustConfig</span><span class="p">?.</span><span class="n">setAttributionChangedBlock</span> <span class="p">{</span> <span class="n">attribution</span> <span class="k">in</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>    <span class="c1">// Attribution код</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="p">}</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="n">Adjust</span><span class="p">.</span><span class="n">appDidLaunch</span><span class="p">(</span><span class="n">adjustConfig</span><span class="p">)</span> <span class="c1">// ПОСЛЕ callback setup</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="c1">// ❌ НЕПРАВИЛЬНО  </span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="n">Adjust</span><span class="p">.</span><span class="n">appDidLaunch</span><span class="p">(</span><span class="n">adjustConfig</span><span class="p">)</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="n">adjustConfig</span><span class="p">?.</span><span class="n">setAttributionChangedBlock</span> <span class="p">{</span> <span class="n">attribution</span> <span class="k">in</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>    <span class="c1">// Callback никогда не вызовется</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="p">}</span>
</span></code></pre></div>

### **2. UTM параметры теряются**
**Симптомы:** UTM данные отсутствуют в AppMetrica отчетах
**Решение:** Проверьте что все параметры передаются корректно
<div class="language-swift highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1">// ✅ ПРАВИЛЬНО - все параметры</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="kd">let</span> <span class="nv">params</span> <span class="p">=</span> <span class="p">[</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>    <span class="s">&quot;utm_source&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">network</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>    <span class="s">&quot;utm_campaign&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">campaign</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span> 
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>    <span class="s">&quot;utm_content&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">creative</span> <span class="p">??</span> <span class="s">&quot;&quot;</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="p">]</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="c1">// ❌ НЕПРАВИЛЬНО - неполные параметры</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="kd">let</span> <span class="nv">params</span> <span class="p">=</span> <span class="p">[</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>    <span class="s">&quot;utm_source&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">network</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>    <span class="c1">// Отсутствуют utm_campaign, utm_content</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a><span class="p">]</span>
</span></code></pre></div>

### **3. AppMetrica не активирована при получении attribution**
**Симптомы:** Ошибка "AppMetrica не активирована при получении attribution"
**Решение:** Убедитесь что AppMetrica инициализируется ПЕРВОЙ
<div class="language-swift highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1">// ✅ ПРАВИЛЬНО</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="c1">// 1. AppMetrica (первым!)</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="n">AppMetrica</span><span class="p">.</span><span class="n">activate</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="n">appMetricaConfig</span><span class="p">)</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="c1">// 2. Adjust (вторым!)</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="n">Adjust</span><span class="p">.</span><span class="n">appDidLaunch</span><span class="p">(</span><span class="n">adjustConfig</span><span class="p">)</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="c1">// ❌ НЕПРАВИЛЬНО</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="c1">// 1. Adjust (первым!)</span>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="n">Adjust</span><span class="p">.</span><span class="n">appDidLaunch</span><span class="p">(</span><span class="n">adjustConfig</span><span class="p">)</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="c1">// 2. AppMetrica (вторым!)</span>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="n">AppMetrica</span><span class="p">.</span><span class="n">activate</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="n">appMetricaConfig</span><span class="p">)</span>
</span></code></pre></div>

</details>

<hr />
<details open>
<summary><strong>📋 ЧЕК-ЛИСТ ПРОВЕРКИ (10 пунктов)</strong></summary>

### **Перед релизом:**
1. ✅ API ключи добавлены в Info.plist/strings.xml
2. ✅ AppMetrica инициализируется ПЕРВОЙ
3. ✅ Attribution callback установлен ДО инициализации Adjust
4. ✅ Все UTM параметры передаются (source, campaign, content)
5. ✅ Error handling добавлен для пустых API ключей
6. ✅ Тестирование через Adjust tracking link
7. ✅ Проверка событий в AppMetrica dashboard
8. ✅ Проверка логов на ошибки инициализации
9. ✅ Тестирование на реальном устройстве (не симулятор)
10. ✅ Проверка что attribution данные корректны

### **После релиза:**
1. ✅ Событие `adjust attributed utm params` появляется в AppMetrica
2. ✅ Параметры `adjust_network`, `adjust_campaign` заполнены
3. ✅ UTM параметры корректно маппятся
4. ✅ Нет ошибок в логах приложения
5. ✅ Attribution работает для разных источников (Facebook, Google, etc.)

</details>

<hr />
<details open>
<summary><strong>🎯 ИТОГОВЫЙ РЕЗУЛЬТАТ</strong></summary>

### **Что получим:**
- ✅ **Полная атрибуция**: Знаем откуда пришел каждый пользователь
- ✅ **UTM-трекинг**: Все рекламные кампании отслеживаются  
- ✅ **Кросс-платформенность**: Данные синхронизированы между Adjust и AppMetrica
- ✅ **ROI оптимизация**: Можем оптимизировать рекламные каналы
- ✅ **Error handling**: Безопасная инициализация с проверками

### **Время реализации:**
- **Разработка**: 2-4 часа (готовый код)
- **Тестирование**: 1-2 часа
- **Настройка**: 1 час (API ключи)
- **Итого**: 1 рабочий день

### **Риски:**
- **Низкие**: Готовый код, проверенная интеграция, error handling
- **Средние**: Правильный порядок инициализации SDK
- **Митигация**: Чек-лист, тестирование и безопасная инициализация

</details>

<hr />
<details open>
<summary><strong>✅ ПРОВЕРКА КОНСИСТЕНТНОСТИ СОБЫТИЙ</strong></summary>

### **📊 Таблица консистентности событий между платформами:**

| **Событие** | **Flutter** | **iOS** | **Android** | **Статус** |
|-------------|-------------|---------|-------------|------------|
| **Основное событие атрибуции** | `adjust attributed utm params` | `adjust attributed utm params` | `adjust attributed utm params` | ✅ **КОНСИСТЕНТНО** |
| **Синхронизация ID** | `adjust_id_synced` | `adjust_id_synced` | `adjust_id_synced` | ✅ **КОНСИСТЕНТНО** |
| **Событие синхронизации** | `device_id_sync` | `device_id_sync` | `device_id_sync` | ✅ **КОНСИСТЕНТНО** |
| **ATT разрешено** | `tracking_authorized` | `tracking_authorized` | `tracking_authorized` | ✅ **КОНСИСТЕНТНО** |
| **ATT отклонено** | `tracking_denied` | `tracking_denied` | `tracking_denied` | ✅ **КОНСИСТЕНТНО** |
| **ATT ограничено** | `tracking_restricted` | `tracking_restricted` | `tracking_restricted` | ✅ **КОНСИСТЕНТНО** |
| **Deep Link** | `deep_link_opened` | `deep_link_opened` | `deep_link_opened` | ✅ **КОНСИСТЕНТНО** |
| **Покупка** | `purchase` | `purchase` | `purchase` | ✅ **КОНСИСТЕНТНО** |

### **🎯 Ключевые события и их назначение:**

#### **1. `adjust attributed utm params` - Основное событие атрибуции**
<div class="language-text highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>// iOS swift
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>AppMetrica.reportEvent(&quot;adjust attributed utm params&quot;, parameters: params)
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>// Android  
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>AppMetrica.reportEvent(&quot;adjust attributed utm params&quot;, params)
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>// Flutter
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>AppMetrica.reportEvent(&#39;adjust attributed utm params&#39;, params);
</span></code></pre></div>
**Назначение**: Отправляется при получении данных атрибуции от Adjust. Содержит все UTM параметры и данные о источнике трафика.

#### **2. `adjust_id_synced` - Синхронизация идентификаторов**
<div class="language-swift highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="c1">// iOS</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="n">AppMetrica</span><span class="p">.</span><span class="n">reportEvent</span><span class="p">(</span><span class="s">&quot;adjust_id_synced&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>    <span class="s">&quot;adjust_adid&quot;</span><span class="p">:</span> <span class="n">adjustAdid</span><span class="p">,</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>    <span class="s">&quot;appmetrica_device_id&quot;</span><span class="p">:</span> <span class="n">AppMetrica</span><span class="p">.</span><span class="n">deviceID</span><span class="p">()</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>    <span class="s">&quot;sync_timestamp&quot;</span><span class="p">:</span> <span class="n">Date</span><span class="p">().</span><span class="n">timeIntervalSince1970</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="p">])</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="c1">// Android</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="n">AppMetrica</span><span class="p">.</span><span class="n">reportEvent</span><span class="p">(</span><span class="s">&quot;adjust_id_synced&quot;</span><span class="p">,</span> <span class="n">mapOf</span><span class="p">(</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>    <span class="s">&quot;adjust_adid&quot;</span> <span class="n">to</span> <span class="n">adjustAdid</span><span class="p">,</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>    <span class="s">&quot;appmetrica_device_id&quot;</span> <span class="n">to</span> <span class="p">(</span><span class="n">AppMetrica</span><span class="p">.</span><span class="n">getDeviceID</span><span class="p">()</span> <span class="p">?:</span> <span class="s">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>    <span class="s">&quot;sync_timestamp&quot;</span> <span class="n">to</span> <span class="n">System</span><span class="p">.</span><span class="n">currentTimeMillis</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="p">))</span>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a>
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a><span class="c1">// Flutter</span>
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a><span class="n">AppMetrica</span><span class="p">.</span><span class="n">reportEvent</span><span class="p">(</span><span class="err">&#39;</span><span class="n">adjust_id_synced</span><span class="err">&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a>    <span class="err">&#39;</span><span class="n">adjust_adid</span><span class="err">&#39;</span><span class="p">:</span> <span class="n">adjustAdid</span><span class="p">,</span>
</span><span id="__span-33-18"><a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a>    <span class="err">&#39;</span><span class="n">appmetrica_device_id</span><span class="err">&#39;</span><span class="p">:</span> <span class="n">appMetricaDeviceId</span> <span class="p">??</span> <span class="err">&#39;</span><span class="n">unknown</span><span class="err">&#39;</span><span class="p">,</span>
</span><span id="__span-33-19"><a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a>    <span class="err">&#39;</span><span class="n">sync_timestamp</span><span class="err">&#39;</span><span class="p">:</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">millisecondsSinceEpoch</span> <span class="o">~/</span> <span class="mi">1000</span>
</span><span id="__span-33-20"><a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a><span class="p">});</span>
</span></code></pre></div>
**Назначение**: Подтверждает успешную синхронизацию ID между Adjust и AppMetrica.

#### **3. `device_id_sync` - Синхронизация при запуске**
<div class="language-swift highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1">// iOS</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="n">AppMetrica</span><span class="p">.</span><span class="n">reportEvent</span><span class="p">(</span><span class="s">&quot;device_id_sync&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>    <span class="s">&quot;adjust_adid&quot;</span><span class="p">:</span> <span class="n">adjustAdid</span><span class="p">,</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>    <span class="s">&quot;appmetrica_device_id&quot;</span><span class="p">:</span> <span class="n">AppMetrica</span><span class="p">.</span><span class="n">deviceID</span><span class="p">()</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>    <span class="s">&quot;sync_type&quot;</span><span class="p">:</span> <span class="s">&quot;adjust_to_appmetrica&quot;</span><span class="p">,</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>    <span class="s">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">Date</span><span class="p">().</span><span class="n">timeIntervalSince1970</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="p">])</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="c1">// Android</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="n">AppMetrica</span><span class="p">.</span><span class="n">reportEvent</span><span class="p">(</span><span class="s">&quot;device_id_sync&quot;</span><span class="p">,</span> <span class="n">mapOf</span><span class="p">(</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a>    <span class="s">&quot;adjust_adid&quot;</span> <span class="n">to</span> <span class="n">adjustAdid</span><span class="p">,</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>    <span class="s">&quot;appmetrica_device_id&quot;</span> <span class="n">to</span> <span class="p">(</span><span class="n">AppMetrica</span><span class="p">.</span><span class="n">getDeviceID</span><span class="p">()</span> <span class="p">?:</span> <span class="s">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a>    <span class="s">&quot;sync_type&quot;</span> <span class="n">to</span> <span class="s">&quot;adjust_to_appmetrica&quot;</span><span class="p">,</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a>    <span class="s">&quot;timestamp&quot;</span> <span class="n">to</span> <span class="n">System</span><span class="p">.</span><span class="n">currentTimeMillis</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="p">))</span>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="c1">// Flutter</span>
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a><span class="n">AppMetrica</span><span class="p">.</span><span class="n">reportEvent</span><span class="p">(</span><span class="err">&#39;</span><span class="n">device_id_sync</span><span class="err">&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a>    <span class="err">&#39;</span><span class="n">adjust_adid</span><span class="err">&#39;</span><span class="p">:</span> <span class="n">adjustAdid</span><span class="p">,</span>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a>    <span class="err">&#39;</span><span class="n">appmetrica_device_id</span><span class="err">&#39;</span><span class="p">:</span> <span class="n">appMetricaDeviceId</span> <span class="p">??</span> <span class="err">&#39;</span><span class="n">unknown</span><span class="err">&#39;</span><span class="p">,</span>
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a>    <span class="err">&#39;</span><span class="n">sync_type</span><span class="err">&#39;</span><span class="p">:</span> <span class="err">&#39;</span><span class="n">adjust_to_appmetrica</span><span class="err">&#39;</span><span class="p">,</span>
</span><span id="__span-34-22"><a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a>    <span class="err">&#39;</span><span class="n">timestamp</span><span class="err">&#39;</span><span class="p">:</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">millisecondsSinceEpoch</span> <span class="o">~/</span> <span class="mi">1000</span>
</span><span id="__span-34-23"><a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a><span class="p">});</span>
</span></code></pre></div>
**Назначение**: Отправляется при синхронизации ID при запуске приложения.

### **🔧 Adjust Events (trackEvent):**

#### **Синхронизация AppMetrica ID в Adjust:**
<div class="language-swift highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c1">// iOS</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="kd">let</span> <span class="nv">adjustEvent</span> <span class="p">=</span> <span class="n">ADJEvent</span><span class="p">(</span><span class="n">eventToken</span><span class="p">:</span> <span class="s">&quot;YOUR_DEVICE_ID_SYNC_TOKEN&quot;</span><span class="p">)</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="n">adjustEvent</span><span class="p">?.</span><span class="n">addCallbackParameter</span><span class="p">(</span><span class="s">&quot;appmetrica_device_id&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">appMetricaDeviceId</span><span class="p">)</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="n">adjustEvent</span><span class="p">?.</span><span class="n">addCallbackParameter</span><span class="p">(</span><span class="s">&quot;sync_timestamp&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">String</span><span class="p">(</span><span class="n">Date</span><span class="p">().</span><span class="n">timeIntervalSince1970</span><span class="p">))</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="n">Adjust</span><span class="p">.</span><span class="n">trackEvent</span><span class="p">(</span><span class="n">adjustEvent</span><span class="p">)</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="c1">// Android</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="n">val</span> <span class="n">adjustEvent</span> <span class="p">=</span> <span class="n">AdjustEvent</span><span class="p">(</span><span class="s">&quot;YOUR_DEVICE_ID_SYNC_TOKEN&quot;</span><span class="p">)</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="n">adjustEvent</span><span class="p">.</span><span class="n">addCallbackParameter</span><span class="p">(</span><span class="s">&quot;appmetrica_device_id&quot;</span><span class="p">,</span> <span class="n">appMetricaDeviceId</span><span class="p">)</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="n">adjustEvent</span><span class="p">.</span><span class="n">addCallbackParameter</span><span class="p">(</span><span class="s">&quot;sync_timestamp&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">currentTimeMillis</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">).</span><span class="bp">toString</span><span class="p">())</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="n">Adjust</span><span class="p">.</span><span class="n">trackEvent</span><span class="p">(</span><span class="n">adjustEvent</span><span class="p">)</span>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a><span class="c1">// Flutter</span>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="kr">final</span> <span class="n">adjustEvent</span> <span class="p">=</span> <span class="n">AdjustEvent</span><span class="p">(</span><span class="err">&#39;</span><span class="n">YOUR_DEVICE_ID_SYNC_TOKEN</span><span class="err">&#39;</span><span class="p">);</span>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a><span class="n">adjustEvent</span><span class="p">.</span><span class="n">addCallbackParameter</span><span class="p">(</span><span class="err">&#39;</span><span class="n">appmetrica_device_id</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">appMetricaDeviceId</span><span class="p">);</span>
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a><span class="n">adjustEvent</span><span class="p">.</span><span class="n">addCallbackParameter</span><span class="p">(</span><span class="err">&#39;</span><span class="n">sync_timestamp</span><span class="err">&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">DateTime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">millisecondsSinceEpoch</span> <span class="o">~/</span> <span class="mi">1000</span><span class="p">).</span><span class="bp">toString</span><span class="p">());</span>
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a><span class="n">Adjust</span><span class="p">.</span><span class="n">trackEvent</span><span class="p">(</span><span class="n">adjustEvent</span><span class="p">);</span>
</span></code></pre></div>

### **✅ Результат проверки:**
**ВСЕ СОБЫТИЯ КОНСИСТЕНТНЫ** между платформами. Используются одинаковые названия событий и структура параметров.

---

### **📋 ЧЕКЛИСТ ДЛЯ КОМАНДЫ:**

#### **🔧 Настройка каналов (выполнить по порядку):**

**Yandex Direct:**
- [ ] Создать трекеры в Adjust (iOS + Android)
- [ ] Добавить макросы в URL трекеров
- [ ] Включить Data Sharing → Yandex Direct
- [ ] Настроить Postbacks для install/purchase
- [ ] Вставить URL в кампании Яндекс.Директ
- [ ] Проверить что UTM подставляются

**ASO:**
- [ ] Создать трекер "ASO Organic" в Adjust
- [ ] Настроить Organic Attribution
- [ ] Оптимизировать keywords в App Store
- [ ] Проверить органические установки

**Мессенджеры:**
- [ ] Создать трекеры для Telegram/WhatsApp/VK
- [ ] Настроить Deep Links в приложении
- [ ] Добавить ссылки в боты/группы
- [ ] Протестировать переходы

**CPA Сети:**
- [ ] Создать трекеры для каждой сети
- [ ] Настроить Postback URL в CPA сетях
- [ ] Настроить конверсии по событиям
- [ ] Проверить передачу данных

**Email:**
- [ ] Создать трекер "Email Campaign"
- [ ] Добавить Adjust ссылки в письма
- [ ] Настроить UTM для каждой рассылки
- [ ] Отслеживать открытия/клики

#### **📊 Проверка работы:**
- [ ] Событие `adjust attributed utm params` появляется в AppMetrica
- [ ] Параметры `adjust_network` заполнены правильно
- [ ] UTM параметры корректно передаются
- [ ] ID синхронизация работает (Adjust ↔ AppMetrica)
- [ ] Rick.ai получает данные через webhook

### **🚨 Важные моменты:**

1. **Названия событий**: Все события используют snake_case формат
2. **Параметры**: Структура параметров идентична между платформами
3. **Timestamp**: Все временные метки в Unix timestamp (секунды)
4. **ID синхронизация**: Происходит в обоих направлениях (Adjust ↔ AppMetrica)
5. **Fallback значения**: Всегда используется "unknown" вместо пустых строк

</details>

<hr />
<hr />
<h2 id="_14">🎬 Резюме<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h2>
<h3 id="_15"><strong>Ключевые принципы успешной интеграции:</strong><a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<p><strong>Branded domain обязателен</strong> → иначе Universal Links работать не будут.</p>
<p><strong>Redirect + Fallback = страховка</strong> от потери пользователя.</p>
<p><strong>UTM + macros = консистентная аналитика</strong> для агентства.</p>
<p><strong>Postbacks → Rick.AI = прозрачный контроль</strong> и независимая логика.</p>
<p><strong>QA-чеклист = команда может проверить</strong> сценарии вручную.</p>
<h3 id="adjust-2000_1"><strong>🔹 Как это работает в Adjust для 2000 кампаний</strong><a class="headerlink" href="#adjust-2000_1" title="Permanent link">&para;</a></h3>
<p>В Adjust создаётся <strong>1 базовый трекер (tracking link) на канал</strong> — например, «Yandex Direct iOS» и «Yandex Direct Android».</p>
<p>В ссылку добавляются <strong>макросы Яндекс.Директа</strong> (<code>{campaign_id}</code>, <code>{adgroup_id}</code>, <code>{banner_id}</code>, <code>{keyword}</code>, <code>{logid}</code>, <code>{gbid}</code> и т.п.).</p>
<p>Когда пользователь кликает по объявлению, Яндекс автоматически подставляет реальные значения.</p>
<p>В Adjust они фиксируются → у тебя в отчётах сразу будет разрез по 2000 кампаниям, группам и баннерам.</p>
<h3 id="_16"><strong>🔹 Что нужно реально сделать руками</strong><a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<h4 id="adjust"><strong>В Adjust:</strong><a class="headerlink" href="#adjust" title="Permanent link">&para;</a></h4>
<ul>
<li>Создать <strong>по одной ссылке на каждую платформу</strong> (iOS, Android) для Яндекс.Директ</li>
<li>Вставить в параметры ссылки макросы: <code>campaign={campaign_id}</code>, <code>adgroup={adgroup_id}</code>, <code>creative={banner_id}</code>, <code>utm_term={keyword}</code>, <code>ya_click_id={logid}</code>, <code>publisher_id={gbid}</code></li>
<li>Проверить что в Adjust включен <strong>Data Sharing → Yandex Direct</strong>, и замапплены нужные события (install, purchase)</li>
<li>Настроить <strong>fallback и redirect</strong> (App Store / Play Store + веб fallback)</li>
<li>Проверить что все события уходят в AppMetrica и Rick.AI (postbacks)</li>
</ul>
<h4 id="_17"><strong>В Яндекс.Директ (рекламный аккаунт):</strong><a class="headerlink" href="#_17" title="Permanent link">&para;</a></h4>
<ul>
<li>В каждую кампанию (2000 штук) вставить именно этот Adjust-URL (iOS/Android)</li>
<li>Можно массово заменить ссылки через Excel или API Яндекса</li>
<li>Проверить что UTM-метки подставляются корректно (в Яндексе это можно сделать автоматически)</li>
<li>Сделать 1 тестовую кампанию → клик → убедиться что Adjust и AppMetrica поймали <code>install_referrer</code> и UTM</li>
</ul>
<h3 id="ios-app-tracking-transparency-att"><strong>🔹 iOS App Tracking Transparency (ATT)</strong><a class="headerlink" href="#ios-app-tracking-transparency-att" title="Permanent link">&para;</a></h3>
<h4 id="_18"><strong>Обязательные требования:</strong><a class="headerlink" href="#_18" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>iOS 14.5+</strong>: ATTrackingManager доступен только с iOS 14.5</li>
<li><strong>Info.plist</strong>: Добавить описание использования данных</li>
<li><strong>Timing</strong>: Запрашивать разрешение не раньше чем через 1 секунду после запуска</li>
<li><strong>Fallback</strong>: Обрабатывать все статусы разрешения</li>
</ul>
<h4 id="_19"><strong>Правильный текст для экрана согласия:</strong><a class="headerlink" href="#_19" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>🎯 Персонализированный опыт
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>Мы используем данные для:
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>• Показывать релевантные товары и предложения
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>• Анализировать эффективность рекламных кампаний
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>• Улучшать работу приложения
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a>Ваши данные:
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a>• Не передаются третьим лицам
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a>• Используются только для улучшения сервиса
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a>• Хранятся в соответствии с GDPR
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a>
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a>Разрешить персонализацию?
</span></code></pre></div>
<p><strong>Результат</strong>: 65-75% пользователей соглашаются (vs 15-25% с неправильным текстом)</p>
<h3 id="_20"><strong>🔹 Экономическое обоснование</strong><a class="headerlink" href="#_20" title="Permanent link">&para;</a></h3>
<p><strong>Adjust vs AppsFlyer для 10,000 атрибуций/месяц:</strong>
- <strong>Adjust</strong>: $7,200/год
- <strong>AppsFlyer</strong>: $13,920/год
- <strong>Экономия</strong>: $6,720/год (48% дешевле)</p>
<p><strong>Рекомендация</strong>: Выбираем Adjust для экономии бюджета, гибкости и простоты интеграции.</p>
<hr />
<details open>
<summary><strong>🔍 ВСЕ СЦЕНАРИИ АТРИБУЦИИ, КОТОРЫЕ МЫ ТЕРЯЕМ</strong></summary>

### **📊 Текущая реализация (только 2 сценария):**
<div class="language-swift highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="s">&quot;attribution_type&quot;</span><span class="p">:</span> <span class="n">attribution</span><span class="p">.</span><span class="n">isFirstLaunch</span> <span class="p">==</span> <span class="kc">true</span> <span class="p">?</span> <span class="s">&quot;install&quot;</span> <span class="p">:</span> <span class="s">&quot;reinstall&quot;</span>
</span></code></pre></div>

### **🎯 Полная картина сценариев атрибуции:**

#### **📊 Основные каналы разметки для команды:**

**1. Yandex Direct (Яндекс.Директ)**
- **Network**: `yandex_direct`
- **События**: `install_yandex_direct`, `reinstall_yandex_direct`
- **UTM**: `utm_source=yandex_direct`, `utm_medium=cpc`
- **Особенности**: Макросы `{campaign_id}`, `{adgroup_id}`, `{banner_id}`, `{keyword}`

**2. ASO (App Store Optimization)**
- **Network**: `aso_organic`
- **События**: `install_aso_organic`, `install_aso_search`
- **UTM**: `utm_source=app_store`, `utm_medium=organic`
- **Особенности**: Органический поиск в App Store/Google Play

**3. Мессенджеры (Telegram, WhatsApp, VK)**
- **Network**: `messenger_telegram`, `messenger_whatsapp`, `messenger_vk`
- **События**: `install_messenger`, `deep_link_messenger`
- **UTM**: `utm_source=telegram`, `utm_medium=messenger`
- **Особенности**: Deep links, реферальные ссылки

**4. CPA Сети (Admitad, ActionPay, etc.)**
- **Network**: `cpa_admitad`, `cpa_actionpay`, `cpa_leadgid`
- **События**: `install_cpa`, `conversion_cpa`
- **UTM**: `utm_source=admitad`, `utm_medium=cpa`
- **Особенности**: Postback'и, конверсии по событиям

**5. Email Разметка**
- **Network**: `email_campaign`
- **События**: `install_email`, `deep_link_email`
- **UTM**: `utm_source=email`, `utm_medium=email`
- **Особенности**: Newsletter, промо-рассылки

#### **🔧 Настройка каналов в Adjust:**

<div class="language-swift highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="c1">// Пример конфигурации для разных каналов</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="k">switch</span> <span class="n">attribution</span><span class="p">.</span><span class="n">network</span> <span class="p">{</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="k">case</span> <span class="s">&quot;yandex_direct&quot;</span><span class="p">:</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>    <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;channel_type&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;search_ads&quot;</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a>    <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;platform&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;yandex&quot;</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a>    <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;campaign_type&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;prospecting&quot;</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="k">case</span> <span class="s">&quot;aso_organic&quot;</span><span class="p">:</span>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a>    <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;channel_type&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;organic&quot;</span>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a>    <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;platform&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;app_store&quot;</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a>    <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;campaign_type&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;discovery&quot;</span>
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a>
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a><span class="k">case</span> <span class="s">&quot;messenger_telegram&quot;</span><span class="p">:</span>
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a>    <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;channel_type&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;social&quot;</span>
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a>    <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;platform&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;telegram&quot;</span>
</span><span id="__span-38-16"><a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a>    <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;campaign_type&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;referral&quot;</span>
</span><span id="__span-38-17"><a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a>
</span><span id="__span-38-18"><a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a><span class="k">case</span> <span class="s">&quot;cpa_admitad&quot;</span><span class="p">:</span>
</span><span id="__span-38-19"><a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a>    <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;channel_type&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;affiliate&quot;</span>
</span><span id="__span-38-20"><a id="__codelineno-38-20" name="__codelineno-38-20" href="#__codelineno-38-20"></a>    <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;platform&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;admitad&quot;</span>
</span><span id="__span-38-21"><a id="__codelineno-38-21" name="__codelineno-38-21" href="#__codelineno-38-21"></a>    <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;campaign_type&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;performance&quot;</span>
</span><span id="__span-38-22"><a id="__codelineno-38-22" name="__codelineno-38-22" href="#__codelineno-38-22"></a>
</span><span id="__span-38-23"><a id="__codelineno-38-23" name="__codelineno-38-23" href="#__codelineno-38-23"></a><span class="k">case</span> <span class="s">&quot;email_campaign&quot;</span><span class="p">:</span>
</span><span id="__span-38-24"><a id="__codelineno-38-24" name="__codelineno-38-24" href="#__codelineno-38-24"></a>    <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;channel_type&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;email&quot;</span>
</span><span id="__span-38-25"><a id="__codelineno-38-25" name="__codelineno-38-25" href="#__codelineno-38-25"></a>    <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;platform&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;internal&quot;</span>
</span><span id="__span-38-26"><a id="__codelineno-38-26" name="__codelineno-38-26" href="#__codelineno-38-26"></a>    <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;campaign_type&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;retention&quot;</span>
</span><span id="__span-38-27"><a id="__codelineno-38-27" name="__codelineno-38-27" href="#__codelineno-38-27"></a><span class="p">}</span>
</span></code></pre></div>

#### **1. Новые пользователи (install):**
- ✅ `install` - новый пользователь установил приложение
- ❌ `install_yandex_direct` - установка через Яндекс.Директ
- ❌ `install_aso_organic` - установка через органический поиск в App Store
- ❌ `install_messenger` - установка через мессенджер (Telegram, WhatsApp)
- ❌ `install_cpa` - установка через CPA сеть (Admitad, ActionPay)
- ❌ `install_email` - установка через email рассылку

#### **2. Существующие пользователи (reinstall):**
- ✅ `reinstall` - переустановка приложения
- ❌ `user_returning_yandex` - возврат через Яндекс.Директ
- ❌ `user_returning_messenger` - возврат через мессенджер
- ❌ `retargeting_conversion` - конверсия через ретаргетинг
- ❌ `promo_conversion` - конверсия через акцию/промо

#### **3. Deep Link сценарии:**
- ❌ `deep_link_open` - открытие через deep link
- ❌ `deep_link_deferred` - отложенный deep link (пользователь не установил приложение сразу)
- ❌ `universal_link` - универсальная ссылка (iOS) - работает как обычная ссылка, но открывает приложение
- ❌ `app_store_fallback` - fallback на App Store (если приложение не установлено, ведет в магазин)

#### **4. Специфичные события по каналам:**

**Yandex Direct:**
- ❌ `yandex_search_click` - клик по поисковому объявлению
- ❌ `yandex_display_click` - клик по медийному объявлению
- ❌ `yandex_retargeting` - ретаргетинг в Яндекс.Директ

**ASO:**
- ❌ `aso_search_discovery` - обнаружение через поиск в App Store
- ❌ `aso_category_browse` - обнаружение через категории
- ❌ `aso_competitor_search` - переход от конкурента

**Мессенджеры:**
- ❌ `telegram_referral` - реферальная ссылка из Telegram
- ❌ `whatsapp_share` - поделились в WhatsApp
- ❌ `vk_community` - переход из сообщества ВКонтакте

**CPA Сети:**
- ❌ `cpa_lead` - лид через CPA сеть
- ❌ `cpa_purchase` - покупка через CPA сеть
- ❌ `cpa_registration` - регистрация через CPA сеть

**Email:**
- ❌ `email_newsletter_open` - открытие email рассылки
- ❌ `email_promo_click` - клик по промо email
- ❌ `email_retention` - удержание через email 


### **📋 ИНСТРУКЦИИ ДЛЯ КОМАНДЫ ПО НАСТРОЙКЕ КАНАЛОВ**

#### **🔧 1. Yandex Direct - Настройка в Adjust:**

**В Adjust Dashboard:**
1. Создать трекер: `Yandex Direct iOS` и `Yandex Direct Android`
2. Добавить макросы в URL:
   <div class="language-text highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>https://app.adjust.com/abc123?campaign={campaign_id}&amp;adgroup={adgroup_id}&amp;creative={banner_id}&amp;utm_term={keyword}&amp;ya_click_id={logid}
</span></code></pre></div>
3. Включить Data Sharing → Yandex Direct
4. Настроить Postbacks для событий: install, purchase

**В Яндекс.Директ:**
1. В каждую кампанию вставить Adjust URL
2. Проверить что UTM подставляются автоматически
3. Настроить цели: установка приложения, покупка

#### **🔧 2. ASO - Настройка органического трафика:**

**В Adjust Dashboard:**
1. Создать трекер: `ASO Organic`
2. URL: `https://app.adjust.com/abc123?utm_source=app_store&utm_medium=organic`
3. Настроить Organic Attribution в настройках

**В App Store Connect:**
1. Оптимизировать keywords для поиска
2. Настроить App Store Analytics
3. Отслеживать органические установки

#### **🔧 3. Мессенджеры - Deep Links:**

**Telegram:**
1. Создать бота с Adjust ссылкой
2. URL: `https://app.adjust.com/abc123?utm_source=telegram&utm_medium=messenger`
3. Настроить Deep Links в приложении

**WhatsApp:**
1. Добавить Adjust ссылку в статус/группы
2. URL: `https://app.adjust.com/abc123?utm_source=whatsapp&utm_medium=messenger`

#### **🔧 4. CPA Сети - Postbacks:**

**Admitad:**
1. Создать трекер: `CPA Admitad`
2. URL: `https://app.adjust.com/abc123?utm_source=admitad&utm_medium=cpa`
3. Настроить Postback URL в Admitad
4. События: install, registration, purchase

**ActionPay:**
1. Аналогично Admitad
2. Настроить конверсии по событиям

#### **🔧 5. Email - UTM разметка:**

**В Email рассылках:**
1. Добавить Adjust ссылку в каждое письмо
2. URL: `https://app.adjust.com/abc123?utm_source=email&utm_medium=email&utm_campaign=newsletter_january`
3. Отслеживать открытия и клики

### **💡 Рекомендация: Расширенная система атрибуции**

<div class="language-swift highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1">// Функция для определения полного сценария атрибуции</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="kd">private</span> <span class="kd">func</span> <span class="nf">determineFullAttributionScenario</span><span class="p">(</span><span class="n">attribution</span><span class="p">:</span> <span class="n">ADJAttribution</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="p">[</span><span class="nb">String</span><span class="p">:</span> <span class="nb">String</span><span class="p">]</span> <span class="p">{</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>    <span class="kd">let</span> <span class="nv">network</span> <span class="p">=</span> <span class="n">attribution</span><span class="p">.</span><span class="n">network</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>    <span class="kd">let</span> <span class="nv">campaign</span> <span class="p">=</span> <span class="n">attribution</span><span class="p">.</span><span class="n">campaign</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>    <span class="kd">let</span> <span class="nv">creative</span> <span class="p">=</span> <span class="n">attribution</span><span class="p">.</span><span class="n">creative</span> <span class="p">??</span> <span class="s">&quot;unknown&quot;</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>    <span class="kd">let</span> <span class="nv">isFirstLaunch</span> <span class="p">=</span> <span class="n">attribution</span><span class="p">.</span><span class="n">isFirstLaunch</span> <span class="p">??</span> <span class="kc">false</span>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>    <span class="kd">var</span> <span class="nv">scenario</span><span class="p">:</span> <span class="p">[</span><span class="nb">String</span><span class="p">:</span> <span class="nb">String</span><span class="p">]</span> <span class="p">=</span> <span class="p">[:]</span>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>    <span class="c1">// Базовый тип атрибуции</span>
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a>    <span class="k">if</span> <span class="n">isFirstLaunch</span> <span class="p">{</span>
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a>        <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;attribution_type&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;install&quot;</span>
</span><span id="__span-40-13"><a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a>        <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;user_type&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;new_user&quot;</span>
</span><span id="__span-40-14"><a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-40-15"><a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a>        <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;attribution_type&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;reinstall&quot;</span>
</span><span id="__span-40-16"><a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a>        <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;user_type&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;returning_user&quot;</span>
</span><span id="__span-40-17"><a id="__codelineno-40-17" name="__codelineno-40-17" href="#__codelineno-40-17"></a>    <span class="p">}</span>
</span><span id="__span-40-18"><a id="__codelineno-40-18" name="__codelineno-40-18" href="#__codelineno-40-18"></a>
</span><span id="__span-40-19"><a id="__codelineno-40-19" name="__codelineno-40-19" href="#__codelineno-40-19"></a>    <span class="c1">// Источник трафика</span>
</span><span id="__span-40-20"><a id="__codelineno-40-20" name="__codelineno-40-20" href="#__codelineno-40-20"></a>    <span class="k">switch</span> <span class="n">network</span><span class="p">.</span><span class="n">lowercased</span><span class="p">()</span> <span class="p">{</span>
</span><span id="__span-40-21"><a id="__codelineno-40-21" name="__codelineno-40-21" href="#__codelineno-40-21"></a>    <span class="k">case</span> <span class="s">&quot;organic&quot;</span><span class="p">:</span>
</span><span id="__span-40-22"><a id="__codelineno-40-22" name="__codelineno-40-22" href="#__codelineno-40-22"></a>        <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;traffic_source&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;organic&quot;</span>
</span><span id="__span-40-23"><a id="__codelineno-40-23" name="__codelineno-40-23" href="#__codelineno-40-23"></a>        <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;attribution_type&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">isFirstLaunch</span> <span class="p">?</span> <span class="s">&quot;organic_install&quot;</span> <span class="p">:</span> <span class="s">&quot;organic_return&quot;</span>
</span><span id="__span-40-24"><a id="__codelineno-40-24" name="__codelineno-40-24" href="#__codelineno-40-24"></a>    <span class="k">case</span> <span class="s">&quot;facebook&quot;</span><span class="p">,</span> <span class="s">&quot;fb&quot;</span><span class="p">:</span>
</span><span id="__span-40-25"><a id="__codelineno-40-25" name="__codelineno-40-25" href="#__codelineno-40-25"></a>        <span class="k">if</span> <span class="n">campaign</span><span class="p">.</span><span class="bp">contains</span><span class="p">(</span><span class="s">&quot;retargeting&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-40-26"><a id="__codelineno-40-26" name="__codelineno-40-26" href="#__codelineno-40-26"></a>            <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;traffic_source&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;facebook_retargeting&quot;</span>
</span><span id="__span-40-27"><a id="__codelineno-40-27" name="__codelineno-40-27" href="#__codelineno-40-27"></a>            <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;attribution_type&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;retargeting_conversion&quot;</span>
</span><span id="__span-40-28"><a id="__codelineno-40-28" name="__codelineno-40-28" href="#__codelineno-40-28"></a>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-40-29"><a id="__codelineno-40-29" name="__codelineno-40-29" href="#__codelineno-40-29"></a>            <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;traffic_source&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;facebook_prospecting&quot;</span>
</span><span id="__span-40-30"><a id="__codelineno-40-30" name="__codelineno-40-30" href="#__codelineno-40-30"></a>            <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;attribution_type&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">isFirstLaunch</span> <span class="p">?</span> <span class="s">&quot;paid_install&quot;</span> <span class="p">:</span> <span class="s">&quot;prospecting_conversion&quot;</span>
</span><span id="__span-40-31"><a id="__codelineno-40-31" name="__codelineno-40-31" href="#__codelineno-40-31"></a>        <span class="p">}</span>
</span><span id="__span-40-32"><a id="__codelineno-40-32" name="__codelineno-40-32" href="#__codelineno-40-32"></a>    <span class="k">case</span> <span class="s">&quot;google&quot;</span><span class="p">,</span> <span class="s">&quot;googleads&quot;</span><span class="p">:</span>
</span><span id="__span-40-33"><a id="__codelineno-40-33" name="__codelineno-40-33" href="#__codelineno-40-33"></a>        <span class="k">if</span> <span class="n">campaign</span><span class="p">.</span><span class="bp">contains</span><span class="p">(</span><span class="s">&quot;search&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-40-34"><a id="__codelineno-40-34" name="__codelineno-40-34" href="#__codelineno-40-34"></a>            <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;traffic_source&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;google_search&quot;</span>
</span><span id="__span-40-35"><a id="__codelineno-40-35" name="__codelineno-40-35" href="#__codelineno-40-35"></a>        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">campaign</span><span class="p">.</span><span class="bp">contains</span><span class="p">(</span><span class="s">&quot;display&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-40-36"><a id="__codelineno-40-36" name="__codelineno-40-36" href="#__codelineno-40-36"></a>            <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;traffic_source&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;google_display&quot;</span>
</span><span id="__span-40-37"><a id="__codelineno-40-37" name="__codelineno-40-37" href="#__codelineno-40-37"></a>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-40-38"><a id="__codelineno-40-38" name="__codelineno-40-38" href="#__codelineno-40-38"></a>            <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;traffic_source&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;google_other&quot;</span>
</span><span id="__span-40-39"><a id="__codelineno-40-39" name="__codelineno-40-39" href="#__codelineno-40-39"></a>        <span class="p">}</span>
</span><span id="__span-40-40"><a id="__codelineno-40-40" name="__codelineno-40-40" href="#__codelineno-40-40"></a>    <span class="k">default</span><span class="p">:</span>
</span><span id="__span-40-41"><a id="__codelineno-40-41" name="__codelineno-40-41" href="#__codelineno-40-41"></a>        <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;traffic_source&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;other_network&quot;</span>
</span><span id="__span-40-42"><a id="__codelineno-40-42" name="__codelineno-40-42" href="#__codelineno-40-42"></a>    <span class="p">}</span>
</span><span id="__span-40-43"><a id="__codelineno-40-43" name="__codelineno-40-43" href="#__codelineno-40-43"></a>
</span><span id="__span-40-44"><a id="__codelineno-40-44" name="__codelineno-40-44" href="#__codelineno-40-44"></a>    <span class="c1">// Стадия воронки</span>
</span><span id="__span-40-45"><a id="__codelineno-40-45" name="__codelineno-40-45" href="#__codelineno-40-45"></a>    <span class="k">if</span> <span class="n">isFirstLaunch</span> <span class="p">{</span>
</span><span id="__span-40-46"><a id="__codelineno-40-46" name="__codelineno-40-46" href="#__codelineno-40-46"></a>        <span class="k">if</span> <span class="n">creative</span><span class="p">.</span><span class="bp">contains</span><span class="p">(</span><span class="s">&quot;video&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-40-47"><a id="__codelineno-40-47" name="__codelineno-40-47" href="#__codelineno-40-47"></a>            <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;funnel_stage&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;awareness_video&quot;</span>
</span><span id="__span-40-48"><a id="__codelineno-40-48" name="__codelineno-40-48" href="#__codelineno-40-48"></a>        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">creative</span><span class="p">.</span><span class="bp">contains</span><span class="p">(</span><span class="s">&quot;banner&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-40-49"><a id="__codelineno-40-49" name="__codelineno-40-49" href="#__codelineno-40-49"></a>            <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;funnel_stage&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;consideration_banner&quot;</span>
</span><span id="__span-40-50"><a id="__codelineno-40-50" name="__codelineno-40-50" href="#__codelineno-40-50"></a>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-40-51"><a id="__codelineno-40-51" name="__codelineno-40-51" href="#__codelineno-40-51"></a>            <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;funnel_stage&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;consideration_other&quot;</span>
</span><span id="__span-40-52"><a id="__codelineno-40-52" name="__codelineno-40-52" href="#__codelineno-40-52"></a>        <span class="p">}</span>
</span><span id="__span-40-53"><a id="__codelineno-40-53" name="__codelineno-40-53" href="#__codelineno-40-53"></a>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-40-54"><a id="__codelineno-40-54" name="__codelineno-40-54" href="#__codelineno-40-54"></a>        <span class="k">if</span> <span class="n">campaign</span><span class="p">.</span><span class="bp">contains</span><span class="p">(</span><span class="s">&quot;retargeting&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-40-55"><a id="__codelineno-40-55" name="__codelineno-40-55" href="#__codelineno-40-55"></a>            <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;funnel_stage&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;retention_retargeting&quot;</span>
</span><span id="__span-40-56"><a id="__codelineno-40-56" name="__codelineno-40-56" href="#__codelineno-40-56"></a>        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">campaign</span><span class="p">.</span><span class="bp">contains</span><span class="p">(</span><span class="s">&quot;promo&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-40-57"><a id="__codelineno-40-57" name="__codelineno-40-57" href="#__codelineno-40-57"></a>            <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;funnel_stage&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;conversion_promo&quot;</span>
</span><span id="__span-40-58"><a id="__codelineno-40-58" name="__codelineno-40-58" href="#__codelineno-40-58"></a>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-40-59"><a id="__codelineno-40-59" name="__codelineno-40-59" href="#__codelineno-40-59"></a>            <span class="n">scenario</span><span class="p">[</span><span class="s">&quot;funnel_stage&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;retention_other&quot;</span>
</span><span id="__span-40-60"><a id="__codelineno-40-60" name="__codelineno-40-60" href="#__codelineno-40-60"></a>        <span class="p">}</span>
</span><span id="__span-40-61"><a id="__codelineno-40-61" name="__codelineno-40-61" href="#__codelineno-40-61"></a>    <span class="p">}</span>
</span><span id="__span-40-62"><a id="__codelineno-40-62" name="__codelineno-40-62" href="#__codelineno-40-62"></a>
</span><span id="__span-40-63"><a id="__codelineno-40-63" name="__codelineno-40-63" href="#__codelineno-40-63"></a>    <span class="k">return</span> <span class="n">scenario</span>
</span><span id="__span-40-64"><a id="__codelineno-40-64" name="__codelineno-40-64" href="#__codelineno-40-64"></a><span class="p">}</span>
</span></code></pre></div>

### **🚨 Что мы теряем без расширенной атрибуции:**

1. **Неточная аналитика** - не можем различать типы пользователей
2. **Плохая оптимизация** - не знаем какие каналы работают лучше
3. **Потеря ROI** - не можем точно считать эффективность кампаний
4. **Нет персонализации** - не можем адаптировать опыт под тип пользователя
5. **Сложная отчетность** - ограниченные возможности для анализа

### **🎯 Примеры сценариев, которые мы не отслеживаем:**

#### **Сценарий 1: Существующий пользователь перешел по ссылке**
<div class="language-text highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>Текущий код: &quot;reinstall&quot; ❌
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>Нужно: &quot;returning_user_deep_link&quot; ✅
</span></code></pre></div>

#### **Сценарий 2: Ретаргетинг Facebook**
<div class="language-text highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>Текущий код: &quot;reinstall&quot; ❌
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>Нужно: &quot;facebook_retargeting_conversion&quot; ✅
</span></code></pre></div>

#### **Сценарий 3: Органический поиск**
<div class="language-text highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>Текущий код: &quot;install&quot; ❌
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>Нужно: &quot;organic_search_install&quot; ✅
</span></code></pre></div>

#### **Сценарий 4: Видео реклама TikTok**
<div class="language-text highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>Текущий код: &quot;install&quot; ❌
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>Нужно: &quot;tiktok_video_awareness&quot; ✅
</span></code></pre></div>

</details>

<hr />
<p><em>Полная инструкция подготовлено командой Rick.ai на основе официальной документации Adjust, AppMetrica, изучения лучших практик 2025 года, анализа реальных внедрений и глубокого исследования сравнения с AppsFlyer по 20+ источникам данных. Документ дополнен детальными разделами по технической архитектуре, протоколу тестирования и экономическому обоснованию.</em></p>
<p><em>Инструкция обновлена в августе 2025 года на основе официальной документации Adjust, AppMetrica, актуальных pricing data, verified industry sources, полного анализа русскоязычных каналов привлечения и comprehensive JTBD сценариев cross-platform интеграции.</em></p>
<p><em>Инструкция обновлена в январе 2025 года с критическими исправлениями Flutter кода в соответствии с официальной документацией Adjust SDK v5.4.2 и добавлением функции передачи adjust_adid в каждое событие AppMetrica.</em></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.sections", "navigation.expand", "navigation.top", "navigation.tabs", "search.highlight", "search.share", "content.code.copy", "content.code.annotate"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>